var Fd=Object.defineProperty;var sc=a=>{throw TypeError(a)};var qd=(a,e,s)=>e in a?Fd(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var d=(a,e,s)=>qd(a,typeof e!="symbol"?e+"":e,s),ca=(a,e,s)=>e.has(a)||sc("Cannot "+s);var g=(a,e,s)=>(ca(a,e,"read from private field"),s?s.call(a):e.get(a)),at=(a,e,s)=>e.has(a)?sc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,s),W=(a,e,s,i)=>(ca(a,e,"write to private field"),i?i.call(a,s):e.set(a,s),s),k=(a,e,s)=>(ca(a,e,"access private method"),s);var Mr=(a,e,s,i)=>({set _(u){W(a,e,u,s)},get _(){return g(a,e,i)}});import{W as T,S as vc}from"./ButtonAugment-CSwi-JVg.js";import{d as Pd}from"./Content-DlSDhH-b.js";import{ab as Ms,a9 as nn,al as Is,ad as Dd,an as Od,S as bn,d as Sn,e as Cn,h as Qt,j as L,k as Ln,l as Nn,n as xt,m as sn,o as fa,H as kd,u as Ld,v as Nd,w as Hd,p as rc,x as Ud,q as jd,r as ic}from"./index-Bg5k1fBH.js";import{C as $t,a as re,P as Ut,W as zd,A as Ie,b as ac,T as oc,s as Bd,r as Wd,c as Gd,d as Gt,e as bc,F as $d,f as Vd,g as Zd,I as Es,E as Jd}from"./folder-opened-Bm8IVIHF.js";import{p as Yd,S as Kd,a as uc}from"./pen-to-square-DVpukHrw.js";import{n as Xd}from"./file-paths-BcSg4gks.js";import{R as pe}from"./CollapseButtonAugment-BGvJcqaG.js";const la="augment-welcome";var ot=(a=>(a.draft="draft",a.sent="sent",a.failed="failed",a.success="success",a.cancelled="cancelled",a))(ot||{}),Pn=(a=>(a.running="running",a.awaitingUserAction="awaiting-user-action",a.notRunning="not-running",a))(Pn||{}),Lt=(a=>(a.seen="seen",a.unseen="unseen",a))(Lt||{}),es=(a=>(a.signInWelcome="sign-in-welcome",a.generateCommitMessage="generate-commit-message",a.summaryResponse="summary-response",a.summaryTitle="summary-title",a.educateFeatures="educate-features",a.autofixMessage="autofix-message",a.autofixSteeringMessage="autofix-steering-message",a.autofixStage="autofix-stage",a.agentOnboarding="agent-onboarding",a.agenticTurnDelimiter="agentic-turn-delimiter",a.agenticRevertDelimiter="agentic-revert-delimiter",a.agenticCheckpointDelimiter="agentic-checkpoint-delimiter",a.exchange="exchange",a))(es||{});function _e(a){return!!a&&(a.chatItemType===void 0||a.chatItemType==="agent-onboarding")}function ns(a){return _e(a)&&a.status==="success"}function Uf(a){return a.chatItemType==="autofix-message"}function jf(a){return a.chatItemType==="autofix-steering-message"}function zf(a){return a.chatItemType==="autofix-stage"}function Bf(a){return a.chatItemType==="sign-in-welcome"}function Wf(a){return a.chatItemType==="generate-commit-message"}function Gf(a){return a.chatItemType==="summary-response"}function $f(a){return a.chatItemType==="educate-features"}function Vf(a){return a.chatItemType==="agent-onboarding"}function Zf(a){return a.chatItemType==="agentic-turn-delimiter"}function Rs(a){return a.chatItemType==="agentic-checkpoint-delimiter"}function Jf(a){return a.revertTarget!==void 0}function Yf(a){var e;return((e=a.structured_output_nodes)==null?void 0:e.some(s=>s.type===re.TOOL_USE))??!1}function Kf(a){var e;return((e=a.structured_request_nodes)==null?void 0:e.some(s=>s.type===$t.TOOL_RESULT))??!1}function Xf(a){return!(!a||typeof a!="object")&&(!("request_id"in a)||typeof a.request_id=="string")&&(!("seen_state"in a)||a.seen_state==="seen"||a.seen_state==="unseen")}class Qd{constructor(e,s,i,u=5,l=4e3,p){d(this,"_isCancelled",!1);this.requestId=e,this.chatMessage=s,this.startStreamFn=i,this.maxRetries=u,this.baseDelay=l,this.flags=p}cancel(){this._isCancelled=!0}async*getStream(){let e=0,s=!1;try{for(;!this._isCancelled;){const i=this.startStreamFn(this.chatMessage,this.flags?{flags:this.flags}:void 0);let u=!1,l="";for await(const y of i){if(y.status===ot.failed){if(y.isRetriable!==!0||s)return yield y;u=!0,l=y.display_error_message||"Service is currently unavailable";break}s=!0,yield y}if(!u)return;if(this._isCancelled)return yield this.createCancelledStatus();if(e++,e>this.maxRetries)return void(yield{request_id:this.requestId,seen_state:Lt.unseen,status:ot.failed,display_error_message:l,isRetriable:!1});const p=this.baseDelay*2**(e-1);yield{request_id:this.requestId,status:ot.sent,display_error_message:`Service temporarily unavailable. Retrying in ${p/1e3} seconds... (Attempt ${e} of ${this.maxRetries})`,isRetriable:!0},await new Promise(y=>setTimeout(y,p)),yield{request_id:this.requestId,status:ot.sent,display_error_message:"Generating response...",isRetriable:!0}}this._isCancelled&&(yield this.createCancelledStatus())}catch(i){yield{request_id:this.requestId,seen_state:Lt.unseen,status:ot.failed,display_error_message:i instanceof Error?i.message:String(i)}}}createCancelledStatus(){return{request_id:this.requestId,seen_state:Lt.unseen,status:ot.cancelled}}}function me(a,e){return e in a&&a[e]!==void 0}function Sc(a){return me(a,"file")}function ga(a){return me(a,"recentFile")}function Cc(a){return me(a,"folder")}function pa(a){return me(a,"sourceFolder")}function Qf(a){return me(a,"sourceFolderGroup")}function cc(a){return me(a,"selection")}function wc(a){return me(a,"externalSource")}function tg(a){return me(a,"allDefaultContext")}function eg(a){return me(a,"clearContext")}function lc(a){return me(a,"userGuidelines")}function ng(a){return me(a,"agentMemories")}function Aa(a){return me(a,"personality")}const sg={allDefaultContext:!0,label:"Default Context",id:"allDefaultContext"},rg={clearContext:!0,label:"Clear Context",id:"clearContext"},ig={userGuidelines:{enabled:!1,overLimit:!1,contents:"",lengthLimit:2e3},label:"User Guidelines",id:"userGuidelines"},tf={agentMemories:{},label:"Agent Memories",id:"agentMemories"},hc=[{personality:{type:Ut.DEFAULT,description:"Expert software engineer - trusted coding agent, at your service!"},label:"Agent Auggie",name:"auggie-personality-agent-default",id:"auggie-personality-agent-default"},{personality:{type:Ut.PROTOTYPER,description:"Fast and loose - let's get it done, boss!"},label:"Prototyper Auggie",name:"auggie-personality-prototyper",id:"auggie-personality-prototyper"},{personality:{type:Ut.BRAINSTORM,description:"Thoughtful and creative - thinking through all possibilities..."},label:"Brainstorm Auggie",name:"auggie-personality-brainstorm",id:"auggie-personality-brainstorm"},{personality:{type:Ut.REVIEWER,description:"Code detective - finding issues and analyzing implications"},label:"Reviewer Auggie",name:"auggie-personality-reviewer",id:"auggie-personality-reviewer"}];function ag(a){return me(a,"group")}function og(a){const e=new Map;return a.forEach(s=>{Sc(s)?e.set("file",[...e.get("file")??[],s]):ga(s)?e.set("recentFile",[...e.get("recentFile")??[],s]):Cc(s)?e.set("folder",[...e.get("folder")??[],s]):wc(s)?e.set("externalSource",[...e.get("externalSource")??[],s]):pa(s)?e.set("sourceFolder",[...e.get("sourceFolder")??[],s]):Aa(s)&&e.set("personality",[...e.get("personality")??[],s])}),[{label:"Personalities",id:"personalities",group:{type:"personality",materialIcon:"person",items:e.get("personality")??[]}},{label:"Files",id:"files",group:{type:"file",materialIcon:"insert_drive_file",items:e.get("file")??[]}},{label:"Folders",id:"folders",group:{type:"folder",materialIcon:"folder",items:e.get("folder")??[]}},{label:"Source Folders",id:"sourceFolders",group:{type:"sourceFolder",materialIcon:"folder_managed",items:e.get("sourceFolder")??[]}},{label:"Recently Opened Files",id:"recentlyOpenedFiles",group:{type:"recentFile",materialIcon:"insert_drive_file",items:e.get("recentFile")??[]}},{label:"Documentation",id:"externalSources",group:{type:"externalSource",materialIcon:"link",items:e.get("externalSource")??[]}}].filter(s=>s.group.items.length>0)}function Dr(a){const e={label:Xd(a.pathName).split("/").filter(s=>s.trim()!=="").pop()||"",name:a.pathName,id:Yd({rootPath:a.repoRoot,relPath:a.pathName})};if(a.fullRange){const s=`:L${a.fullRange.startLineNumber}-${a.fullRange.endLineNumber}`;e.label+=s,e.name+=s,e.id+=s}else if(a.range){const s=`:L${a.range.start}-${a.range.stop}`;e.label+=s,e.name+=s,e.id+=s}return e}class ef{constructor(e,s,i){d(this,"getChatInitData",async()=>(await this._asyncMsgSender.send({type:T.chatLoaded},3e4)).data);d(this,"reportWebviewClientEvent",e=>{this._asyncMsgSender.send({type:T.reportWebviewClientMetric,data:{webviewName:zd.chat,client_metric:e,value:1}})});d(this,"reportAgentSessionEvent",e=>{this._asyncMsgSender.sendToSidecar({type:Ie.reportAgentSessionEvent,data:e})});d(this,"reportAgentRequestEvent",e=>{this._asyncMsgSender.sendToSidecar({type:Ie.reportAgentRequestEvent,data:e})});d(this,"getSuggestions",async(e,s=!1)=>{const i={rootPath:"",relPath:e},u=this.findFiles(i,6),l=this.findRecentlyOpenedFiles(i,6),p=this.findFolders(i,3),y=this.findExternalSources(e,s),[v,E,R,O]=await Promise.all([Rr(u,[]),Rr(l,[]),Rr(p,[]),Rr(y,[])]),ut=(V,it)=>({...Dr(V),[it]:V}),J=[...v.map(V=>ut(V,"file")),...R.map(V=>ut(V,"folder")),...E.map(V=>ut(V,"recentFile")),...O.map(V=>({label:V.name,name:V.name,id:V.id,externalSource:V}))];if(this._flags.enablePersonalities){const V=this.getPersonalities(e);V.length>0&&J.push(...V)}return J});d(this,"getPersonalities",e=>{if(!this._flags.enablePersonalities)return[];if(e==="")return hc;const s=e.toLowerCase();return hc.filter(i=>{const u=i.personality.description.toLowerCase(),l=i.label.toLowerCase();return u.includes(s)||l.includes(s)})});d(this,"sendAction",e=>{this._host.postMessage({type:T.mainPanelPerformAction,data:e})});d(this,"showAugmentPanel",()=>{this._asyncMsgSender.send({type:T.showAugmentPanel})});d(this,"openConfirmationModal",async e=>(await this._asyncMsgSender.send({type:T.openConfirmationModal,data:e},1e9)).data.ok);d(this,"clearMetadataFor",e=>{this._host.postMessage({type:T.chatClearMetadata,data:e})});d(this,"resolvePath",async(e,s=void 0)=>{const i=await this._asyncMsgSender.send({type:T.resolveFileRequest,data:{...e,exactMatch:!0,maxResults:1,searchScope:s}},5e3);if(i.data)return i.data});d(this,"resolveSymbols",async(e,s)=>(await this._asyncMsgSender.send({type:T.findSymbolRequest,data:{query:e,searchScope:s}},3e4)).data);d(this,"getDiagnostics",async()=>(await this._asyncMsgSender.send({type:T.getDiagnosticsRequest},1e3)).data);d(this,"findFiles",async(e,s=12)=>(await this._asyncMsgSender.send({type:T.findFileRequest,data:{...e,maxResults:s}},5e3)).data);d(this,"findFolders",async(e,s=12)=>(await this._asyncMsgSender.send({type:T.findFolderRequest,data:{...e,maxResults:s}},5e3)).data);d(this,"findRecentlyOpenedFiles",async(e,s=12)=>(await this._asyncMsgSender.send({type:T.findRecentlyOpenedFilesRequest,data:{...e,maxResults:s}},5e3)).data);d(this,"findExternalSources",async(e,s=!1)=>this._flags.enableExternalSourcesInChat?s?[]:(await this._asyncMsgSender.send({type:T.findExternalSourcesRequest,data:{query:e,source_types:[]}},5e3)).data.sources??[]:[]);d(this,"openFile",e=>{this._host.postMessage({type:T.openFile,data:e})});d(this,"openMemoriesFile",()=>{this._host.postMessage({type:T.openMemoriesFile})});d(this,"createFile",(e,s)=>{this._host.postMessage({type:T.chatCreateFile,data:{code:e,relPath:s}})});d(this,"openScratchFile",async(e,s="shellscript")=>{await this._asyncMsgSender.send({type:T.openScratchFileRequest,data:{content:e,language:s}},1e4)});d(this,"resolveWorkspaceFileChunk",async e=>{try{return(await this._asyncMsgSender.send({type:T.resolveWorkspaceFileChunkRequest,data:e},5e3)).data}catch{return}});d(this,"smartPaste",e=>{this._host.postMessage({type:T.chatSmartPaste,data:e})});d(this,"saveChat",async(e,s,i)=>this._asyncMsgSender.send({type:T.saveChat,data:{conversationId:e,chatHistory:s,title:i}}));d(this,"launchAutofixPanel",async(e,s,i)=>this._asyncMsgSender.send({type:T.chatLaunchAutofixPanel,data:{conversationId:e,iterationId:s,stage:i}}));d(this,"updateUserGuidelines",e=>{this._host.postMessage({type:T.updateUserGuidelines,data:e})});d(this,"openSettingsPage",e=>{this._host.postMessage({type:T.openSettingsPage,data:e})});d(this,"_activeRetryStreams",new Map);d(this,"cancelChatStream",async e=>{var s;(s=this._activeRetryStreams.get(e))==null||s.cancel(),await this._asyncMsgSender.send({type:T.chatUserCancel,data:{requestId:e}},1e4)});d(this,"sendUserRating",async(e,s,i,u="")=>{const l={requestId:e,rating:i,note:u,mode:s?ac.agent:ac.chat},p={type:T.chatRating,data:l};return(await this._asyncMsgSender.send(p,3e4)).data});d(this,"triggerUsedChatMetric",()=>{this._host.postMessage({type:T.usedChat})});d(this,"createProject",e=>{this._host.postMessage({type:T.mainPanelCreateProject,data:{name:e}})});d(this,"openProjectFolder",()=>{this._host.postMessage({type:T.mainPanelPerformAction,data:"open-folder"})});d(this,"closeProjectFolder",()=>{this._host.postMessage({type:T.mainPanelPerformAction,data:"close-folder"})});d(this,"cloneRepository",()=>{this._host.postMessage({type:T.mainPanelPerformAction,data:"clone-repository"})});d(this,"grantSyncPermission",()=>{this._host.postMessage({type:T.mainPanelPerformAction,data:"grant-sync-permission"})});d(this,"callTool",async(e,s,i,u,l,p)=>{const y={type:T.callTool,data:{chatRequestId:e,toolUseId:s,name:i,input:u,chatHistory:l,conversationId:p}};return(await this._asyncMsgSender.send(y,0)).data});d(this,"cancelToolRun",async(e,s)=>{const i={type:T.cancelToolRun,data:{requestId:e,toolUseId:s}};await this._asyncMsgSender.send(i,0)});d(this,"checkSafe",async(e,s)=>{const i={type:T.toolCheckSafe,data:{name:e,input:s}};return(await this._asyncMsgSender.send(i,0)).data.isSafe});d(this,"closeAllToolProcesses",async()=>{await this._asyncMsgSender.sendToSidecar({type:oc.closeAllToolProcesses},0)});d(this,"getToolIdentifier",async e=>{const s={type:oc.getToolIdentifierRequest,data:{toolName:e}};return(await this._asyncMsgSender.sendToSidecar(s,0)).data});d(this,"executeCommand",async(e,s,i)=>{try{const u=await this._asyncMsgSender.send({type:T.chatAutofixExecuteCommandRequest,data:{iterationId:e,command:s,args:i}},6e5);return{output:u.data.output,returnCode:u.data.returnCode}}catch(u){throw console.error("[ExtensionClient] Execute command failed:",u),u}});d(this,"sendAutofixStateUpdate",async e=>{await this._asyncMsgSender.send({type:T.chatAutofixStateUpdate,data:e})});d(this,"autofixPlan",async(e,s)=>(await this._asyncMsgSender.send({type:T.chatAutofixPlanRequest,data:{command:e,steeringHistory:s}},6e4)).data.plan);d(this,"setChatMode",e=>{this._asyncMsgSender.send({type:T.chatModeChanged,data:{mode:e}})});d(this,"getAgentEditList",async(e,s)=>{const i={type:Ie.getEditListRequest,data:{fromTimestamp:e,toTimestamp:s}};return(await this._asyncMsgSender.sendToSidecar(i,3e4)).data});d(this,"hasChangesSince",async e=>{const s={type:Ie.getEditListRequest,data:{fromTimestamp:e,toTimestamp:Number.MAX_SAFE_INTEGER}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data.edits.filter(i=>{var u,l;return((u=i.changesSummary)==null?void 0:u.totalAddedLines)||((l=i.changesSummary)==null?void 0:l.totalRemovedLines)}).length>0});d(this,"getToolCallCheckpoint",async e=>{const s={type:T.getToolCallCheckpoint,data:{requestId:e}};return(await this._asyncMsgSender.send(s,3e4)).data.checkpointNumber});d(this,"setCurrentConversation",e=>{this._asyncMsgSender.sendToSidecar({type:Ie.setCurrentConversation,data:{conversationId:e}})});d(this,"showAgentReview",(e,s,i,u=!0)=>{this._asyncMsgSender.sendToSidecar({type:Ie.chatReviewAgentFile,data:{qualifiedPathName:e,fromTimestamp:s,toTimestamp:i,retainFocus:u}})});d(this,"acceptAllAgentEdits",async()=>(await this._asyncMsgSender.sendToSidecar({type:Ie.chatAgentEditAcceptAll}),!0));d(this,"revertToTimestamp",async(e,s)=>(await this._asyncMsgSender.sendToSidecar({type:Ie.revertToTimestamp,data:{timestamp:e,qualifiedPathNames:s}}),!0));d(this,"getAgentOnboardingPrompt",async()=>(await this._asyncMsgSender.send({type:T.chatGetAgentOnboardingPromptRequest,data:{}},3e4)).data.prompt);d(this,"getAgentEditChangesByRequestId",async e=>{const s={type:Ie.getEditChangesByRequestIdRequest,data:{requestId:e}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data});d(this,"getAgentEditContentsByRequestId",async e=>{const s={type:Ie.getAgentEditContentsByRequestId,data:{requestId:e}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data});d(this,"triggerInitialOrientation",()=>{this._host.postMessage({type:T.triggerInitialOrientation})});d(this,"getWorkspaceInfo",async()=>{try{return(await this._asyncMsgSender.send({type:T.getWorkspaceInfoRequest},5e3)).data}catch(e){return console.error("Error getting workspace info:",e),{}}});d(this,"checkAgentAutoModeApproval",async()=>(await this._asyncMsgSender.send({type:T.checkAgentAutoModeApproval},5e3)).data);d(this,"setAgentAutoModeApproved",async e=>{await this._asyncMsgSender.send({type:T.setAgentAutoModeApproved,data:e},5e3)});d(this,"checkHasEverUsedAgent",async()=>(await this._asyncMsgSender.sendToSidecar({type:Ie.checkHasEverUsedAgent},5e3)).data);d(this,"setHasEverUsedAgent",async e=>{await this._asyncMsgSender.sendToSidecar({type:Ie.setHasEverUsedAgent,data:e},5e3)});d(this,"getChatRequestIdeState",async()=>{const e={type:T.getChatRequestIdeStateRequest};return(await this._asyncMsgSender.send(e,3e4)).data});d(this,"reportError",e=>{this._host.postMessage({type:T.reportError,data:e})});this._host=e,this._asyncMsgSender=s,this._flags=i}async*generateCommitMessage(){const e={type:T.generateCommitMessage},s=this._asyncMsgSender.stream(e,3e4,6e4);yield*ha(s)}async*sendInstructionMessage(e,s){const i={instruction:e.request_message??"",selectedCodeDetails:s,requestId:e.request_id},u={type:T.chatInstructionMessage,data:i},l=this._asyncMsgSender.stream(u,3e4,6e4);yield*async function*(p){let y;try{for await(const v of p)y=v.data.requestId,yield{request_id:y,response_text:v.data.text,seen_state:Lt.unseen,status:ot.sent};yield{request_id:y,seen_state:Lt.unseen,status:ot.success}}catch{yield{request_id:y,seen_state:Lt.unseen,status:ot.failed}}}(l)}async openGuidelines(e){this._host.postMessage({type:T.openGuidelines,data:e})}async*getExistingChatStream(e,s){if(!e.request_id)return;const i=s==null?void 0:s.flags.enablePreferenceCollection,u=i?1e9:6e4,l=i?1e9:3e5,p={type:T.chatGetStreamRequest,data:{requestId:e.request_id}},y=this._asyncMsgSender.stream(p,u,l);yield*ha(y,this.reportError)}async*startChatStream(e,s){const i=s==null?void 0:s.flags.enablePreferenceCollection,u=i?1e9:6e4,l=i?1e9:3e5,p={type:T.chatUserMessage,data:e},y=this._asyncMsgSender.stream(p,u,l);yield*ha(y,this.reportError)}async checkToolExists(e){return(await this._asyncMsgSender.send({type:T.checkToolExists,toolName:e},0)).exists}async saveImage(e,s){const i=new Uint8Array(await e.arrayBuffer()),u=s??`${await Bd(i)}.${e.name.split(".").at(-1)}`;return(await this._asyncMsgSender.send({type:T.chatSaveImageRequest,data:{filename:u,data:i}},1e4)).data}async loadImage(e){const s=(await this._asyncMsgSender.send({type:T.chatLoadImageRequest,data:e},1e4)).data;if(!s)return;let i="application/octet-stream";const u=e.split(".").at(-1);u==="png"?i="image/png":u!=="jpg"&&u!=="jpeg"||(i="image/jpeg");const l=new File([s],e,{type:i});return await Wd(l)}async deleteImage(e){await this._asyncMsgSender.send({type:T.chatDeleteImageRequest,data:e},1e4)}async*startChatStreamWithRetry(e,s,i){const u=new Qd(e,s,(l,p)=>this.startChatStream(l,p),(i==null?void 0:i.maxRetries)??5,4e3,i==null?void 0:i.flags);this._activeRetryStreams.set(e,u);try{yield*u.getStream()}finally{this._activeRetryStreams.delete(e)}}}async function*ha(a,e=()=>{}){let s;try{for await(const i of a){if(s=i.data.requestId,i.type===T.chatModelReplyFailed)return yield{request_id:s,seen_state:Lt.unseen,status:ot.failed,display_error_message:i.displayErrorMessage,isRetriable:i.isRetriable};yield{request_id:s,response_text:i.data.text,workspace_file_chunks:i.data.workspaceFileChunks,structured_output_nodes:nf(i.data.nodes),seen_state:Lt.unseen,status:ot.sent}}yield{request_id:s,seen_state:Lt.unseen,status:ot.success}}catch(i){e({originalRequestId:s||"",sanitizedMessage:i instanceof Error?i.message:String(i),stackTrace:i instanceof Error&&i.stack||"",diagnostics:[{key:"error_class",value:"Extension-WebView Error"}]}),yield{request_id:s,seen_state:Lt.unseen,status:ot.failed}}}async function Rr(a,e){try{return await a}catch(s){return console.warn(`Error while resolving promise: ${s}`),e}}function nf(a){if(!a)return a;let e=!1;return a.filter(s=>s.type!==re.TOOL_USE||!e&&(e=!0,!0))}function sf(a){var e;return((e=a.extraData)==null?void 0:e.isAutofix)===!0}function ss(a){var e;return((e=a.extraData)==null?void 0:e.isAgentConversation)===!0}var kt=(a=>(a[a.active=0]="active",a[a.inactive=1]="inactive",a))(kt||{}),rf=(a=>(a.normal="Normal",a.autofixCommand="AutofixCommand",a.autofixPrompt="AutofixPrompt",a))(rf||{});const xc=25e4;class af{constructor(e){d(this,"_enableEditableHistory",!1);d(this,"_enablePreferenceCollection",!1);d(this,"_enableRetrievalDataCollection",!1);d(this,"_enableDebugFeatures",!1);d(this,"_enableRichTextHistory",!1);d(this,"_modelDisplayNameToId",{});d(this,"_fullFeatured",!0);d(this,"_enableExternalSourcesInChat",!1);d(this,"_smallSyncThreshold",15);d(this,"_bigSyncThreshold",1e3);d(this,"_enableSmartPaste",!1);d(this,"_enableDirectApply",!1);d(this,"_summaryTitles",!1);d(this,"_suggestedEditsAvailable",!1);d(this,"_enableShareService",!1);d(this,"_maxTrackableFileCount",xc);d(this,"_enableDesignSystemRichTextEditor",!1);d(this,"_enableSources",!1);d(this,"_enableChatMermaidDiagrams",!1);d(this,"_smartPastePrecomputeMode",vc.visibleHover);d(this,"_useNewThreadsMenu",!1);d(this,"_enableChatMermaidDiagramsMinVersion",!1);d(this,"_idleNewSessionNotificationTimeoutMs");d(this,"_idleNewSessionMessageTimeoutMs");d(this,"_enableChatMultimodal",!1);d(this,"_enableAgentMode",!1);d(this,"_enableRichCheckpointInfo",!1);d(this,"_agentMemoriesFilePathName");d(this,"_userTier","unknown");d(this,"_eloModelConfiguration",{highPriorityModels:[],regularBattleModels:[],highPriorityThreshold:.5});d(this,"_truncateChatHistory",!1);d(this,"_enableBackgroundAgents",!1);d(this,"_enableVirtualizedMessageList",!1);d(this,"_customPersonalityPrompts",{});d(this,"_enablePersonalities",!1);d(this,"_memoryClassificationOnFirstToken",!1);d(this,"_subscribers",new Set);d(this,"subscribe",e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)}));d(this,"update",e=>{this._enableEditableHistory=e.enableEditableHistory??this._enableEditableHistory,this._enablePreferenceCollection=e.enablePreferenceCollection??this._enablePreferenceCollection,this._enableRetrievalDataCollection=e.enableRetrievalDataCollection??this._enableRetrievalDataCollection,this._enableDebugFeatures=e.enableDebugFeatures??this._enableDebugFeatures,this._enableRichTextHistory=e.enableRichTextHistory??this._enableRichTextHistory,this._modelDisplayNameToId={...e.modelDisplayNameToId},this._fullFeatured=e.fullFeatured??this._fullFeatured,this._enableExternalSourcesInChat=e.enableExternalSourcesInChat??this._enableExternalSourcesInChat,this._smallSyncThreshold=e.smallSyncThreshold??this._smallSyncThreshold,this._bigSyncThreshold=e.bigSyncThreshold??this._bigSyncThreshold,this._enableSmartPaste=e.enableSmartPaste??this._enableSmartPaste,this._enableDirectApply=e.enableDirectApply??this._enableDirectApply,this._summaryTitles=e.summaryTitles??this._summaryTitles,this._suggestedEditsAvailable=e.suggestedEditsAvailable??this._suggestedEditsAvailable,this._enableShareService=e.enableShareService??this._enableShareService,this._maxTrackableFileCount=e.maxTrackableFileCount??this._maxTrackableFileCount,this._enableDesignSystemRichTextEditor=e.enableDesignSystemRichTextEditor??this._enableDesignSystemRichTextEditor,this._enableSources=e.enableSources??this._enableSources,this._enableChatMermaidDiagrams=e.enableChatMermaidDiagrams??this._enableChatMermaidDiagrams,this._smartPastePrecomputeMode=e.smartPastePrecomputeMode??this._smartPastePrecomputeMode,this._useNewThreadsMenu=e.useNewThreadsMenu??this._useNewThreadsMenu,this._enableChatMermaidDiagramsMinVersion=e.enableChatMermaidDiagramsMinVersion??this._enableChatMermaidDiagramsMinVersion,this._idleNewSessionMessageTimeoutMs=e.idleNewSessionMessageTimeoutMs??(e.enableDebugFeatures?this._idleNewSessionMessageTimeoutMs??3e5:this._idleNewSessionMessageTimeoutMs),this._idleNewSessionNotificationTimeoutMs=e.idleNewSessionNotificationTimeoutMs??0,this._enableChatMultimodal=e.enableChatMultimodal??this._enableChatMultimodal,this._enableAgentMode=e.enableAgentMode??this._enableAgentMode,this._enableRichCheckpointInfo=e.enableRichCheckpointInfo??this._enableRichCheckpointInfo,this._agentMemoriesFilePathName=e.agentMemoriesFilePathName??this._agentMemoriesFilePathName,this._userTier=e.userTier??this._userTier,this._eloModelConfiguration=e.eloModelConfiguration??this._eloModelConfiguration,this._truncateChatHistory=e.truncateChatHistory??this._truncateChatHistory,this._enableBackgroundAgents=e.enableBackgroundAgents??this._enableBackgroundAgents,this._enableVirtualizedMessageList=e.enableVirtualizedMessageList??this._enableVirtualizedMessageList,this._customPersonalityPrompts=e.customPersonalityPrompts??this._customPersonalityPrompts,this._enablePersonalities=e.enablePersonalities??this._enablePersonalities,this._memoryClassificationOnFirstToken=e.memoryClassificationOnFirstToken??this._memoryClassificationOnFirstToken,this._subscribers.forEach(s=>s(this))});d(this,"isModelIdValid",e=>e!==void 0&&Object.values(this._modelDisplayNameToId).includes(e));d(this,"getModelDisplayName",e=>{if(e!==void 0)return Object.keys(this._modelDisplayNameToId).find(s=>this._modelDisplayNameToId[s]===e)});e&&this.update(e)}get enableEditableHistory(){return this._fullFeatured&&(this._enableEditableHistory||this._enableDebugFeatures)}get enablePreferenceCollection(){return this._enablePreferenceCollection}get enableRetrievalDataCollection(){return this._enableRetrievalDataCollection}get enableDebugFeatures(){return this._enableDebugFeatures}get enableGenerateCommitMessage(){return this._enableDebugFeatures}get enableRichTextHistory(){return this._enableRichTextHistory}get modelDisplayNameToId(){return this._modelDisplayNameToId}get orderedModelDisplayNames(){return Object.keys(this._modelDisplayNameToId).sort((e,s)=>{const i=e.toLowerCase(),u=s.toLowerCase();return i==="default"&&u!=="default"?-1:u==="default"&&i!=="default"?1:e.localeCompare(s)})}get fullFeatured(){return this._fullFeatured}get enableExternalSourcesInChat(){return this._enableExternalSourcesInChat}get smallSyncThreshold(){return this._smallSyncThreshold}get bigSyncThreshold(){return this._bigSyncThreshold}get enableSmartPaste(){return this._enableDebugFeatures||this._enableSmartPaste}get enableDirectApply(){return this._enableDirectApply||this._enableDebugFeatures}get enableShareService(){return this._enableShareService}get summaryTitles(){return this._summaryTitles}get suggestedEditsAvailable(){return this._suggestedEditsAvailable}get maxTrackableFileCount(){return this._maxTrackableFileCount}get enableSources(){return this._enableDebugFeatures||this._enableSources}get enableChatMermaidDiagrams(){return this._enableDebugFeatures||this._enableChatMermaidDiagrams}get smartPastePrecomputeMode(){return this._smartPastePrecomputeMode}get useNewThreadsMenu(){return this._useNewThreadsMenu}get enableChatMermaidDiagramsMinVersion(){return this._enableChatMermaidDiagramsMinVersion}get enableDesignSystemRichTextEditor(){return this._enableDesignSystemRichTextEditor}get idleNewSessionNotificationTimeoutMs(){return this._idleNewSessionNotificationTimeoutMs??0}get idleNewSessionMessageTimeoutMs(){return this._idleNewSessionMessageTimeoutMs??0}get enableChatMultimodal(){return this._enableChatMultimodal}get enableAgentMode(){return this._enableAgentMode}get enableRichCheckpointInfo(){return this._enableRichCheckpointInfo}get agentMemoriesFilePathName(){return this._agentMemoriesFilePathName}get userTier(){return this._userTier}get eloModelConfiguration(){return this._eloModelConfiguration}get truncateChatHistory(){return this._truncateChatHistory}get enableBackgroundAgents(){return this._enableBackgroundAgents}get enableVirtualizedMessageList(){return this._enableVirtualizedMessageList||this._enableDebugFeatures}get customPersonalityPrompts(){return this._customPersonalityPrompts}get enablePersonalities(){return this._enablePersonalities||this._enableDebugFeatures}get memoryClassificationOnFirstToken(){return this._memoryClassificationOnFirstToken}}var Ac=(a=>(a[a.unset=0]="unset",a[a.positive=1]="positive",a[a.negative=2]="negative",a))(Ac||{}),Xt=(a=>(a[a.unknown=0]="unknown",a[a.new=1]="new",a[a.checkingSafety=2]="checkingSafety",a[a.runnable=3]="runnable",a[a.running=4]="running",a[a.completed=5]="completed",a[a.error=6]="error",a[a.cancelling=7]="cancelling",a[a.cancelled=8]="cancelled",a))(Xt||{});function da(a){return a.requestId+";"+a.toolUseId}function dc(a){const[e,s]=a.split(";");return{requestId:e,toolUseId:s}}function ug(a,e){return a==null?e:typeof a=="string"?a:e}const cg=async(a,e)=>{if(!ss(a)||e.chatItemType!==void 0||!(e!=null&&e.request_message))return;const s=Gd.create();s.setFlag(Gt.start);try{await of(a,e,s)}catch(i){s.setFlag(Gt.exceptionThrown),console.error("Failed to classify and distill memories",i)}finally{s.setFlag(Gt.end),a.extensionClient.reportAgentSessionEvent({eventName:bc.classifyAndDistill,conversationId:a.id,eventData:{classifyAndDistillData:s}})}},of=async(a,e,s)=>{const i=crypto.randomUUID();s.setRequestId(Gt.memoriesRequestId,i);const u=Ms(a).id;s.setFlag(Gt.startSendSilentExchange);const{responseText:l,requestId:p}=await a.sendSilentExchange({request_message:e.request_message,disableRetrieval:!0,disableHistory:!1,disableSelectedCodeDetails:!0,memoriesInfo:{isClassifyAndDistill:!0}});if(s.setStringStats(Gt.sendSilentExchangeResponseStats,l),p?s.setRequestId(Gt.sendSilentExchangeRequestId,p):s.setFlag(Gt.noRequestId),Ms(a).id!==u)return void s.setFlag(Gt.conversationChanged);let y;try{y=JSON.parse(l)}catch{throw s.setFlag(Gt.invalidResponse),new Error("Invalid response from classify and distill")}if(typeof y.explanation!="string"||typeof y.content!="string"||typeof y.worthRemembering!="boolean")throw s.setFlag(Gt.invalidResponse),new Error("Invalid response from classify and distill");s.setStringStats(Gt.explanationStats,y.explanation),s.setStringStats(Gt.contentStats,y.content),s.setFlag(Gt.worthRemembering,y.worthRemembering);const v=y.worthRemembering?y.content:void 0;v&&cf(a,v,i,s)},lg=a=>{var i;const e=a.chatHistory.at(-1);if(!e||!_e(e))return Pn.notRunning;if(!(e.status===ot.success||e.status===ot.failed||e.status===ot.cancelled))return Pn.running;const s=(((i=e.structured_output_nodes)==null?void 0:i.filter(u=>u.type===re.TOOL_USE&&!!u.tool_use))??[]).at(-1);if(!s)return Pn.notRunning;switch(a.getToolUseState(e.request_id,s.tool_use.tool_use_id).phase){case Xt.runnable:return Pn.awaitingUserAction;case Xt.cancelled:return Pn.notRunning;default:return Pn.running}},_a=a=>_e(a)&&!!a.request_message,Hr=a=>a.chatHistory.findLast(e=>_a(e)),hg=a=>{const e=Hr(a);if(e!=null&&e.structured_output_nodes){const s=e.structured_output_nodes.find(i=>i.type===re.AGENT_MEMORY);if(s)try{const{memoriesRequestId:i,memory:u}=JSON.parse(s.content);return{memoriesRequestId:i,memory:u}}catch(i){return void console.error("Failed to parse JSON from agent memory node",i)}}},dg=a=>uf(a,e=>{var s;return!!((s=e.structured_output_nodes)!=null&&s.some(i=>{var u;return i.type===re.TOOL_USE&&((u=i.tool_use)==null?void 0:u.tool_name)==="remember"}))}).length>0,uf=(a,e)=>{const s=Hr(a);return s!=null&&s.request_id?a.historyFrom(s.request_id,!0).filter(i=>_e(i)&&(!e||e(i))):[]},fg=a=>{var i;const e=a.chatHistory.at(-1);if(!(e!=null&&e.request_id)||!_e(e))return!1;const s=((i=e.structured_output_nodes)==null?void 0:i.filter(u=>u.type===re.TOOL_USE))??[];for(const u of s)if(u.tool_use&&a.getToolUseState(e.request_id,u.tool_use.tool_use_id).phase===Xt.runnable)return a.updateToolUseState({requestId:e.request_id,toolUseId:u.tool_use.tool_use_id,phase:Xt.cancelled}),!0;return!1},cf=(a,e,s,i)=>{const u=JSON.stringify({memoriesRequestId:s,memory:e}),l=Hr(a);l!=null&&l.request_id?(i.setRequestId(Gt.lastUserExchangeRequestId,l.request_id),a.updateChatItem(l.request_id,{...l,structured_output_nodes:[...l.structured_output_nodes??[],{id:0,type:re.AGENT_MEMORY,content:u}]})):i.setFlag(Gt.noLastUserExchangeRequestId)},gg=(a,e)=>{const s=Hr(a);if(!(s!=null&&s.request_id)||s.request_id!==e)return!1;const i=(s.structured_output_nodes||[]).filter(u=>u.type!==re.AGENT_MEMORY);return i.length!==(s.structured_output_nodes||[]).length&&(a.updateChatItem(e,{...s,structured_output_nodes:i}),!0)};function lf(a,e){const s=a.customPersonalityPrompts;if(s)switch(e){case Ut.DEFAULT:if(s.agent&&s.agent.trim()!=="")return s.agent;break;case Ut.PROTOTYPER:if(s.prototyper&&s.prototyper.trim()!=="")return s.prototyper;break;case Ut.BRAINSTORM:if(s.brainstorm&&s.brainstorm.trim()!=="")return s.brainstorm;break;case Ut.REVIEWER:if(s.reviewer&&s.reviewer.trim()!=="")return s.reviewer}return hf[e]}const hf={[Ut.DEFAULT]:`
# Agent Auggie Personality Description
You are Augment Agent, an agentic coding AI assistant.
Focus on helping the user with their coding tasks efficiently.

## Rules:
- You have no restrictions on the tools you may use
- Follow the original system instructions
  `,[Ut.PROTOTYPER]:`
# Prototyper Auggie Personality Description
You are Prototyper Auggie, an agentic coding AI assistant focused on building prototypes and visual applications.

## Your approach:
- Be fast and action-oriented
- Implement things quickly to show results
- Open webpages to demonstrate functionality
- Focus on building something visual and interactive
- Use modern frameworks and tools to create working prototypes
- Prioritize getting a working demo over perfect architecture
- Show progress frequently with visual results
- Prefer to act and run tools, rather than asking for permission
- Only ask for permission if there is something potentially very dangerous or irreversible

## Implementation preferences:
- When user does not specify which frameworks to use, default to modern frameworks, e.g. React with vite or next.js
- Initialize projects using CLI tools instead of writing from scratch
- For database and auth, use Supabase as a good default option
- Before using open-browser to show the app, use curl to check for errors
- Remember that modern frameworks have hot reload, so avoid calling open-browser multiple times

## Rules:
- For extremely destructive or irreversible actions, you should ask for permission
- For other tasks, you must proceed without asking for permission
  `,[Ut.BRAINSTORM]:`
# Brainstorm Auggie Personality Description
You are Brainstorm Auggie, an agentic coding AI assistant focused on planning and brainstorming solutions.

## Your approach:
- Be slow, careful, and thorough in your analysis
- Look through all upstream/downstream APIs to understand implications
- Focus on finding a comprehensive plan that solves the user's query
- Do not run commands, create code, or implement solutions directly
- Your job is to be introspective and think deeply about the problem
- Brainstorm multiple approaches and evaluate their tradeoffs
- Consider edge cases and potential issues with each approach

## Planning preferences:
- Analyze the codebase thoroughly before suggesting changes
- Consider multiple implementation options with pros and cons
- Identify potential risks and challenges for each approach
- Create detailed, step-by-step plans for implementation
- Provide reasoning for architectural decisions
- Consider performance, maintainability, and scalability
- Do not execute the plan - your role is to provide guidance only

## Rules:
- Prefer information gathering and non-destructive tools
- Prefer non-destructive and non-modifying tools
- You must never execute code, modify the codebase, or make changes
- Consider using Mermaid diagrams to help visualize complex concepts
- Once you have a proposal, please examine it critically, and do a revision before finalizing
  `,[Ut.REVIEWER]:`
# Reviewer Auggie Personality Description
You are Reviewer Auggie, an agentic coding AI assistant focused on reviewing code changes and identifying potential issues.

## Your approach:
- Act like a code detective to find potential bugs and issues
- Use git commands to analyze changes against the merge base
- Be super inquisitive and look for anything suspicious
- Build a mental model of what is happening in the code change
- Analyze API implications and downstream effects
- Guard the codebase from potential negative side effects
- Focus on understanding the changes from first principles

## Review preferences:
- Use git and GitHub tools to get code history information
- Compare changes against the logical base or merge base
- Look for edge cases and potential bugs
- Analyze API contracts and potential breaking changes
- Consider performance implications
- Check for security vulnerabilities
- Verify test coverage for the changes

## Rules:
- Use git commands and GitHub API to analyze code changes
- Be thorough and methodical in your analysis
- Focus on finding potential issues rather than implementing solutions
- Provide constructive feedback with specific examples
- Consider both the technical implementation and the broader impact
  `};function df(a,e,s=1e3){let i=null,u=0;const l=nn(e),p=()=>{const y=(()=>{const v=Date.now();if(i!==null&&v-u<s)return i;const E=a();return i=E,u=v,E})();l.set(y)};return{subscribe:l.subscribe,resetCache:()=>{i=null,p()},updateStore:p}}class wt{constructor(e,s,i,u){d(this,"_state");d(this,"_subscribers",new Set);d(this,"_focusModel",new $d);d(this,"_onSendExchangeListeners",[]);d(this,"_onNewConversationListeners",[]);d(this,"_onHistoryDeleteListeners",[]);d(this,"_onBeforeChangeConversationListeners",[]);d(this,"_truncatedChatHistory",new pf(8e5,26e4,3));d(this,"_totalCharactersCacheThrottleMs",1e3);d(this,"_totalCharactersStore");d(this,"subscribe",e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)}));d(this,"setConversation",(e,s=!0,i=!0)=>{const u=e.id!==this._state.id;u&&i&&(e.toolUseStates=Object.fromEntries(Object.entries(e.toolUseStates??{}).map(([p,y])=>{if(y.requestId&&y.toolUseId){const{requestId:v,toolUseId:E}=dc(p);return v===y.requestId&&E===y.toolUseId||console.warn("Tool use state key does not match request and tool use IDs. Got key ",p,"but object has ",da(y)),[p,y]}return[p,{...y,...dc(p)}]})),(e=this._notifyBeforeChangeConversation(this._state,e)).lastInteractedAtIso=new Date().toISOString()),s&&u&&this.isValid&&(this.saveDraftActiveContextIds(),this._unloadContextFromConversation(this._state));const l=wt.isEmpty(e);if(u&&l){const p=this._state.draftExchange;p&&(e.draftExchange=p)}return this._state=e,this._focusModel.setItems(this._state.chatHistory.filter(_e)),this._focusModel.initFocusIdx(-1),this._subscribers.forEach(p=>p(this)),this._saveConversation(this._state),u&&(this._loadContextFromConversation(e),this.loadDraftActiveContextIds(),this._onNewConversationListeners.forEach(p=>p())),!0});d(this,"update",e=>{this.setConversation({...this._state,...e}),this._totalCharactersStore.updateStore()});d(this,"toggleIsPinned",()=>{this.update({isPinned:!this.isPinned})});d(this,"setName",e=>{this.update({name:e})});d(this,"setSelectedModelId",e=>{this.update({selectedModelId:e})});d(this,"updateFeedback",(e,s)=>{this.update({feedbackStates:{...this._state.feedbackStates,[e]:s}})});d(this,"updateToolUseState",e=>{this.update({toolUseStates:{...this._state.toolUseStates,[da(e)]:e}})});d(this,"getToolUseState",(e,s)=>e===void 0||s===void 0||this.toolUseStates===void 0?{phase:Xt.unknown,requestId:e??"",toolUseId:s??""}:this.toolUseStates[da({requestId:e,toolUseId:s})]||{phase:Xt.new});d(this,"getLastToolUseState",()=>{var i,u;const e=this.lastExchange;if(!e)return{phase:Xt.unknown};const s=(((i=e==null?void 0:e.structured_output_nodes)==null?void 0:i.filter(l=>l.type===re.TOOL_USE))??[]).at(-1);return s?this.getToolUseState(e.request_id,(u=s.tool_use)==null?void 0:u.tool_use_id):{phase:Xt.unknown}});d(this,"addExchange",e=>{const s=[...this._state.chatHistory,e];let i;_e(e)&&(i=e.request_id?{...this._state.feedbackStates,[e.request_id]:{selectedRating:Ac.unset,feedbackNote:""}}:void 0),this.update({chatHistory:s,...i?{feedbackStates:i}:{},lastUrl:void 0})});d(this,"resetShareUrl",()=>{this.update({lastUrl:void 0})});d(this,"updateExchangeById",(e,s,i=!1)=>{var y;const u=this.exchangeWithRequestId(s);if(u===null)return console.warn("No exchange with this request ID found."),!1;i&&e.response_text!==void 0&&(e.response_text=(u.response_text??"")+(e.response_text??"")),i&&(e.structured_output_nodes=[...u.structured_output_nodes??[],...e.structured_output_nodes??[]]),i&&e.workspace_file_chunks!==void 0&&(e.workspace_file_chunks=[...u.workspace_file_chunks??[],...e.workspace_file_chunks??[]]);const l=(y=(e.structured_output_nodes||[]).find(v=>v.type===re.MAIN_TEXT_FINISHED))==null?void 0:y.content;l&&l!==e.response_text&&(e.response_text=l);let p=this._state.isShareable||ns({...u,...e});return this.update({chatHistory:this.chatHistory.map(v=>v.request_id===s?{...v,...e}:v),isShareable:p}),!0});d(this,"clearMessagesFromHistory",e=>{this.update({chatHistory:this.chatHistory.filter(s=>!s.request_id||!e.has(s.request_id))}),this._extensionClient.clearMetadataFor({requestIds:Array.from(e)})});d(this,"clearHistory",()=>{this._extensionClient.clearMetadataFor({requestIds:this.requestIds}),this.update({chatHistory:[]})});d(this,"clearHistoryFrom",async(e,s=!0)=>{const i=this.historyFrom(e,s),u=i.map(l=>l.request_id).filter(l=>l!==void 0);this.update({chatHistory:this.historyTo(e,!s)}),this._extensionClient.clearMetadataFor({requestIds:u}),i.forEach(l=>{this._onHistoryDeleteListeners.forEach(p=>p(l))})});d(this,"clearMessageFromHistory",e=>{this.update({chatHistory:this.chatHistory.filter(s=>s.request_id!==e)}),this._extensionClient.clearMetadataFor({requestIds:[e]})});d(this,"historyTo",(e,s=!1)=>{const i=this.chatHistory.findIndex(u=>u.request_id===e);return i===-1?[]:this.chatHistory.slice(0,s?i+1:i)});d(this,"historyFrom",(e,s=!0)=>{const i=this.chatHistory.findIndex(u=>u.request_id===e);return i===-1?[]:this.chatHistory.slice(s?i:i+1)});d(this,"resendLastExchange",async()=>{const e=this.lastExchange;if(e&&!this.awaitingReply)return this.resendTurn(e)});d(this,"resendTurn",e=>this.awaitingReply?Promise.resolve():(this._removeTurn(e),this.sendExchange({request_message:e.request_message,rich_text_json_repr:e.rich_text_json_repr,status:ot.draft,mentioned_items:e.mentioned_items,structured_request_nodes:e.structured_request_nodes})));d(this,"_removeTurn",e=>{this.update({chatHistory:this.chatHistory.filter(s=>s!==e&&(!e.request_id||s.request_id!==e.request_id))})});d(this,"exchangeWithRequestId",e=>this.chatHistory.find(s=>s.request_id===e)||null);d(this,"resetTotalCharactersCache",()=>{this._totalCharactersStore.resetCache()});d(this,"markSeen",async e=>{if(!e.request_id||!this.chatHistory.find(i=>i.request_id===e.request_id))return;const s={seen_state:Lt.seen};this.update({chatHistory:this.chatHistory.map(i=>i.request_id===e.request_id?{...i,...s}:i)})});d(this,"createStructuredRequestNodes",e=>this._jsonToStructuredRequest(e));d(this,"saveDraftMentions",e=>{if(!this.draftExchange)return;const s=e.filter(i=>!i.personality);this.update({draftExchange:{...this.draftExchange,mentioned_items:s}})});d(this,"saveDraftActiveContextIds",()=>{const e=this._specialContextInputModel.recentActiveItems.map(s=>s.id);this.update({draftActiveContextIds:e})});d(this,"loadDraftActiveContextIds",()=>{const e=new Set(this.draftActiveContextIds??[]),s=this._specialContextInputModel.recentItems.filter(u=>e.has(u.id)||u.recentFile||u.selection||u.sourceFolder),i=this._specialContextInputModel.recentItems.filter(u=>!(e.has(u.id)||u.recentFile||u.selection||u.sourceFolder));this._specialContextInputModel.markItemsActive(s.reverse()),this._specialContextInputModel.markItemsInactive(i.reverse())});d(this,"saveDraftExchange",(e,s)=>{var p,y,v;const i=e!==((p=this.draftExchange)==null?void 0:p.request_message),u=s!==((y=this.draftExchange)==null?void 0:y.rich_text_json_repr);if(!i&&!u)return;const l=(v=this.draftExchange)==null?void 0:v.mentioned_items;this.update({draftExchange:{request_message:e,rich_text_json_repr:s,mentioned_items:l,status:ot.draft}})});d(this,"clearDraftExchange",()=>{const e=this.draftExchange;return this.update({draftExchange:void 0}),e});d(this,"sendDraftExchange",()=>{if(this._extensionClient.triggerUsedChatMetric(),!this.canSendDraft||!this.draftExchange)return!1;const e=this.clearDraftExchange();if(!e)return!1;const s=this._chatFlagModel.enableChatMultimodal&&e.rich_text_json_repr?this._jsonToStructuredRequest(e.rich_text_json_repr):void 0;return this.sendExchange({...e,structured_request_nodes:s,model_id:this.selectedModelId??void 0}).then(()=>{var p,y;const i=!this.name&&this.chatHistory.length===1&&((p=this.firstExchange)==null?void 0:p.request_id)===this.chatHistory[0].request_id,u=ss(this)&&((y=this._state.extraData)==null?void 0:y.hasAgentOnboarded)&&(l=this.chatHistory,l.filter(v=>_a(v))).length===2;var l;this._chatFlagModel.summaryTitles&&(i||u)&&this.updateConversationTitle()}).finally(()=>{var i;ss(this)&&this._extensionClient.reportAgentRequestEvent({eventName:Vd.sentUserMessage,conversationId:this.id,requestId:((i=this.lastExchange)==null?void 0:i.request_id)??"UNKNOWN_REQUEST_ID",chatHistoryLength:this.chatHistory.length})}),this.focusModel.setFocusIdx(void 0),!0});d(this,"cancelMessage",async()=>{var e;this.canCancelMessage&&((e=this.lastExchange)!=null&&e.request_id)&&(this.updateExchangeById({status:ot.cancelled},this.lastExchange.request_id),await this._extensionClient.cancelChatStream(this.lastExchange.request_id))});d(this,"sendInstructionExchange",async(e,s)=>{let i=`temp-fe-${crypto.randomUUID()}`;const u={status:ot.sent,request_id:i,request_message:e,model_id:this.selectedModelId??void 0,structured_output_nodes:[],seen_state:Lt.unseen,timestamp:new Date().toISOString()};this.addExchange(u);for await(const l of this._extensionClient.sendInstructionMessage(u,s)){if(!this.updateExchangeById(l,i,!0))return;i=l.request_id||i}});d(this,"updateConversationTitle",async()=>{const{responseText:e}=await this.sendSummaryExchange();this.update({name:e})});d(this,"sendSummaryExchange",()=>{const e={status:ot.sent,request_message:"Please provide a clear and concise summary of our conversation so far. The summary must be less than 6 words long. The summary must contain the key points of the conversation. The summary must be in the form of a title which will represent the conversation. The response should not include any additional formatting such as wrapping the response with quotation marks.",model_id:this.selectedModelId??void 0,chatItemType:es.summaryTitle,disableRetrieval:!0};return this.sendSilentExchange(e)});d(this,"generateCommitMessage",async()=>{let e=`temp-fe-${crypto.randomUUID()}`;const s={status:ot.sent,request_id:e,request_message:"Please generate a commit message based on the diff of my staged and unstaged changes.",model_id:this.selectedModelId??void 0,mentioned_items:[],seen_state:Lt.unseen,chatItemType:es.generateCommitMessage,disableSelectedCodeDetails:!0,disableHistory:!0,timestamp:new Date().toISOString()};this.addExchange(s);for await(const i of this._extensionClient.generateCommitMessage()){if(!this.updateExchangeById(i,e,!0))return;e=i.request_id||e}});d(this,"sendExchange",async e=>{var l;this.updateLastInteraction();let s=`temp-fe-${crypto.randomUUID()}`,i=this._chatFlagModel.isModelIdValid(e.model_id)?e.model_id:void 0;e=await this._addIdeStateNode(fc(e));const u={status:ot.sent,request_id:s,request_message:e.request_message,rich_text_json_repr:e.rich_text_json_repr,model_id:i,mentioned_items:e.mentioned_items,structured_output_nodes:e.structured_output_nodes,seen_state:Lt.unseen,chatItemType:e.chatItemType,disableSelectedCodeDetails:e.disableSelectedCodeDetails,disableHistory:e.disableHistory,structured_request_nodes:e.structured_request_nodes,timestamp:new Date().toISOString()};this.addExchange(u),this._loadContextFromExchange(u),this._onSendExchangeListeners.forEach(p=>p(u));for await(const p of this.sendUserMessage(s,u)){if(((l=this.exchangeWithRequestId(s))==null?void 0:l.status)!==ot.sent||!this.updateExchangeById(p,s,!0))return;s=p.request_id||s}});d(this,"sendSuggestedQuestion",e=>{this.sendExchange({request_message:e,status:ot.draft}),this._extensionClient.triggerUsedChatMetric(),this._extensionClient.reportWebviewClientEvent(Zd.chatUseSuggestedQuestion)});d(this,"recoverAllExchanges",async()=>{await Promise.all(this.recoverableExchanges.map(this.recoverExchange))});d(this,"recoverExchange",async e=>{var u;if(!e.request_id||e.status!==ot.sent)return;let s=e.request_id;const i=(u=e.structured_output_nodes)==null?void 0:u.filter(l=>l.type===re.AGENT_MEMORY);this.updateExchangeById({...e,response_text:"",structured_output_nodes:i??[]},s);for await(const l of this.getChatStream(e)){if(!this.updateExchangeById(l,s,!0))return;s=l.request_id||s}});d(this,"_loadContextFromConversation",e=>{e.chatHistory.forEach(s=>{_e(s)&&this._loadContextFromExchange(s)})});d(this,"_loadContextFromExchange",e=>{e.mentioned_items&&(this._specialContextInputModel.updateItems(e.mentioned_items,[]),this._specialContextInputModel.markItemsActive(e.mentioned_items))});d(this,"_unloadContextFromConversation",e=>{e.chatHistory.forEach(s=>{_e(s)&&this._unloadContextFromExchange(s)})});d(this,"_unloadContextFromExchange",e=>{e.mentioned_items&&this._specialContextInputModel.updateItems([],e.mentioned_items)});d(this,"updateLastInteraction",()=>{this.update({lastInteractedAtIso:new Date().toISOString()})});d(this,"_jsonToStructuredRequest",e=>{const s=[],i=l=>{var y;const p=s.at(-1);if((p==null?void 0:p.type)===$t.TEXT){const v=((y=p.text_node)==null?void 0:y.content)??"",E={...p,text_node:{content:v+l}};s[s.length-1]=E}else s.push({id:s.length,type:$t.TEXT,text_node:{content:l}})},u=l=>{var p,y,v,E;if(l.type==="doc"||l.type==="paragraph")for(const R of l.content??[])u(R);else if(l.type==="hardBreak")i(`
`);else if(l.type==="text")i(l.text??"");else if(l.type==="image"){if(typeof((p=l.attrs)==null?void 0:p.src)!="string")return void console.error("Image source is not a string: ",(y=l.attrs)==null?void 0:y.src);if(l.attrs.isLoading)return;const R=(v=l.attrs)==null?void 0:v.title,O=this._fileNameToImageFormat(R);s.push({id:s.length,type:$t.IMAGE_ID,image_id_node:{image_id:l.attrs.src,format:O}})}else if(l.type==="mention"){const R=(E=l.attrs)==null?void 0:E.data;R&&Aa(R)?s.push({id:s.length,type:$t.TEXT,text_node:{content:lf(this._chatFlagModel,R.personality.type)}}):i(`@${R==null?void 0:R.name}`)}};return u(e),s});this._extensionClient=e,this._chatFlagModel=s,this._specialContextInputModel=i,this._saveConversation=u,this._state={...wt.create()},this._totalCharactersStore=this._createTotalCharactersStore()}_createTotalCharactersStore(){return df(()=>{let e=0;const s=this._state.chatHistory;return this._convertHistoryToExchanges(s).forEach(i=>{e+=JSON.stringify(i).length}),this._state.draftExchange&&(e+=JSON.stringify(this._state.draftExchange).length),e},0,this._totalCharactersCacheThrottleMs)}async decidePersonaType(){var e;try{return(((e=(await this._extensionClient.getWorkspaceInfo()).trackedFileCount)==null?void 0:e.reduce((i,u)=>i+u,0))||0)<=4?Ut.PROTOTYPER:Ut.DEFAULT}catch(s){return console.error("Error determining persona type:",s),Ut.DEFAULT}}static create(e={}){const s=new Date().toISOString();return{id:crypto.randomUUID(),name:void 0,createdAtIso:s,lastInteractedAtIso:s,chatHistory:[],feedbackStates:{},toolUseStates:{},draftExchange:void 0,draftActiveContextIds:void 0,selectedModelId:void 0,requestIds:[],isPinned:!1,lastUrl:void 0,isShareable:!1,extraData:{},personaType:Ut.DEFAULT,...e}}static toSentenceCase(e){return e.charAt(0).toUpperCase()+e.slice(1)}static getDisplayName(e){var u;const s=this._filterToExchanges(e);let i;return i=sf(e)?"Autofix Chat":ss(e)?"New Agent":"New Chat",wt.toSentenceCase(e.name||((u=s[0])==null?void 0:u.request_message)||i)}static _filterToExchanges(e){return e.chatHistory.filter(s=>_e(s))}static isEmpty(e){var s;return e.chatHistory.filter(i=>_e(i)).length===0&&!((s=e.draftExchange)!=null&&s.request_message)}static isNamed(e){return e.name!==void 0&&e.name!==""}static getTime(e,s){return s==="lastMessageTimestamp"?wt.lastMessageTimestamp(e):s==="lastInteractedAt"?wt.lastInteractedAt(e):wt.createdAt(e)}static createdAt(e){return new Date(e.createdAtIso)}static lastInteractedAt(e){return new Date(e.lastInteractedAtIso)}static lastMessageTimestamp(e){const s=this._filterToExchanges(e);if(s.length===0)return this.createdAt(e);const i=s[s.length-1];return i.timestamp?new Date(i.timestamp):this.createdAt(e)}static isValid(e){return e.id!==void 0&&(!wt.isEmpty(e)||wt.isNamed(e))}onBeforeChangeConversation(e){return this._onBeforeChangeConversationListeners.push(e),()=>{this._onBeforeChangeConversationListeners=this._onBeforeChangeConversationListeners.filter(s=>s!==e)}}_notifyBeforeChangeConversation(e,s){let i=s;for(const u of this._onBeforeChangeConversationListeners){const l=u(e,i);l!==void 0&&(i=l)}return i}get extraData(){return this._state.extraData}set extraData(e){this.update({extraData:e})}get focusModel(){return this._focusModel}get isValid(){return wt.isValid(this._state)}get id(){return this._state.id}get name(){return this._state.name}get personaType(){return this._state.personaType??Ut.DEFAULT}get displayName(){return wt.getDisplayName(this._state)}get createdAtIso(){return this._state.createdAtIso}get createdAt(){return wt.createdAt(this._state)}get chatHistory(){return this._state.chatHistory}get feedbackStates(){return this._state.feedbackStates}get toolUseStates(){return this._state.toolUseStates}get draftExchange(){return this._state.draftExchange}get selectedModelId(){return this._state.selectedModelId}get isPinned(){return!!this._state.isPinned}get extensionClient(){return this._extensionClient}addChatItem(e){this.addExchange(e)}get requestIds(){return this._state.chatHistory.map(e=>e.request_id).filter(e=>e!==void 0)}get hasDraft(){var i;const e=(((i=this.draftExchange)==null?void 0:i.request_message)??"").trim()!=="",s=this.hasImagesInDraft();return e||s}hasImagesInDraft(){var i;const e=(i=this.draftExchange)==null?void 0:i.rich_text_json_repr;if(!e)return!1;const s=u=>Array.isArray(u)?u.some(s):!!u&&(u.type==="image"||!(!u.content||!Array.isArray(u.content))&&u.content.some(s));return s(e)}get canSendDraft(){return this.hasDraft&&!this.awaitingReply}get canCancelMessage(){return this.awaitingReply}get firstExchange(){const e=wt._filterToExchanges(this);return e.length===0?null:e[0]}get lastExchange(){const e=wt._filterToExchanges(this);return e.length===0?null:e[e.length-1]}get canClearHistory(){return this._state.chatHistory.length!==0&&!this.awaitingReply}get recoverableExchanges(){return this._state.chatHistory.filter(e=>_e(e)&&e.status===ot.sent)}get successfulMessages(){return this._state.chatHistory.filter(e=>ns(e)||Rs(e))}get totalCharactersStore(){return this._totalCharactersStore}_convertHistoryToExchanges(e){if(e.length===0)return[];const s=[];for(const i of e)if(ns(i))s.push(gf(i));else if(Rs(i)&&i.fromTimestamp!==void 0&&i.toTimestamp!==void 0&&i.revertTarget){const u=ff(i,1),l={request_message:"",response_text:"",request_id:i.request_id||crypto.randomUUID(),request_nodes:[u],response_nodes:[]};s.push(l)}return s}get awaitingReply(){return this.lastExchange!==null&&this.lastExchange.status===ot.sent}get lastInteractedAtIso(){return this._state.lastInteractedAtIso}get draftActiveContextIds(){return this._state.draftActiveContextIds}async sendSilentExchange(e){const s=crypto.randomUUID();let i,u="";const l=await this._addIdeStateNode(fc({...e,request_id:s,status:ot.sent,timestamp:new Date().toISOString()}));for await(const p of this.sendUserMessage(s,l))p.response_text&&(u+=p.response_text),p.request_id&&(i=p.request_id);return{responseText:u,requestId:i}}async*getChatStream(e){e.request_id&&(yield*this._extensionClient.getExistingChatStream(e,{flags:this._chatFlagModel}))}async*sendUserMessage(e,s){var E;const i=this._specialContextInputModel.chatActiveContext;let u=this.successfulMessages;if(s.chatItemType===es.summaryTitle){const R=u.findIndex(O=>O.chatItemType!==es.agentOnboarding&&_a(O));R!==-1&&(u=u.slice(R))}const l=s.disableHistory===!0?[]:u;let p=this._convertHistoryToExchanges(l);this._chatFlagModel.truncateChatHistory&&(p=this._truncatedChatHistory.getTruncatedChatHistory(p,()=>this._extensionClient.reportAgentSessionEvent({eventName:bc.chatHistoryTruncated,conversationId:this.id})));let y=this.personaType;if(s.structured_request_nodes){const R=s.structured_request_nodes.find(O=>O.type===$t.CHANGE_PERSONALITY);R&&R.change_personality_node&&(y=R.change_personality_node.personality_type)}const v={text:s.request_message,chatHistory:p,modelId:s.model_id,context:i,userSpecifiedFiles:i.userSpecifiedFiles,externalSourceIds:(E=i.externalSources)==null?void 0:E.map(R=>R.id),disableRetrieval:s.disableRetrieval??!1,disableSelectedCodeDetails:s.disableSelectedCodeDetails??!1,nodes:s.structured_request_nodes,memoriesInfo:s.memoriesInfo,personaType:y,conversationId:this.id};yield*this._extensionClient.startChatStreamWithRetry(e,v,{flags:this._chatFlagModel})}onSendExchange(e){return this._onSendExchangeListeners.push(e),()=>{this._onSendExchangeListeners=this._onSendExchangeListeners.filter(s=>s!==e)}}onNewConversation(e){return this._onNewConversationListeners.push(e),()=>{this._onNewConversationListeners=this._onNewConversationListeners.filter(s=>s!==e)}}onHistoryDelete(e){return this._onHistoryDeleteListeners.push(e),()=>{this._onHistoryDeleteListeners=this._onHistoryDeleteListeners.filter(s=>s!==e)}}updateChatItem(e,s){return this.chatHistory.find(i=>i.request_id===e)===null?(console.warn("No exchange with this request ID found."),!1):(this.update({chatHistory:this.chatHistory.map(i=>i.request_id===e?{...i,...s}:i)}),!0)}_fileNameToImageFormat(e){var i;switch((i=e.split(".").at(-1))==null?void 0:i.toLowerCase()){case"jpeg":case"jpg":return Es.JPEG;case"png":return Es.PNG;case"gif":return Es.GIF;case"webp":return Es.WEBP;default:return Es.IMAGE_FORMAT_UNSPECIFIED}}async _addIdeStateNode(e){let s=(e.structured_request_nodes??[]).filter(u=>u.type!==$t.IDE_STATE);const i=await this._extensionClient.getChatRequestIdeState();return i?(s=[...s,{id:Ic(s)+1,type:$t.IDE_STATE,ide_state_node:i}],{...e,structured_request_nodes:s}):e}}function ff(a,e){const s=(Rs(a),a.fromTimestamp),i=(Rs(a),a.toTimestamp),u=Rs(a)&&a.revertTarget!==void 0;return{id:e,type:$t.CHECKPOINT_REF,checkpoint_ref_node:{request_id:a.request_id||"",from_timestamp:s,to_timestamp:i,source:u?Jd.CHECKPOINT_REVERT:void 0}}}function gf(a){const e=(a.structured_output_nodes??[]).filter(s=>s.type===re.RAW_RESPONSE||s.type===re.TOOL_USE);return{request_message:a.request_message,response_text:a.response_text??"",request_id:a.request_id||"",request_nodes:a.structured_request_nodes??[],response_nodes:e}}function Ic(a){return a.length>0?Math.max(...a.map(e=>e.id)):0}function fc(a){var e;if(a.request_message.length>0&&!((e=a.structured_request_nodes)!=null&&e.some(s=>s.type===$t.TEXT))){let s=a.structured_request_nodes??[];return s=[...s,{id:Ic(s)+1,type:$t.TEXT,text_node:{content:a.request_message}}],{...a,structured_request_nodes:s}}return a}class pf{constructor(e,s,i){d(this,"_cachedTruncatedHistory",[]);d(this,"_cachedTruncatedChars",[]);d(this,"_cachedUntruncatedChars",new Map);this._maxHistoryChars=e,this._truncateToChars=s,this._avoidTruncationExchangeCount=i}getTruncatedChatHistory(e,s){const i=[];e.length<this._cachedTruncatedHistory.length&&(this._cachedTruncatedHistory.splice(e.length),this._cachedTruncatedChars.splice(e.length));for(let v=0;v<this._cachedTruncatedHistory.length;v++){const E=e[v],R=this._cachedTruncatedHistory[v];if(E.request_id!==R.request_id){this._cachedTruncatedHistory.splice(v),this._cachedTruncatedChars.splice(v);break}}const u=this._cachedTruncatedHistory.length;i.push(...this._cachedTruncatedHistory);let l=this._cachedTruncatedChars.reduce((v,E)=>v+E,0);const p=e.slice(u).map(v=>this._getUntruncatedChars(v)).reduce((v,E)=>v+E,0);if(l+p<this._maxHistoryChars)return i.push(...e.slice(u)),i;s==null||s();let y=l+p-this._truncateToChars;for(let v=u;v<e.length-this._avoidTruncationExchangeCount;v++){const E=this._truncateExchange(e[v]),R=JSON.stringify(E).length;if(this._cachedTruncatedHistory.push(E),this._cachedTruncatedChars.push(R),i.push(E),l+=R,y-=this._getUntruncatedChars(e[v])-R,y<=0)break}return i.push(...e.slice(i.length)),i}_truncateExchange(e){var l,p;const s=(l=e.request_nodes)==null?void 0:l.map(y=>y.type===$t.TOOL_RESULT?{...y,tool_result_node:{...y.tool_result_node,content:"[Tool result truncated...]"}}:y),i=(p=e.response_nodes)==null?void 0:p.map(y=>y.type===re.TOOL_USE?{...y,tool_use:y.tool_use&&this._truncateToolUse(y.tool_use)}:y),u={...e,request_nodes:s,response_nodes:i};return JSON.stringify(u).length>JSON.stringify(e).length?e:u}_truncateToolUse(e){let s;try{s=JSON.parse(e.input_json)}catch{return{...e,input_json:JSON.stringify({message:"[Tool use truncated...]"})}}for(const i of Object.keys(s))s[i].length>14&&(s[i]="[Truncated...]");return{...e,input_json:JSON.stringify(s)}}_getUntruncatedChars(e){if(this._cachedUntruncatedChars.has(e.request_id))return this._cachedUntruncatedChars.get(e.request_id);{const s=JSON.stringify(e).length;return this._cachedUntruncatedChars.set(e.request_id,s),s}}}class _f{constructor(e=!0,s=setTimeout){d(this,"_notify",new Set);d(this,"_clearTimeout",e=>{e.timeoutId&&clearTimeout(e.timeoutId)});d(this,"_schedule",e=>{if(!this._started||e.date&&(e.timeout=e.date.getTime()-Date.now(),e.timeout<0))return;const s=this._setTimeout;e.timeoutId=s(this._handle,e.timeout,e)});d(this,"_handle",e=>{e.notify(),e.date?this._notify.delete(e):e.once||this._schedule(e)});d(this,"dispose",()=>{this._notify.forEach(this._clearTimeout),this._notify.clear()});this._started=e,this._setTimeout=s}start(){return this._started||(this._started=!0,this._notify.forEach(this._schedule)),this}stop(){return this._started=!1,this._notify.forEach(this._clearTimeout),this}get isStarted(){return this._started}set isStarted(e){e?this.start():this.stop()}once(e,s){return this._register(e,s,!0)}interval(e,s){return this._register(e,s,!1)}at(e,s){return this._register(0,s,!1,typeof e=="number"?new Date(Date.now()+e):e)}reschedule(){this._notify.forEach(e=>{this._clearTimeout(e),this._schedule(e)})}_register(e,s,i,u){if(!e&&!u)return()=>{};const l={timeout:e,notify:s,once:i,date:u};return this._notify.add(l),this._schedule(l),()=>{this._clearTimeout(l),this._notify.delete(l)}}}class mf{constructor(e=0,s=0,i=new _f,u=nn("busy"),l=nn(!1)){d(this,"unsubNotify");d(this,"unsubMessage");d(this,"activity",()=>{this.idleStatus.set("busy"),this.idleScheduler.reschedule()});d(this,"focus",e=>{this.focusAfterIdle.set(e)});this._idleNotifyTimeout=e,this._idleMessageTimeout=s,this.idleScheduler=i,this.idleStatus=u,this.focusAfterIdle=l,this.idleNotifyTimeout=e,this.idleMessageTimeout=s}set idleMessageTimeout(e){var s;this._idleMessageTimeout!==e&&(this._idleMessageTimeout=e,(s=this.unsubMessage)==null||s.call(this),this.unsubMessage=this.idleScheduler.once(e,()=>{this.idleStatus.set("idle-message")}))}set idleNotifyTimeout(e){var s;this._idleNotifyTimeout!==e&&(this._idleNotifyTimeout=e,(s=this.unsubNotify)==null||s.call(this),this.unsubNotify=this.idleScheduler.once(e,()=>{this.idleStatus.set("idle-notify")}))}get idleMessageTimeout(){return this._idleMessageTimeout}get idleNotifyTimeout(){return this._idleNotifyTimeout}get notifyEnabled(){return this._idleNotifyTimeout>0}get messageEnabled(){return this._idleMessageTimeout>0}dispose(){var e,s;(e=this.unsubNotify)==null||e.call(this),(s=this.unsubMessage)==null||s.call(this),this.idleScheduler.dispose(),this.idleStatus.set("busy"),this.focusAfterIdle.set(!1)}}const Fr=nn("idle");var yf=(a=>(a.manual="manual",a.auto="auto",a))(yf||{});class pg{constructor(e,s,i,u={}){d(this,"_state",{currentConversationId:void 0,conversations:{},agentExecutionMode:"manual",isAgentEditsCollapsed:!0});d(this,"extensionClient");d(this,"_chatFlagsModel");d(this,"_currConversationModel");d(this,"subscribers",new Set);d(this,"idleMessageModel",new mf);d(this,"isAgentEditsCollapsed");d(this,"agentExecutionMode");d(this,"sortConversationsBy");d(this,"onLoaded",async()=>{var s,i;const e=await this.extensionClient.getChatInitData();this._chatFlagsModel.update({enableEditableHistory:e.enableEditableHistory??!1,enablePreferenceCollection:e.enablePreferenceCollection??!1,enableRetrievalDataCollection:e.enableRetrievalDataCollection??!1,enableDebugFeatures:e.enableDebugFeatures??!1,enableRichTextHistory:e.useRichTextHistory??!0,modelDisplayNameToId:e.modelDisplayNameToId??{},fullFeatured:e.fullFeatured??!0,smallSyncThreshold:e.smallSyncThreshold??15,bigSyncThreshold:e.bigSyncThreshold??1e3,enableExternalSourcesInChat:e.enableExternalSourcesInChat??!1,enableSmartPaste:e.enableSmartPaste??!1,enableDirectApply:e.enableDirectApply??!1,summaryTitles:e.summaryTitles??!1,suggestedEditsAvailable:e.suggestedEditsAvailable??!1,enableShareService:e.enableShareService??!1,maxTrackableFileCount:e.maxTrackableFileCount??xc,enableDesignSystemRichTextEditor:e.enableDesignSystemRichTextEditor??!1,enableSources:e.enableSources??!1,enableChatMermaidDiagrams:e.enableChatMermaidDiagrams??!1,smartPastePrecomputeMode:e.smartPastePrecomputeMode??vc.visibleHover,useNewThreadsMenu:e.useNewThreadsMenu??!1,enableChatMermaidDiagramsMinVersion:e.enableChatMermaidDiagramsMinVersion??!1,idleNewSessionMessageTimeoutMs:e.idleNewSessionMessageTimeoutMs,idleNewSessionNotificationTimeoutMs:e.idleNewSessionNotificationTimeoutMs,enableChatMultimodal:e.enableChatMultimodal??!1,enableAgentMode:e.enableAgentMode??!1,agentMemoriesFilePathName:e.agentMemoriesFilePathName,enableRichCheckpointInfo:e.enableRichCheckpointInfo??!1,userTier:e.userTier??"unknown",truncateChatHistory:e.truncateChatHistory??!1,enableBackgroundAgents:e.enableBackgroundAgents??!1,enableVirtualizedMessageList:e.enableVirtualizedMessageList??!1,customPersonalityPrompts:e.customPersonalityPrompts??{},enablePersonalities:e.enablePersonalities??!1,memoryClassificationOnFirstToken:e.memoryClassificationOnFirstToken??!1}),(i=(s=this.options).onLoaded)==null||i.call(s),this.notifySubscribers()});d(this,"subscribe",e=>(this.subscribers.add(e),e(this),()=>{this.subscribers.delete(e)}));d(this,"initialize",e=>{this._state={...this._state,...this._host.getState()},e&&(this._state.conversations[e==null?void 0:e.id]=e),this._chatFlagsModel.fullFeatured&&((e==null?void 0:e.id)!==la&&this.currentConversationId!==la||(delete this._state.conversations[la],this.setCurrentConversationToWelcome())),this._chatFlagsModel.subscribe(s=>{this.idleMessageModel.idleNotifyTimeout=s.idleNewSessionNotificationTimeoutMs,this.idleMessageModel.idleMessageTimeout=s.idleNewSessionMessageTimeoutMs}),this._state.conversations=Object.fromEntries(Object.entries(this._state.conversations).filter(([s,i])=>wt.isValid(i))),this.initializeIsShareableState(),e?this.setCurrentConversation(e.id):this.setCurrentConversation(this.currentConversationId),this.subscribe(()=>this.idleMessageModel.activity()),this.setState(this._state)});d(this,"initializeIsShareableState",()=>{const e={...this._state.conversations};for(const[s,i]of Object.entries(e)){if(i.isShareable)continue;const u=i.chatHistory.some(l=>ns(l));e[s]={...i,isShareable:u}}this._state.conversations=e});d(this,"updateChatState",e=>{this._state={...this._state,...e};const s=this._state.conversations,i=new Set;for(const[u,l]of Object.entries(s))l.isPinned&&i.add(u);this.setState(this._state),this.notifySubscribers()});d(this,"saveImmediate",()=>{this._host.setState(this._state)});d(this,"setState",Pd(e=>{this._host.setState({...e,isAgentEditsCollapsed:Ms(this.isAgentEditsCollapsed),agentExecutionMode:Ms(this.agentExecutionMode),sortConversationsBy:Ms(this.sortConversationsBy)})},1e3,{maxWait:15e3}));d(this,"notifySubscribers",()=>{this.subscribers.forEach(e=>e(this))});d(this,"withWebviewClientEvent",(e,s)=>(...i)=>(this.extensionClient.reportWebviewClientEvent(e),s(...i)));d(this,"setCurrentConversationToWelcome",()=>{this.setCurrentConversation(),this._currConversationModel.setName("Welcome to Augment"),this._currConversationModel.addChatItem({chatItemType:es.educateFeatures,request_id:crypto.randomUUID(),seen_state:Lt.seen})});d(this,"popCurrentConversation",async()=>{var s,i;const e=this.currentConversationId;e&&await this.deleteConversation(e,((s=this.nextConversation)==null?void 0:s.id)??((i=this.previousConversation)==null?void 0:i.id))});d(this,"setCurrentConversation",async(e,s=!0)=>{let i;e===void 0?(this.deleteInvalidConversations(ss(this._currConversationModel)?"agent":"chat"),i=wt.create({personaType:await this._currConversationModel.decidePersonaType()})):i=this._state.conversations[e]??wt.create({personaType:await this._currConversationModel.decidePersonaType()});const u=this.conversations[this._currConversationModel.id]===void 0;this._currConversationModel.setConversation(i,!u,s),this._currConversationModel.recoverAllExchanges(),this._currConversationModel.resetTotalCharactersCache()});d(this,"saveConversation",e=>{this.updateChatState({conversations:{...this._state.conversations,[e.id]:e},currentConversationId:e.id})});d(this,"isConversationShareable",e=>{var s;return((s=this._state.conversations[e])==null?void 0:s.isShareable)??!0});d(this,"setSortConversationsBy",e=>{this.sortConversationsBy.set(e),this.updateChatState({})});d(this,"getConversationUrl",async e=>{const s=this._state.conversations[e];if(s.lastUrl)return s.lastUrl;Fr.set("copying");const i=s==null?void 0:s.chatHistory,u=i.reduce((y,v)=>(ns(v)&&y.push({request_id:v.request_id||"",request_message:v.request_message,response_text:v.response_text||""}),y),[]);if(u.length===0)throw new Error("No chat history to share");const l=wt.getDisplayName(s),p=await this.extensionClient.saveChat(e,u,l);if(p.data){let y=p.data.url;return this.updateChatState({conversations:{...this._state.conversations,[e]:{...s,lastUrl:y}}}),y}throw new Error("Failed to create URL")});d(this,"shareConversation",async e=>{if(e!==void 0)try{const s=await this.getConversationUrl(e);if(!s)return void Fr.set("idle");navigator.clipboard.writeText(s),Fr.set("copied")}catch{Fr.set("failed")}});d(this,"deleteConversations",async(e,s=void 0)=>{if(await this.extensionClient.openConfirmationModal({title:"Delete Conversation",message:`Are you sure you want to delete ${e.length>1?"these conversations":"this conversation"}?`,confirmButtonText:"Delete",cancelButtonText:"Cancel"})){const i=new Set(e);this.deleteConversationIds(i),this.currentConversationId&&i.has(this.currentConversationId)&&this.setCurrentConversation(s)}});d(this,"deleteConversation",async(e,s=void 0)=>{await this.deleteConversations([e],s)});d(this,"deleteConversationIds",async e=>{var i;const s=[];for(const u of e){const l=((i=this._state.conversations[u])==null?void 0:i.requestIds)??[];s.push(...l)}for(const u of Object.values(this._state.conversations))if(e.has(u.id)){for(const p of u.chatHistory)_e(p)&&this.deleteImagesInExchange(p);const l=u.draftExchange;l&&this.deleteImagesInExchange(l)}this.updateChatState({conversations:Object.fromEntries(Object.entries(this._state.conversations).filter(([u])=>!e.has(u)))}),this.extensionClient.clearMetadataFor({requestIds:s,conversationIds:Array.from(e)})});d(this,"deleteImagesInExchange",e=>{const s=new Set([...e.rich_text_json_repr?this.findImagesInJson(e.rich_text_json_repr):[],...e.structured_request_nodes?this.findImagesInStructuredRequest(e.structured_request_nodes):[]]);for(const i of s)this.deleteImage(i)});d(this,"findImagesInJson",e=>{const s=[],i=u=>{var l;if(u.type==="image"&&((l=u.attrs)!=null&&l.src))s.push(u.attrs.src);else if((u.type==="doc"||u.type==="paragraph")&&u.content)for(const p of u.content)i(p)};return i(e),s});d(this,"findImagesInStructuredRequest",e=>e.reduce((s,i)=>(i.type===$t.IMAGE_ID&&i.image_id_node&&s.push(i.image_id_node.image_id),s),[]));d(this,"toggleConversationPinned",e=>{const s=this._state.conversations[e],i={...s,isPinned:!s.isPinned};this.updateChatState({conversations:{...this._state.conversations,[e]:i}}),e===this.currentConversationId&&this._currConversationModel.toggleIsPinned()});d(this,"renameConversation",(e,s)=>{const i={...this._state.conversations[e],name:s};this.updateChatState({conversations:{...this._state.conversations,[e]:i}}),e===this.currentConversationId&&this._currConversationModel.setName(s)});d(this,"smartPaste",(e,s,i,u)=>{const l=this._currConversationModel.historyTo(e,!0).filter(p=>ns(p)).map(p=>({request_message:p.request_message,response_text:p.response_text||"",request_id:p.request_id||""}));this.extensionClient.smartPaste({generatedCode:s,chatHistory:l,targetFile:i??void 0,options:u})});d(this,"saveImage",async e=>await this.extensionClient.saveImage(e));d(this,"deleteImage",async e=>await this.extensionClient.deleteImage(e));d(this,"renderImage",async e=>await this.extensionClient.loadImage(e));this._asyncMsgSender=e,this._host=s,this._specialContextInputModel=i,this.options=u,this._chatFlagsModel=new af(u.initialFlags),this.extensionClient=new ef(this._host,this._asyncMsgSender,this._chatFlagsModel),this._currConversationModel=new wt(this.extensionClient,this._chatFlagsModel,this._specialContextInputModel,this.saveConversation),this.initialize(u.initialConversation),this.isAgentEditsCollapsed=nn(this._state.isAgentEditsCollapsed),this.agentExecutionMode=nn(this._state.agentExecutionMode??"manual"),this.sortConversationsBy=nn(this._state.sortConversationsBy??"lastMessageTimestamp"),this.onLoaded()}get flags(){return this._chatFlagsModel}get specialContextInputModel(){return this._specialContextInputModel}get currentConversationId(){return this._state.currentConversationId}get currentConversationModel(){return this._currConversationModel}get conversations(){return this._state.conversations}orderedConversations(e,s="desc",i){const u=e||this._state.sortConversationsBy||"lastMessageTimestamp";let l=Object.values(this._state.conversations);return i&&(l=l.filter(i)),l.sort((p,y)=>{const v=wt.getTime(p,u).getTime(),E=wt.getTime(y,u).getTime();return s==="asc"?v-E:E-v})}get nextConversation(){if(!this.currentConversationId)return;const e=this.orderedConversations(),s=e.findIndex(i=>i.id===this.currentConversationId);return e.length>s+1?e[s+1]:void 0}get previousConversation(){if(!this.currentConversationId)return;const e=this.orderedConversations(),s=e.findIndex(i=>i.id===this.currentConversationId);return s>0?e[s-1]:void 0}get host(){return this._host}deleteInvalidConversations(e="all"){const s=Object.keys(this.conversations).filter(i=>{const u=!wt.isValid(this.conversations[i]),l=ss(this.conversations[i]);return u&&(e==="agent"&&l||e==="chat"&&!l||e==="all")});s.length&&this.deleteConversationIds(new Set(s))}get lastMessageTimestamp(){const e=this.currentConversationModel.lastExchange;return e==null?void 0:e.timestamp}handleMessageFromExtension(e){return e.data.type===T.newThread&&(this.setCurrentConversation(),!0)}}const ts=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,gc=new Set,ma=typeof process=="object"&&process?process:{},Ec=(a,e,s,i)=>{typeof ma.emitWarning=="function"?ma.emitWarning(a,e,s,i):console.error(`[${s}] ${e}: ${a}`)};let Nr=globalThis.AbortController,pc=globalThis.AbortSignal;var _c;if(Nr===void 0){pc=class{constructor(){d(this,"onabort");d(this,"_onabort",[]);d(this,"reason");d(this,"aborted",!1)}addEventListener(s,i){this._onabort.push(i)}},Nr=class{constructor(){d(this,"signal",new pc);e()}abort(s){var i,u;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const l of this.signal._onabort)l(s);(u=(i=this.signal).onabort)==null||u.call(i,s)}}};let a=((_c=ma.env)==null?void 0:_c.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{a&&(a=!1,Ec("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const pn=a=>a&&a===Math.floor(a)&&a>0&&isFinite(a),Tc=a=>pn(a)?a<=Math.pow(2,8)?Uint8Array:a<=Math.pow(2,16)?Uint16Array:a<=Math.pow(2,32)?Uint32Array:a<=Number.MAX_SAFE_INTEGER?Or:null:null;class Or extends Array{constructor(e){super(e),this.fill(0)}}var rs;const Dn=class Dn{constructor(e,s){d(this,"heap");d(this,"length");if(!g(Dn,rs))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}static create(e){const s=Tc(e);if(!s)return[];W(Dn,rs,!0);const i=new Dn(e,s);return W(Dn,rs,!1),i}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};rs=new WeakMap,at(Dn,rs,!1);let ya=Dn;var mc,yc,qe,he,Pe,De,is,as,Ft,Oe,Et,yt,X,Yt,de,Wt,Dt,ke,Ot,Le,Ne,fe,He,vn,Kt,q,ba,On,en,Fs,ge,Mc,kn,os,qs,_n,mn,Sa,kr,Lr,mt,Ca,Ts,yn,wa;const Ia=class Ia{constructor(e){at(this,q);at(this,qe);at(this,he);at(this,Pe);at(this,De);at(this,is);at(this,as);d(this,"ttl");d(this,"ttlResolution");d(this,"ttlAutopurge");d(this,"updateAgeOnGet");d(this,"updateAgeOnHas");d(this,"allowStale");d(this,"noDisposeOnSet");d(this,"noUpdateTTL");d(this,"maxEntrySize");d(this,"sizeCalculation");d(this,"noDeleteOnFetchRejection");d(this,"noDeleteOnStaleGet");d(this,"allowStaleOnFetchAbort");d(this,"allowStaleOnFetchRejection");d(this,"ignoreFetchAbort");at(this,Ft);at(this,Oe);at(this,Et);at(this,yt);at(this,X);at(this,Yt);at(this,de);at(this,Wt);at(this,Dt);at(this,ke);at(this,Ot);at(this,Le);at(this,Ne);at(this,fe);at(this,He);at(this,vn);at(this,Kt);at(this,On,()=>{});at(this,en,()=>{});at(this,Fs,()=>{});at(this,ge,()=>!1);at(this,kn,e=>{});at(this,os,(e,s,i)=>{});at(this,qs,(e,s,i,u)=>{if(i||u)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});d(this,mc,"LRUCache");const{max:s=0,ttl:i,ttlResolution:u=1,ttlAutopurge:l,updateAgeOnGet:p,updateAgeOnHas:y,allowStale:v,dispose:E,disposeAfter:R,noDisposeOnSet:O,noUpdateTTL:ut,maxSize:J=0,maxEntrySize:V=0,sizeCalculation:it,fetchMethod:st,memoMethod:H,noDeleteOnFetchRejection:ht,noDeleteOnStaleGet:ie,allowStaleOnFetchRejection:ae,allowStaleOnFetchAbort:bt,ignoreFetchAbort:Ee}=e;if(s!==0&&!pn(s))throw new TypeError("max option must be a nonnegative integer");const qt=s?Tc(s):Array;if(!qt)throw new Error("invalid max value: "+s);if(W(this,qe,s),W(this,he,J),this.maxEntrySize=V||g(this,he),this.sizeCalculation=it,this.sizeCalculation){if(!g(this,he)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(H!==void 0&&typeof H!="function")throw new TypeError("memoMethod must be a function if defined");if(W(this,as,H),st!==void 0&&typeof st!="function")throw new TypeError("fetchMethod must be a function if specified");if(W(this,is,st),W(this,vn,!!st),W(this,Et,new Map),W(this,yt,new Array(s).fill(void 0)),W(this,X,new Array(s).fill(void 0)),W(this,Yt,new qt(s)),W(this,de,new qt(s)),W(this,Wt,0),W(this,Dt,0),W(this,ke,ya.create(s)),W(this,Ft,0),W(this,Oe,0),typeof E=="function"&&W(this,Pe,E),typeof R=="function"?(W(this,De,R),W(this,Ot,[])):(W(this,De,void 0),W(this,Ot,void 0)),W(this,He,!!g(this,Pe)),W(this,Kt,!!g(this,De)),this.noDisposeOnSet=!!O,this.noUpdateTTL=!!ut,this.noDeleteOnFetchRejection=!!ht,this.allowStaleOnFetchRejection=!!ae,this.allowStaleOnFetchAbort=!!bt,this.ignoreFetchAbort=!!Ee,this.maxEntrySize!==0){if(g(this,he)!==0&&!pn(g(this,he)))throw new TypeError("maxSize must be a positive integer if specified");if(!pn(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");k(this,q,Mc).call(this)}if(this.allowStale=!!v,this.noDeleteOnStaleGet=!!ie,this.updateAgeOnGet=!!p,this.updateAgeOnHas=!!y,this.ttlResolution=pn(u)||u===0?u:1,this.ttlAutopurge=!!l,this.ttl=i||0,this.ttl){if(!pn(this.ttl))throw new TypeError("ttl must be a positive integer if specified");k(this,q,ba).call(this)}if(g(this,qe)===0&&this.ttl===0&&g(this,he)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!g(this,qe)&&!g(this,he)){const $e="LRU_CACHE_UNBOUNDED";(Ue=>!gc.has(Ue))($e)&&(gc.add($e),Ec("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",$e,Ia))}}static unsafeExposeInternals(e){return{starts:g(e,Ne),ttls:g(e,fe),sizes:g(e,Le),keyMap:g(e,Et),keyList:g(e,yt),valList:g(e,X),next:g(e,Yt),prev:g(e,de),get head(){return g(e,Wt)},get tail(){return g(e,Dt)},free:g(e,ke),isBackgroundFetch:s=>{var i;return k(i=e,q,mt).call(i,s)},backgroundFetch:(s,i,u,l)=>{var p;return k(p=e,q,Lr).call(p,s,i,u,l)},moveToTail:s=>{var i;return k(i=e,q,Ts).call(i,s)},indexes:s=>{var i;return k(i=e,q,_n).call(i,s)},rindexes:s=>{var i;return k(i=e,q,mn).call(i,s)},isStale:s=>{var i;return g(i=e,ge).call(i,s)}}}get max(){return g(this,qe)}get maxSize(){return g(this,he)}get calculatedSize(){return g(this,Oe)}get size(){return g(this,Ft)}get fetchMethod(){return g(this,is)}get memoMethod(){return g(this,as)}get dispose(){return g(this,Pe)}get disposeAfter(){return g(this,De)}getRemainingTTL(e){return g(this,Et).has(e)?1/0:0}*entries(){for(const e of k(this,q,_n).call(this))g(this,X)[e]===void 0||g(this,yt)[e]===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield[g(this,yt)[e],g(this,X)[e]])}*rentries(){for(const e of k(this,q,mn).call(this))g(this,X)[e]===void 0||g(this,yt)[e]===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield[g(this,yt)[e],g(this,X)[e]])}*keys(){for(const e of k(this,q,_n).call(this)){const s=g(this,yt)[e];s===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield s)}}*rkeys(){for(const e of k(this,q,mn).call(this)){const s=g(this,yt)[e];s===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield s)}}*values(){for(const e of k(this,q,_n).call(this))g(this,X)[e]===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield g(this,X)[e])}*rvalues(){for(const e of k(this,q,mn).call(this))g(this,X)[e]===void 0||k(this,q,mt).call(this,g(this,X)[e])||(yield g(this,X)[e])}[(yc=Symbol.iterator,mc=Symbol.toStringTag,yc)](){return this.entries()}find(e,s={}){for(const i of k(this,q,_n).call(this)){const u=g(this,X)[i],l=k(this,q,mt).call(this,u)?u.__staleWhileFetching:u;if(l!==void 0&&e(l,g(this,yt)[i],this))return this.get(g(this,yt)[i],s)}}forEach(e,s=this){for(const i of k(this,q,_n).call(this)){const u=g(this,X)[i],l=k(this,q,mt).call(this,u)?u.__staleWhileFetching:u;l!==void 0&&e.call(s,l,g(this,yt)[i],this)}}rforEach(e,s=this){for(const i of k(this,q,mn).call(this)){const u=g(this,X)[i],l=k(this,q,mt).call(this,u)?u.__staleWhileFetching:u;l!==void 0&&e.call(s,l,g(this,yt)[i],this)}}purgeStale(){let e=!1;for(const s of k(this,q,mn).call(this,{allowStale:!0}))g(this,ge).call(this,s)&&(k(this,q,yn).call(this,g(this,yt)[s],"expire"),e=!0);return e}info(e){const s=g(this,Et).get(e);if(s===void 0)return;const i=g(this,X)[s],u=k(this,q,mt).call(this,i)?i.__staleWhileFetching:i;if(u===void 0)return;const l={value:u};if(g(this,fe)&&g(this,Ne)){const p=g(this,fe)[s],y=g(this,Ne)[s];if(p&&y){const v=p-(ts.now()-y);l.ttl=v,l.start=Date.now()}}return g(this,Le)&&(l.size=g(this,Le)[s]),l}dump(){const e=[];for(const s of k(this,q,_n).call(this,{allowStale:!0})){const i=g(this,yt)[s],u=g(this,X)[s],l=k(this,q,mt).call(this,u)?u.__staleWhileFetching:u;if(l===void 0||i===void 0)continue;const p={value:l};if(g(this,fe)&&g(this,Ne)){p.ttl=g(this,fe)[s];const y=ts.now()-g(this,Ne)[s];p.start=Math.floor(Date.now()-y)}g(this,Le)&&(p.size=g(this,Le)[s]),e.unshift([i,p])}return e}load(e){this.clear();for(const[s,i]of e){if(i.start){const u=Date.now()-i.start;i.start=ts.now()-u}this.set(s,i.value,i)}}set(e,s,i={}){var ut,J,V,it,st;if(s===void 0)return this.delete(e),this;const{ttl:u=this.ttl,start:l,noDisposeOnSet:p=this.noDisposeOnSet,sizeCalculation:y=this.sizeCalculation,status:v}=i;let{noUpdateTTL:E=this.noUpdateTTL}=i;const R=g(this,qs).call(this,e,s,i.size||0,y);if(this.maxEntrySize&&R>this.maxEntrySize)return v&&(v.set="miss",v.maxEntrySizeExceeded=!0),k(this,q,yn).call(this,e,"set"),this;let O=g(this,Ft)===0?void 0:g(this,Et).get(e);if(O===void 0)O=g(this,Ft)===0?g(this,Dt):g(this,ke).length!==0?g(this,ke).pop():g(this,Ft)===g(this,qe)?k(this,q,kr).call(this,!1):g(this,Ft),g(this,yt)[O]=e,g(this,X)[O]=s,g(this,Et).set(e,O),g(this,Yt)[g(this,Dt)]=O,g(this,de)[O]=g(this,Dt),W(this,Dt,O),Mr(this,Ft)._++,g(this,os).call(this,O,R,v),v&&(v.set="add"),E=!1;else{k(this,q,Ts).call(this,O);const H=g(this,X)[O];if(s!==H){if(g(this,vn)&&k(this,q,mt).call(this,H)){H.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:ht}=H;ht===void 0||p||(g(this,He)&&((ut=g(this,Pe))==null||ut.call(this,ht,e,"set")),g(this,Kt)&&((J=g(this,Ot))==null||J.push([ht,e,"set"])))}else p||(g(this,He)&&((V=g(this,Pe))==null||V.call(this,H,e,"set")),g(this,Kt)&&((it=g(this,Ot))==null||it.push([H,e,"set"])));if(g(this,kn).call(this,O),g(this,os).call(this,O,R,v),g(this,X)[O]=s,v){v.set="replace";const ht=H&&k(this,q,mt).call(this,H)?H.__staleWhileFetching:H;ht!==void 0&&(v.oldValue=ht)}}else v&&(v.set="update")}if(u===0||g(this,fe)||k(this,q,ba).call(this),g(this,fe)&&(E||g(this,Fs).call(this,O,u,l),v&&g(this,en).call(this,v,O)),!p&&g(this,Kt)&&g(this,Ot)){const H=g(this,Ot);let ht;for(;ht=H==null?void 0:H.shift();)(st=g(this,De))==null||st.call(this,...ht)}return this}pop(){var e;try{for(;g(this,Ft);){const s=g(this,X)[g(this,Wt)];if(k(this,q,kr).call(this,!0),k(this,q,mt).call(this,s)){if(s.__staleWhileFetching)return s.__staleWhileFetching}else if(s!==void 0)return s}}finally{if(g(this,Kt)&&g(this,Ot)){const s=g(this,Ot);let i;for(;i=s==null?void 0:s.shift();)(e=g(this,De))==null||e.call(this,...i)}}}has(e,s={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:u}=s,l=g(this,Et).get(e);if(l!==void 0){const p=g(this,X)[l];if(k(this,q,mt).call(this,p)&&p.__staleWhileFetching===void 0)return!1;if(!g(this,ge).call(this,l))return i&&g(this,On).call(this,l),u&&(u.has="hit",g(this,en).call(this,u,l)),!0;u&&(u.has="stale",g(this,en).call(this,u,l))}else u&&(u.has="miss");return!1}peek(e,s={}){const{allowStale:i=this.allowStale}=s,u=g(this,Et).get(e);if(u===void 0||!i&&g(this,ge).call(this,u))return;const l=g(this,X)[u];return k(this,q,mt).call(this,l)?l.__staleWhileFetching:l}async fetch(e,s={}){const{allowStale:i=this.allowStale,updateAgeOnGet:u=this.updateAgeOnGet,noDeleteOnStaleGet:l=this.noDeleteOnStaleGet,ttl:p=this.ttl,noDisposeOnSet:y=this.noDisposeOnSet,size:v=0,sizeCalculation:E=this.sizeCalculation,noUpdateTTL:R=this.noUpdateTTL,noDeleteOnFetchRejection:O=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:ut=this.allowStaleOnFetchRejection,ignoreFetchAbort:J=this.ignoreFetchAbort,allowStaleOnFetchAbort:V=this.allowStaleOnFetchAbort,context:it,forceRefresh:st=!1,status:H,signal:ht}=s;if(!g(this,vn))return H&&(H.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:u,noDeleteOnStaleGet:l,status:H});const ie={allowStale:i,updateAgeOnGet:u,noDeleteOnStaleGet:l,ttl:p,noDisposeOnSet:y,size:v,sizeCalculation:E,noUpdateTTL:R,noDeleteOnFetchRejection:O,allowStaleOnFetchRejection:ut,allowStaleOnFetchAbort:V,ignoreFetchAbort:J,status:H,signal:ht};let ae=g(this,Et).get(e);if(ae===void 0){H&&(H.fetch="miss");const bt=k(this,q,Lr).call(this,e,ae,ie,it);return bt.__returned=bt}{const bt=g(this,X)[ae];if(k(this,q,mt).call(this,bt)){const Ue=i&&bt.__staleWhileFetching!==void 0;return H&&(H.fetch="inflight",Ue&&(H.returnedStale=!0)),Ue?bt.__staleWhileFetching:bt.__returned=bt}const Ee=g(this,ge).call(this,ae);if(!st&&!Ee)return H&&(H.fetch="hit"),k(this,q,Ts).call(this,ae),u&&g(this,On).call(this,ae),H&&g(this,en).call(this,H,ae),bt;const qt=k(this,q,Lr).call(this,e,ae,ie,it),$e=qt.__staleWhileFetching!==void 0&&i;return H&&(H.fetch=Ee?"stale":"refresh",$e&&Ee&&(H.returnedStale=!0)),$e?qt.__staleWhileFetching:qt.__returned=qt}}async forceFetch(e,s={}){const i=await this.fetch(e,s);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(e,s={}){const i=g(this,as);if(!i)throw new Error("no memoMethod provided to constructor");const{context:u,forceRefresh:l,...p}=s,y=this.get(e,p);if(!l&&y!==void 0)return y;const v=i(e,y,{options:p,context:u});return this.set(e,v,p),v}get(e,s={}){const{allowStale:i=this.allowStale,updateAgeOnGet:u=this.updateAgeOnGet,noDeleteOnStaleGet:l=this.noDeleteOnStaleGet,status:p}=s,y=g(this,Et).get(e);if(y!==void 0){const v=g(this,X)[y],E=k(this,q,mt).call(this,v);return p&&g(this,en).call(this,p,y),g(this,ge).call(this,y)?(p&&(p.get="stale"),E?(p&&i&&v.__staleWhileFetching!==void 0&&(p.returnedStale=!0),i?v.__staleWhileFetching:void 0):(l||k(this,q,yn).call(this,e,"expire"),p&&i&&(p.returnedStale=!0),i?v:void 0)):(p&&(p.get="hit"),E?v.__staleWhileFetching:(k(this,q,Ts).call(this,y),u&&g(this,On).call(this,y),v))}p&&(p.get="miss")}delete(e){return k(this,q,yn).call(this,e,"delete")}clear(){return k(this,q,wa).call(this,"delete")}};qe=new WeakMap,he=new WeakMap,Pe=new WeakMap,De=new WeakMap,is=new WeakMap,as=new WeakMap,Ft=new WeakMap,Oe=new WeakMap,Et=new WeakMap,yt=new WeakMap,X=new WeakMap,Yt=new WeakMap,de=new WeakMap,Wt=new WeakMap,Dt=new WeakMap,ke=new WeakMap,Ot=new WeakMap,Le=new WeakMap,Ne=new WeakMap,fe=new WeakMap,He=new WeakMap,vn=new WeakMap,Kt=new WeakMap,q=new WeakSet,ba=function(){const e=new Or(g(this,qe)),s=new Or(g(this,qe));W(this,fe,e),W(this,Ne,s),W(this,Fs,(l,p,y=ts.now())=>{if(s[l]=p!==0?y:0,e[l]=p,p!==0&&this.ttlAutopurge){const v=setTimeout(()=>{g(this,ge).call(this,l)&&k(this,q,yn).call(this,g(this,yt)[l],"expire")},p+1);v.unref&&v.unref()}}),W(this,On,l=>{s[l]=e[l]!==0?ts.now():0}),W(this,en,(l,p)=>{if(e[p]){const y=e[p],v=s[p];if(!y||!v)return;l.ttl=y,l.start=v,l.now=i||u();const E=l.now-v;l.remainingTTL=y-E}});let i=0;const u=()=>{const l=ts.now();if(this.ttlResolution>0){i=l;const p=setTimeout(()=>i=0,this.ttlResolution);p.unref&&p.unref()}return l};this.getRemainingTTL=l=>{const p=g(this,Et).get(l);if(p===void 0)return 0;const y=e[p],v=s[p];return!y||!v?1/0:y-((i||u())-v)},W(this,ge,l=>{const p=s[l],y=e[l];return!!y&&!!p&&(i||u())-p>y})},On=new WeakMap,en=new WeakMap,Fs=new WeakMap,ge=new WeakMap,Mc=function(){const e=new Or(g(this,qe));W(this,Oe,0),W(this,Le,e),W(this,kn,s=>{W(this,Oe,g(this,Oe)-e[s]),e[s]=0}),W(this,qs,(s,i,u,l)=>{if(k(this,q,mt).call(this,i))return 0;if(!pn(u)){if(!l)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof l!="function")throw new TypeError("sizeCalculation must be a function");if(u=l(i,s),!pn(u))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return u}),W(this,os,(s,i,u)=>{if(e[s]=i,g(this,he)){const l=g(this,he)-e[s];for(;g(this,Oe)>l;)k(this,q,kr).call(this,!0)}W(this,Oe,g(this,Oe)+e[s]),u&&(u.entrySize=i,u.totalCalculatedSize=g(this,Oe))})},kn=new WeakMap,os=new WeakMap,qs=new WeakMap,_n=function*({allowStale:e=this.allowStale}={}){if(g(this,Ft))for(let s=g(this,Dt);k(this,q,Sa).call(this,s)&&(!e&&g(this,ge).call(this,s)||(yield s),s!==g(this,Wt));)s=g(this,de)[s]},mn=function*({allowStale:e=this.allowStale}={}){if(g(this,Ft))for(let s=g(this,Wt);k(this,q,Sa).call(this,s)&&(!e&&g(this,ge).call(this,s)||(yield s),s!==g(this,Dt));)s=g(this,Yt)[s]},Sa=function(e){return e!==void 0&&g(this,Et).get(g(this,yt)[e])===e},kr=function(e){var l,p;const s=g(this,Wt),i=g(this,yt)[s],u=g(this,X)[s];return g(this,vn)&&k(this,q,mt).call(this,u)?u.__abortController.abort(new Error("evicted")):(g(this,He)||g(this,Kt))&&(g(this,He)&&((l=g(this,Pe))==null||l.call(this,u,i,"evict")),g(this,Kt)&&((p=g(this,Ot))==null||p.push([u,i,"evict"]))),g(this,kn).call(this,s),e&&(g(this,yt)[s]=void 0,g(this,X)[s]=void 0,g(this,ke).push(s)),g(this,Ft)===1?(W(this,Wt,W(this,Dt,0)),g(this,ke).length=0):W(this,Wt,g(this,Yt)[s]),g(this,Et).delete(i),Mr(this,Ft)._--,s},Lr=function(e,s,i,u){const l=s===void 0?void 0:g(this,X)[s];if(k(this,q,mt).call(this,l))return l;const p=new Nr,{signal:y}=i;y==null||y.addEventListener("abort",()=>p.abort(y.reason),{signal:p.signal});const v={signal:p.signal,options:i,context:u},E=(J,V=!1)=>{const{aborted:it}=p.signal,st=i.ignoreFetchAbort&&J!==void 0;if(i.status&&(it&&!V?(i.status.fetchAborted=!0,i.status.fetchError=p.signal.reason,st&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),it&&!st&&!V)return R(p.signal.reason);const H=O;return g(this,X)[s]===O&&(J===void 0?H.__staleWhileFetching?g(this,X)[s]=H.__staleWhileFetching:k(this,q,yn).call(this,e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,J,v.options))),J},R=J=>{const{aborted:V}=p.signal,it=V&&i.allowStaleOnFetchAbort,st=it||i.allowStaleOnFetchRejection,H=st||i.noDeleteOnFetchRejection,ht=O;if(g(this,X)[s]===O&&(!H||ht.__staleWhileFetching===void 0?k(this,q,yn).call(this,e,"fetch"):it||(g(this,X)[s]=ht.__staleWhileFetching)),st)return i.status&&ht.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),ht.__staleWhileFetching;if(ht.__returned===ht)throw J};i.status&&(i.status.fetchDispatched=!0);const O=new Promise((J,V)=>{var st;const it=(st=g(this,is))==null?void 0:st.call(this,e,l,v);it&&it instanceof Promise&&it.then(H=>J(H===void 0?void 0:H),V),p.signal.addEventListener("abort",()=>{i.ignoreFetchAbort&&!i.allowStaleOnFetchAbort||(J(void 0),i.allowStaleOnFetchAbort&&(J=H=>E(H,!0)))})}).then(E,J=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=J),R(J))),ut=Object.assign(O,{__abortController:p,__staleWhileFetching:l,__returned:void 0});return s===void 0?(this.set(e,ut,{...v.options,status:void 0}),s=g(this,Et).get(e)):g(this,X)[s]=ut,ut},mt=function(e){if(!g(this,vn))return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof Nr},Ca=function(e,s){g(this,de)[s]=e,g(this,Yt)[e]=s},Ts=function(e){e!==g(this,Dt)&&(e===g(this,Wt)?W(this,Wt,g(this,Yt)[e]):k(this,q,Ca).call(this,g(this,de)[e],g(this,Yt)[e]),k(this,q,Ca).call(this,g(this,Dt),e),W(this,Dt,e))},yn=function(e,s){var u,l,p,y;let i=!1;if(g(this,Ft)!==0){const v=g(this,Et).get(e);if(v!==void 0)if(i=!0,g(this,Ft)===1)k(this,q,wa).call(this,s);else{g(this,kn).call(this,v);const E=g(this,X)[v];if(k(this,q,mt).call(this,E)?E.__abortController.abort(new Error("deleted")):(g(this,He)||g(this,Kt))&&(g(this,He)&&((u=g(this,Pe))==null||u.call(this,E,e,s)),g(this,Kt)&&((l=g(this,Ot))==null||l.push([E,e,s]))),g(this,Et).delete(e),g(this,yt)[v]=void 0,g(this,X)[v]=void 0,v===g(this,Dt))W(this,Dt,g(this,de)[v]);else if(v===g(this,Wt))W(this,Wt,g(this,Yt)[v]);else{const R=g(this,de)[v];g(this,Yt)[R]=g(this,Yt)[v];const O=g(this,Yt)[v];g(this,de)[O]=g(this,de)[v]}Mr(this,Ft)._--,g(this,ke).push(v)}}if(g(this,Kt)&&((p=g(this,Ot))!=null&&p.length)){const v=g(this,Ot);let E;for(;E=v==null?void 0:v.shift();)(y=g(this,De))==null||y.call(this,...E)}return i},wa=function(e){var s,i,u;for(const l of k(this,q,mn).call(this,{allowStale:!0})){const p=g(this,X)[l];if(k(this,q,mt).call(this,p))p.__abortController.abort(new Error("deleted"));else{const y=g(this,yt)[l];g(this,He)&&((s=g(this,Pe))==null||s.call(this,p,y,e)),g(this,Kt)&&((i=g(this,Ot))==null||i.push([p,y,e]))}}if(g(this,Et).clear(),g(this,X).fill(void 0),g(this,yt).fill(void 0),g(this,fe)&&g(this,Ne)&&(g(this,fe).fill(0),g(this,Ne).fill(0)),g(this,Le)&&g(this,Le).fill(0),W(this,Wt,0),W(this,Dt,0),g(this,ke).length=0,W(this,Oe,0),W(this,Ft,0),g(this,Kt)&&g(this,Ot)){const l=g(this,Ot);let p;for(;p=l==null?void 0:l.shift();)(u=g(this,De))==null||u.call(this,...p)}};let va=Ia;class _g{constructor(){d(this,"_syncStatus",{status:Kd.done,foldersProgress:[]});d(this,"_syncEnabledState",uc.initializing);d(this,"_workspaceGuidelines",[]);d(this,"_openUserGuidelinesInput",!1);d(this,"_userGuidelines");d(this,"_contextStore",new vf);d(this,"_prevOpenFiles",[]);d(this,"_disableContext",!1);d(this,"_enableAgentMemories",!1);d(this,"subscribers",new Set);d(this,"subscribe",e=>(this.subscribers.add(e),e(this),()=>{this.subscribers.delete(e)}));d(this,"handleMessageFromExtension",e=>{const s=e.data;switch(s.type){case T.sourceFoldersUpdated:this.onSourceFoldersUpdated(s.data.sourceFolders);break;case T.sourceFoldersSyncStatus:this.onSyncStatusUpdated(s.data);break;case T.fileRangesSelected:this.updateSelections(s.data);break;case T.currentlyOpenFiles:this.setCurrentlyOpenFiles(s.data);break;case T.syncEnabledState:this.onSyncEnabledStateUpdate(s.data);break;case T.updateGuidelinesState:this.onGuidelinesStateUpdate(s.data);break;default:return!1}return!0});d(this,"onSourceFoldersUpdated",e=>{const s=this.sourceFolders;e=this.updateSourceFoldersWithGuidelines(e),this._contextStore.update(e.map(i=>({sourceFolder:i,status:kt.active,label:i.folderRoot,showWarning:i.guidelinesOverLimit,id:i.folderRoot+String(i.guidelinesEnabled)+String(i.guidelinesOverLimit)})),s,i=>i.id),this.notifySubscribers()});d(this,"onSyncStatusUpdated",e=>{this._syncStatus=e,this.notifySubscribers()});d(this,"disableContext",()=>{this._disableContext=!0,this.notifySubscribers()});d(this,"enableContext",()=>{this._disableContext=!1,this.notifySubscribers()});d(this,"addFile",e=>{this.addFiles([e])});d(this,"addFiles",e=>{this.updateFiles(e,[])});d(this,"removeFile",e=>{this.removeFiles([e])});d(this,"removeFiles",e=>{this.updateFiles([],e)});d(this,"updateItems",(e,s)=>{this.updateItemsInplace(e,s),this.notifySubscribers()});d(this,"updateItemsInplace",(e,s)=>{this._contextStore.update(e,s,i=>i.id)});d(this,"updateFiles",(e,s)=>{const i=p=>({file:p,...Dr(p)}),u=e.map(i),l=s.map(i);this._contextStore.update(u,l,p=>p.id),this.notifySubscribers()});d(this,"enableAgentMemories",()=>{this._enableAgentMemories=!0,this.notifySubscribers()});d(this,"disableAgentMemories",()=>{this._enableAgentMemories=!1,this.notifySubscribers()});d(this,"setCurrentlyOpenFiles",e=>{const s=e.map(u=>({recentFile:u,...Dr(u)})),i=this._prevOpenFiles;this._prevOpenFiles=s,this._contextStore.update(s,i,u=>u.id),i.forEach(u=>{const l=this._contextStore.peekKey(u.id);l!=null&&l.recentFile&&(l.file=l.recentFile,delete l.recentFile)}),s.forEach(u=>{const l=this._contextStore.peekKey(u.id);l!=null&&l.file&&(l.recentFile=l.file,delete l.file)}),this.notifySubscribers()});d(this,"onSyncEnabledStateUpdate",e=>{this._syncEnabledState=e,this.notifySubscribers()});d(this,"updateUserGuidelines",e=>{const s=this.userGuidelines,i={userGuidelines:e,label:"User Guidelines",id:"userGuidelines",status:kt.active,referenceCount:1,showWarning:e.overLimit};this._contextStore.update([i],s,u=>{var l,p;return u.id+String((l=u.userGuidelines)==null?void 0:l.enabled)+String((p=u.userGuidelines)==null?void 0:p.overLimit)}),this.notifySubscribers()});d(this,"onGuidelinesStateUpdate",e=>{this._userGuidelines=e.userGuidelines,this._workspaceGuidelines=e.workspaceGuidelines??[];const s=e.userGuidelines;s&&this.updateUserGuidelines(s),this.onSourceFoldersUpdated(this.sourceFolders.map(i=>i.sourceFolder))});d(this,"updateSourceFoldersWithGuidelines",e=>e.map(s=>{const i=this._workspaceGuidelines.find(u=>u.workspaceFolder===s.folderRoot);return{...s,guidelinesEnabled:(i==null?void 0:i.enabled)??!1,guidelinesOverLimit:(i==null?void 0:i.overLimit)??!1,guidelinesLengthLimit:(i==null?void 0:i.lengthLimit)??2e3}}));d(this,"toggleStatus",e=>{this._contextStore.toggleStatus(e.id),this.notifySubscribers()});d(this,"updateExternalSources",(e,s)=>{this._contextStore.update(e,s,i=>i.id),this.notifySubscribers()});d(this,"clearFiles",()=>{this._contextStore.update([],this.files,e=>e.id),this.notifySubscribers()});d(this,"updateSelections",e=>{const s=this._contextStore.values.filter(cc);this._contextStore.update(e.map(i=>({selection:i,...Dr(i)})),s,i=>i.id),this.notifySubscribers()});d(this,"maybeHandleDelete",({editor:e})=>{if(e.state.selection.empty&&e.state.selection.$anchor.pos===1&&this.recentActiveItems.length>0){const s=this.recentActiveItems[0];return this.markInactive(s),!0}return!1});d(this,"markInactive",e=>{this.markItemsInactive([e])});d(this,"markItemsInactive",e=>{e.forEach(s=>{this._contextStore.setStatus(s.id,kt.inactive)}),this.notifySubscribers()});d(this,"markAllInactive",()=>{this.markItemsInactive(this.recentActiveItems)});d(this,"markActive",e=>{this.markItemsActive([e])});d(this,"markItemsActive",e=>{e.forEach(s=>{this._contextStore.setStatus(s.id,kt.active)}),this.notifySubscribers()});d(this,"markAllActive",()=>{this.markItemsActive(this.recentInactiveItems)});d(this,"unpin",e=>{this._contextStore.unpin(e.id),this.notifySubscribers()});d(this,"togglePinned",e=>{this._contextStore.togglePinned(e.id),this.notifySubscribers()});d(this,"notifySubscribers",()=>{this.subscribers.forEach(e=>e(this))});this.clearFiles()}get files(){return this._disableContext?[]:this._contextStore.values.filter(e=>Sc(e)&&!ga(e))}get recentFiles(){return this._disableContext?[]:this._contextStore.values.filter(ga)}get userGuidelinesText(){var e;return((e=this._userGuidelines)==null?void 0:e.contents)??""}get selections(){return this._disableContext?[]:this._contextStore.values.filter(cc)}get folders(){return this._disableContext?[]:this._contextStore.values.filter(Cc)}get sourceFolders(){return this._disableContext?[]:this._contextStore.values.filter(pa)}get externalSources(){return this._disableContext?[]:this._contextStore.values.filter(wc)}get userGuidelines(){return this._contextStore.values.filter(lc)}get agentMemories(){return[{...tf,status:this._enableAgentMemories?kt.active:kt.inactive,referenceCount:1}]}get activeFiles(){return this._disableContext?[]:this.files.filter(e=>e.status===kt.active)}get activeRecentFiles(){return this._disableContext?[]:this.recentFiles.filter(e=>e.status===kt.active)}get activeExternalSources(){return this._disableContext?[]:this.externalSources.filter(e=>e.status===kt.active)}get activeSelections(){return this._disableContext?[]:this.selections.filter(e=>e.status===kt.active)}get activeSourceFolders(){return this._disableContext?[]:this.sourceFolders.filter(e=>e.status===kt.active)}get syncStatus(){return this._syncStatus.status}get syncEnabledState(){return this._syncEnabledState}get syncProgress(){var v;if(this.syncEnabledState===uc.disabled||!this._syncStatus.foldersProgress)return;const e=this._syncStatus.foldersProgress.filter(E=>E.progress!==void 0);if(e.length===0)return;const s=e.reduce((E,R)=>{var O;return E+(((O=R==null?void 0:R.progress)==null?void 0:O.trackedFiles)??0)},0),i=e.reduce((E,R)=>{var O;return E+(((O=R==null?void 0:R.progress)==null?void 0:O.backlogSize)??0)},0),u=Math.max(s,0),l=Math.min(Math.max(i,0),u),p=u-l,y=[];for(const E of e)(v=E==null?void 0:E.progress)!=null&&v.newlyTracked&&y.push(E.folderRoot);return{status:this._syncStatus.status,totalFiles:u,syncedCount:p,backlogSize:l,newlyTrackedFolders:y}}get contextCounts(){return this._contextStore.values.length??0}get chatActiveContext(){return{userSpecifiedFiles:this.activeFiles.map(e=>({rootPath:e.file.repoRoot,relPath:e.file.pathName})),recentFiles:this.activeRecentFiles.map(e=>({rootPath:e.recentFile.repoRoot,relPath:e.recentFile.pathName})),externalSources:this.activeExternalSources.map(e=>e.externalSource),selections:this.activeSelections.map(e=>e.selection),sourceFolders:this.activeSourceFolders.map(e=>({rootPath:e.sourceFolder.folderRoot,relPath:""}))}}get recentItems(){return this._disableContext?this.userGuidelines:[...this._contextStore.values.filter(e=>!pa(e)&&!lc(e)&&!Aa(e)),...this.sourceFolders,...this.userGuidelines,...this.agentMemories]}get recentActiveItems(){return this.recentItems.filter(e=>e.status===kt.active)}get recentInactiveItems(){return this.recentItems.filter(e=>e.status===kt.inactive)}get isContextDisabled(){return this._disableContext}}class vf{constructor(){d(this,"_cache",new va({max:1e3}));d(this,"peekKey",e=>this._cache.get(e,{updateAgeOnGet:!1}));d(this,"clear",()=>{this._cache.clear()});d(this,"update",(e,s,i)=>{e.forEach(u=>this.addInPlace(u,i)),s.forEach(u=>this.removeInPlace(u,i))});d(this,"removeFromStore",(e,s)=>{const i=s(e);this._cache.delete(i)});d(this,"addInPlace",(e,s)=>{const i=s(e),u=e.referenceCount??1,l=this._cache.get(i),p=e.status??(l==null?void 0:l.status)??kt.active;l?(l.referenceCount+=u,l.status=p,l.pinned=e.pinned??l.pinned,l.showWarning=e.showWarning??l.showWarning):this._cache.set(i,{...e,pinned:void 0,referenceCount:u,status:p})});d(this,"removeInPlace",(e,s)=>{const i=s(e),u=this._cache.get(i);u&&(u.referenceCount-=1,u.referenceCount===0&&this._cache.delete(i))});d(this,"setStatus",(e,s)=>{const i=this._cache.get(e);i&&(i.status=s)});d(this,"togglePinned",e=>{const s=this._cache.peek(e);s&&(s.pinned?this.unpin(e):this.pin(e))});d(this,"pin",e=>{const s=this._cache.peek(e);s&&!s.pinned&&(s.pinned=!0,s.referenceCount+=1)});d(this,"unpin",e=>{const s=this._cache.peek(e);s&&s.pinned&&(s.pinned=!1,s.referenceCount-=1,s.referenceCount===0&&this._cache.delete(e))});d(this,"toggleStatus",e=>{const s=this._cache.get(e);s&&(s.status=s.status===kt.active?kt.inactive:kt.active)})}get store(){return Object.fromEntries(this._cache.entries())}get values(){return[...this._cache.values()]}}function mg(a){try{const e=new Date(a);if(isNaN(e.getTime()))return"Unknown time";const s=new Date().getTime()-e.getTime(),i=Math.floor(s/1e3),u=Math.floor(i/60),l=Math.floor(u/60),p=Math.floor(l/24);return i<60?`${i}s ago`:u<60?`${u}m ago`:l<24?`${l}h ago`:p<30?`${p}d ago`:e.toLocaleDateString()}catch(e){return console.error("Error formatting date:",e),"Unknown time"}}function yg(a){switch(a){case pe.agentStarting:return"Starting";case pe.agentRunning:return"Running";case pe.agentIdle:return"Idle";case pe.agentFailed:return"Failed";default:return"Unknown"}}const Rc=a=>{let e={};for(const s of a){const i=e[s.new_path];e[s.new_path]=i?{...i,new_contents:s.new_contents,new_path:s.new_path}:s}return Object.values(e)},bf=a=>{const e=a.flatMap(s=>s.changed_files);return Rc(e)},vg=(a,e)=>{const s=a.slice(0,e).findLastIndex(u=>u.exchange.request_message),i=a.slice(s+1,e+1).flatMap(u=>u.changed_files);return Rc(i)},bg=(a,e)=>{var i;const s=a.slice(0,e).findLastIndex(u=>u.exchange.request_message);return((i=a[s])==null?void 0:i.exchange.request_message)??""};class Fc{constructor(e){d(this,"_applyingFilePaths",nn([]));d(this,"_appliedFilePaths",nn([]));this._asyncMsgSender=e}get applyingFilePaths(){let e=[];return this._applyingFilePaths.subscribe(s=>{e=s})(),e}get appliedFilePaths(){let e=[];return this._appliedFilePaths.subscribe(s=>{e=s})(),e}async getDiffExplanation(e,s,i=3e4){try{return(await this._asyncMsgSender.send({type:T.diffExplanationRequest,data:{changedFiles:e,apikey:s}},i)).data.explanation}catch(u){return console.error("Failed to get diff explanation:",u),[]}}async groupChanges(e,s=!1,i){try{return(await this._asyncMsgSender.send({type:T.diffGroupChangesRequest,data:{changedFiles:e,changesById:s,apikey:i}})).data.groupedChanges}catch(u){return console.error("Failed to group changes:",u),[]}}async getDescriptions(e,s){try{return(await this._asyncMsgSender.send({type:T.diffDescriptionsRequest,data:{groupedChanges:e,apikey:s}})).data.explanation}catch(i){return console.error("Failed to get descriptions:",i),[]}}async applyChanges(e,s,i){this._applyingFilePaths.update(u=>[...u.filter(l=>l!==e),e]);try{(await this._asyncMsgSender.send({type:T.applyChangesRequest,data:{path:e,originalCode:s,newCode:i}})).data.success&&this._appliedFilePaths.update(u=>[...u.filter(l=>l!==e),e])}catch(u){console.error("applyChanges error",u)}finally{this._applyingFilePaths.update(u=>u.filter(l=>l!==e))}}handleMessageFromExtension(e){return!1}}d(Fc,"key","remoteAgentsDiffOpsModel");class Sf{constructor(e,s,i){d(this,"_state",{isActive:!1,isPanelFocused:!1,currentAgentId:void 0,currentConversation:void 0,currentAgent:void 0,agentOverviews:[],isLoading:!1,isBackgroundRefreshing:!1,lastSuccessfulOverviewFetch:0,failedRefreshAttempts:0,maxRemoteAgents:0,isDiffPanelOpen:!1,isCreatingAgent:!1,error:void 0,agentThreadsError:void 0,remoteAgentCreationError:null,newAgentDraft:null,notificationSettings:{},setCurrentAgent:this.setCurrentAgent.bind(this),clearCurrentAgent:this.clearCurrentAgent.bind(this),sendMessage:this.sendMessage.bind(this),interruptAgent:this.interruptAgent.bind(this),createRemoteAgent:this.createRemoteAgent.bind(this),createRemoteAgentFromDraft:this.createRemoteAgentFromDraft.bind(this),deleteAgent:this.deleteAgent.bind(this),setNewAgentDraft:this.setNewAgentDraft.bind(this),setRemoteAgentCreationError:this.setRemoteAgentCreationError.bind(this),hasFetchedOnce:!1,showRemoteAgentDiffPanel:this.showRemoteAgentDiffPanel.bind(this),closeRemoteAgentDiffPanel:this.closeRemoteAgentDiffPanel.bind(this),setIsCreatingAgent:this.setIsCreatingAgent.bind(this)});d(this,"_agentConversations",new Map);d(this,"_initialPrompts",new Map);d(this,"_logPollingTimer",null);d(this,"_agentSetupLogsCache",new Map);d(this,"_preloadedDiffExplanations",new Map);d(this,"maxCacheEntries",10);d(this,"maxCacheSizeBytes",10485760);d(this,"_diffOpsModel");d(this,"subscribers",new Set);d(this,"_historyPollingTimer",null);d(this,"_overviewsPollingTimer",null);d(this,"agentSetupLogs");d(this,"agentHistoryRetries",3);d(this,"_agentHistoryRetryCount",0);d(this,"dispose",()=>{this.stopPolling(),this._agentConversations.clear(),this._agentSetupLogsCache.clear(),this._preloadedDiffExplanations.clear(),this.subscribers.clear()});this._asyncMsgSender=e,this._flagsModel=i,this._state.isActive=s,this._diffOpsModel=new Fc(e),this._flagsModel.subscribe(u=>{const l=this._historyPollingTimer||this._overviewsPollingTimer,p=u.enableBackgroundAgents;p&&!l?this.startPolling():!p&&l&&this.stopPolling()}),this._flagsModel.enableBackgroundAgents&&this.startPolling()}subscribe(e){return this.subscribers.add(e),e(this),()=>{this.subscribers.delete(e)}}notifySubscribers(){this.subscribers.forEach(e=>e(this))}showRemoteAgentDiffPanel(e){const s=this._state.currentAgentId;if(s&&e.changedFiles.length>0){const i=`${s}-${this.generateChangedFilesHash(e.changedFiles)}`,u=this._preloadedDiffExplanations.get(i);if(u)return u.lastAccessed=Date.now(),this._preloadedDiffExplanations.set(i,u),void this._asyncMsgSender.send({type:T.showRemoteAgentDiffPanel,data:{...e,preloadedExplanation:u.explanation}})}this._asyncMsgSender.send({type:T.showRemoteAgentDiffPanel,data:e}),this._state.isDiffPanelOpen=!0}closeRemoteAgentDiffPanel(){this._asyncMsgSender.send({type:T.closeRemoteAgentDiffPanel}),this._state.isDiffPanelOpen=!1}getCurrentChatHistory(){var u;const e=((u=this.currentConversation)==null?void 0:u.exchanges)??[],s=this.isCurrentAgentRunning,i=this.agentSetupLogs;if(this.currentAgentId&&!i&&this._startLogPolling(this.currentAgentId),e.length===0&&this.currentAgentId){const l=this.getInitialPrompt(this.currentAgentId);if(l)return[{seen_state:Lt.seen,structured_request_nodes:[{id:0,type:$t.TEXT,text_node:{content:l}}],status:ot.sent,request_message:l,response_text:"Waiting for agent to start...",structured_output_nodes:[],request_id:"remote-agent-initial"}]}return e.map(({exchange:l},p)=>{const y=l.request_id.startsWith("pending-");return{seen_state:Lt.seen,structured_request_nodes:l.request_nodes??[],status:y||p===e.length-1&&s?ot.sent:ot.success,request_message:l.request_message,response_text:y?"":l.response_text,structured_output_nodes:l.response_nodes??[],request_id:l.request_id??`remote-agent-${p}`}})}getToolStates(){var y,v,E;const e=new Map,s=new Set,i=new Map;(y=this.currentConversation)==null||y.exchanges.forEach(R=>{var O,ut;(O=R.exchange.response_nodes)==null||O.forEach(J=>{J.tool_use&&s.add(J.tool_use.tool_use_id)}),(ut=R.exchange.request_nodes)==null||ut.forEach(J=>{J.type===$t.TOOL_RESULT&&J.tool_result_node&&i.set(J.tool_result_node.tool_use_id,J.tool_result_node)})});const u=(v=this.currentConversation)==null?void 0:v.exchanges[this.currentConversation.exchanges.length-1];let l=0,p=null;return(E=u==null?void 0:u.exchange.response_nodes)==null||E.forEach(R=>{var O;R.id>l&&(l=R.id,p=(O=R.tool_use)!=null&&O.tool_use_id?R.tool_use.tool_use_id:null)}),s.forEach(R=>{const O=i.get(R);if(O)e.set(R,{phase:O.is_error?Xt.error:Xt.completed,result:{isError:O.is_error,text:O.content},requestId:"",toolUseId:R});else{const ut=this.isCurrentAgentRunning;R===p?e.set(R,{phase:ut?Xt.running:Xt.cancelled,requestId:"",toolUseId:R}):e.set(R,{phase:Xt.cancelled,requestId:"",toolUseId:R})}}),e}getToolUseState(e){const s=e;return this.getToolStates().get(s)??{phase:Xt.completed,requestId:"",toolUseId:e}}async setCurrentAgent(e){if(this._stopLogPolling(),this._state.currentAgentId=e,e&&this._agentSetupLogsCache.has(e)?this.agentSetupLogs=this._agentSetupLogsCache.get(e):this.agentSetupLogs=void 0,this._agentHistoryRetryCount=0,this.notifySubscribers(),!e)return;await Promise.allSettled([this.refreshAgentOverviews(),this.fetchAgentConversation(e)]);const s=this._state.agentOverviews.find(i=>i.remote_agent_id===e);s&&s.status===pe.agentStarting&&this._startLogPolling(e),this.preloadDiffExplanation(e)}clearCurrentAgent(){this._state.currentAgentId=void 0,this.agentSetupLogs=void 0,this._agentHistoryRetryCount=0,this.notifySubscribers()}async preloadDiffExplanation(e){const s=this._agentConversations.get(e);if(!s||s.exchanges.length===0)return;const i=bf(s.exchanges);if(i.length===0)return;const u=`${e}-${this.generateChangedFilesHash(i)}`;if(this._preloadedDiffExplanations.get(u)||i.length>12)return;let l=0;if(i.forEach(p=>{var y,v;l+=(((y=p.old_contents)==null?void 0:y.length)||0)+(((v=p.new_contents)==null?void 0:v.length)||0)}),!(l>512e3))try{const p=await this._diffOpsModel.getDiffExplanation(i,void 0,6e4);if(p&&p.length>0){const y=this.generateChangedFilesHash(i),v=`${e}-${y}`;this._preloadedDiffExplanations.set(v,{explanation:p,changedFiles:i,userPrompt:this.getUserMessagePrecedingTurn(s.exchanges,0),timestamp:Date.now(),lastAccessed:Date.now(),changedFilesHash:y}),this.manageCacheSize()}}catch(p){console.error("Failed to preload diff explanation:",p)}}getUserMessagePrecedingTurn(e,s){return e.length===0||s<0||s>=e.length?"":e[s].exchange.request_message||""}generateChangedFilesHash(e){const s=e.map(i=>{var u,l;return{oldPath:i.old_path,newPath:i.new_path,oldSize:((u=i.old_contents)==null?void 0:u.length)||0,newSize:((l=i.new_contents)==null?void 0:l.length)||0,oldHash:this.simpleHash(i.old_contents||""),newHash:this.simpleHash(i.new_contents||"")}});return this.simpleHash(JSON.stringify(s))}simpleHash(e){let s=0;for(let i=0;i<e.length;i++)s=(s<<5)-s+e.charCodeAt(i),s|=0;return s.toString(36)}manageCacheSize(){if(this._preloadedDiffExplanations.size<=this.maxCacheEntries)return;const e=Array.from(this._preloadedDiffExplanations.entries()).map(([i,u])=>({key:i,value:u,accessTime:u.lastAccessed||u.timestamp})).sort((i,u)=>i.accessTime-u.accessTime);let s=0;for(e.forEach(i=>{const u=JSON.stringify(i.value.explanation).length,l=i.value.changedFiles.reduce((p,y)=>{var v,E;return p+(((v=y.old_contents)==null?void 0:v.length)||0)+(((E=y.new_contents)==null?void 0:E.length)||0)},0);s+=u+l});e.length>0&&(e.length>this.maxCacheEntries||s>this.maxCacheSizeBytes);){const i=e.shift();if(i){this._preloadedDiffExplanations.delete(i.key);const u=JSON.stringify(i.value.explanation).length,l=i.value.changedFiles.reduce((p,y)=>{var v,E;return p+(((v=y.old_contents)==null?void 0:v.length)||0)+(((E=y.new_contents)==null?void 0:E.length)||0)},0);s-=u+l}}}async fetchAgentConversation(e){var s,i,u;if(e&&((s=this.currentAgent)==null?void 0:s.status)!==pe.agentStarting){this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{const l=this.getfinalSequenceId(e)??0,p=l===0?0:l-1,y=await this._asyncMsgSender.send({type:T.getRemoteAgentChatHistoryRequest,data:{agentId:e,lastProcessedSequenceId:p}},1e4);if(y.data.error){if(y.data.error==="HTTP error: 404 Not Found")return this._agentHistoryRetryCount++,void(this._agentHistoryRetryCount>this.agentHistoryRetries&&this.clearCurrentAgent());throw new Error(y.data.error)}const v=y.data.chatHistory.filter(J=>J.exchange!==null),E=((i=this._agentConversations.get(e))==null?void 0:i.exchanges)||[],R=v.length>E.length,O=(u=this._agentConversations.get(e))==null?void 0:u.exchanges,ut=O?function(J,V){if(J.length===0)return V;if(V.length===0)return J;const it=[];let st=0,H=0;for(;st<J.length&&H<V.length;){const ht=J[st].sequence_id,ie=V[H].sequence_id;ie!==void 0?ht!==void 0?ht<ie?(it.push(J[st]),st++):ht>ie?(it.push(V[H]),H++):(it.push(V[H]),st++,H++):(console.warn("Existing history has an exchange with an undefined sequence ID"),st++):(console.warn("New history has an exchange with an undefined sequence ID"),H++)}for(;st<J.length;)it.push(J[st]),st++;for(;H<V.length;)it.push(V[H]),H++;return it}(O,v):v;this._agentConversations.set(e,{exchanges:ut,lastFetched:new Date}),this._state.currentConversation=this._agentConversations.get(e),v.length>0&&(this.clearInitialPrompt(e),R&&this.preloadDiffExplanation(e))}catch(l){this._state.error=l instanceof Error?l.message:String(l)}finally{this._state.isLoading=!1,this.notifySubscribers()}}}async sendMessage(e){const s=this._state.currentAgentId;if(!s)return this._state.error="No active remote agent",this.notifySubscribers(),!1;this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{const i=this._agentConversations.get(s)||{exchanges:[],lastFetched:new Date},u=(this.getfinalSequenceId(s)||0)+1,l={exchange:{request_message:e,response_text:"",request_id:"pending-"+Date.now(),response_nodes:[],request_nodes:[]},changed_files:[],sequence_id:u};i.exchanges.push(l),this._agentConversations.set(s,i),this._state.currentConversation=i,this.notifySubscribers();const p={request_nodes:[{id:1,type:$t.TEXT,text_node:{content:e}}]};return await this._asyncMsgSender.send({type:T.remoteAgentChatRequest,data:{agentId:s,requestDetails:p}},1e4),Promise.allSettled([this.fetchAgentConversation(s),this.refreshAgentOverviews()]),!0}catch(i){return this._state.error=i instanceof Error?i.message:String(i),this.notifySubscribers(),!1}finally{this._state.isLoading=!1,this.preloadDiffExplanation(s),this.notifySubscribers()}}async interruptAgent(){const e=this._state.currentAgentId;if(!e)return this._state.error="No active remote agent",void this.notifySubscribers();this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{await this._asyncMsgSender.send({type:T.remoteAgentInterruptRequest,data:{agentId:e}},1e4);const s=this._agentConversations.get(e);s&&this._agentConversations.set(e,s)}catch(s){this._state.error=s instanceof Error?s.message:String(s)}finally{this._state.isLoading=!1,this.notifySubscribers()}}async createRemoteAgent(e,s,i){var u;if(!e||!e.trim())return this._state.error="Cannot create a remote agent with an empty prompt",void this.notifySubscribers();this.agentSetupLogs=void 0,this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{const l=await this._asyncMsgSender.send({type:T.createRemoteAgentRequest,data:{prompt:e,workspaceSetup:s,setupScript:i}},1e4);return l.data.agentId?(this._initialPrompts.set(l.data.agentId,e),await this.setNotificationEnabled(l.data.agentId,((u=this.newAgentDraft)==null?void 0:u.enableNotification)??!1),await this.setCurrentAgent(l.data.agentId),l.data.agentId):(this._state.error="Failed to create remote agent",void this.notifySubscribers())}catch(l){return this._state.error=l instanceof Error?l.message:String(l),void this.notifySubscribers()}finally{this._state.isLoading=!1,this.notifySubscribers()}}async createRemoteAgentFromDraft(e){var u;if(this.setRemoteAgentCreationError(null),this.agentSetupLogs=void 0,!e||!e.trim())return void this.setRemoteAgentCreationError("Cannot create a remote agent with an empty prompt");const s=this._state.newAgentDraft;if(!s)return void this.setRemoteAgentCreationError("No workspace selected. Please select a workspace first.");if(s.isDisabled)return void this.setRemoteAgentCreationError("Cannot create agent with current workspace selection. Please resolve the issues with your workspace selection.");const i={starting_files:s.commitRef};this._state.isLoading=!0,this.notifySubscribers();try{let l=(u=s.setupScript)==null?void 0:u.content;if(s.setupScript){const y=(await this.listSetupScripts()).find(v=>v.path===s.setupScript.path);y&&(l=y.content)}const p=await this.createRemoteAgent(e,i,l);return p||this.setRemoteAgentCreationError("Failed to create remote agent. Please try again."),p}catch{this.setRemoteAgentCreationError("Failed to create remote agent. Please try again.")}finally{this._state.isLoading=!1,this.notifySubscribers()}}async deleteAgent(e){this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{if(!(await this._asyncMsgSender.send({type:T.deleteRemoteAgentRequest,data:{agentId:e}},1e4)).data.success)return this._state.error="Failed to delete remote agent",void this.notifySubscribers();this._agentConversations.delete(e),this._agentSetupLogsCache.delete(e),this._state.agentOverviews=this._state.agentOverviews.filter(s=>s.remote_agent_id!==e),this.removeNotificationEnabled(e),this._state.currentAgentId===e&&this.clearCurrentAgent()}catch(s){this._state.error=s instanceof Error?s.message:String(s)}finally{this._state.isLoading=!1,this.notifySubscribers()}}async sshToRemoteAgent(e){this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{const s=await this._asyncMsgSender.send({type:T.remoteAgentSshRequest,data:{agentId:e.remote_agent_id}},1e4);return!!s.data.success||(console.error("Failed to connect to remote agent:",s.data.error),this.notifySubscribers(),!1)}catch(s){return this._state.error=s instanceof Error?s.message:String(s),this.notifySubscribers(),!1}finally{this._state.isLoading=!1,this.notifySubscribers()}}async refreshCurrentAgent(){const e=this._state.currentAgentId;e&&await this.fetchAgentConversation(e)}async refreshAgentOverviews(){const e=!this._state.hasFetchedOnce;e?this._state.isLoading=!0:this._state.isBackgroundRefreshing=!0,(e||this._state.failedRefreshAttempts===0)&&(this._state.agentThreadsError=void 0),this.notifySubscribers();const s=Math.min(1e3*Math.pow(2,this._state.failedRefreshAttempts),1e4);try{const i=await this._asyncMsgSender.send({type:T.getRemoteAgentOverviewsRequest},1e4);if(i.data.error)throw new Error(i.data.error);this._state.failedRefreshAttempts=0,this._state.lastSuccessfulOverviewFetch=Date.now(),i.data.maxRemoteAgents!==void 0&&(this._state.maxRemoteAgents=i.data.maxRemoteAgents);const u=this._state.agentOverviews,l=i.data.overviews,p=new Map(u.map(E=>[E.remote_agent_id,E])),y=await this.getRemoteAgentNotificationEnabled(l.map(E=>E.remote_agent_id));l.forEach(E=>{const R=p.get(E.remote_agent_id),O=y[E.remote_agent_id],ut=(R==null?void 0:R.status)===pe.agentRunning,J=E.status===pe.agentIdle||E.status===pe.agentFailed,V=E.remote_agent_id!==this._state.currentAgentId,it=this._state.isPanelFocused;O&&ut&&J&&(V||!it)&&this.notifyRemoteAgentReady(E.remote_agent_id)});const v=l.sort((E,R)=>{const O=new Date(E.updated_at||E.started_at);return new Date(R.updated_at||R.started_at).getTime()-O.getTime()});if(this._state.currentAgentId){const E=v.findIndex(R=>R.remote_agent_id===this._state.currentAgentId);if(E===-1&&this.clearCurrentAgent(),E>0){const R=v.splice(E,1)[0];v.unshift(R)}}return this._state.agentOverviews=v,this.notifySubscribers(),v}catch(i){return this._state.failedRefreshAttempts++,console.error("Failed to get remote agent overviews:",i),e||this._state.agentOverviews.length===0?this._state.agentThreadsError=i instanceof Error?i.message:String(i):(console.warn("Background refresh failed:",i),Date.now()-this._state.lastSuccessfulOverviewFetch>3e4&&!this._state.agentThreadsError&&this._state.failedRefreshAttempts>1&&(this._state.agentThreadsError="Using cached data. Refresh failed: "+(i instanceof Error?i.message:String(i)))),this._state.failedRefreshAttempts<=3&&setTimeout(()=>{this._state.isActive&&this.refreshAgentOverviews()},s),this.notifySubscribers(),this._state.agentOverviews}finally{this._state.isLoading=!1,this._state.isBackgroundRefreshing=!1,this._state.hasFetchedOnce=!0,this.notifySubscribers()}}async getRemoteAgentNotificationEnabled(e){return(await this._asyncMsgSender.send({type:T.getRemoteAgentNotificationEnabledRequest,data:{agentIds:e}})).data}async setRemoteAgentNotificationEnabled(e,s){await this._asyncMsgSender.send({type:T.setRemoteAgentNotificationEnabled,data:{agentId:e,enabled:s}})}async deleteRemoteAgentNotificationEnabled(e){await this._asyncMsgSender.send({type:T.deleteRemoteAgentNotificationEnabled,data:{agentId:e}})}refreshAgentNotificationSettings(){this._state.isLoading=!0,this.notifySubscribers();try{this.getRemoteAgentNotificationEnabled().then(e=>{this._state.notificationSettings=e,this.notifySubscribers()})}catch(e){console.error("Failed to get remote agent notification settings:",e)}}async setNotificationEnabled(e,s){await this.setRemoteAgentNotificationEnabled(e,s),this._state={...this._state,notificationSettings:{...this._state.notificationSettings,[e]:s}},this.notifySubscribers()}async removeNotificationEnabled(e){await this.deleteRemoteAgentNotificationEnabled(e);const{[e]:s,...i}=this._state.notificationSettings;this._state={...this._state,notificationSettings:i},this.notifySubscribers()}async notifyRemoteAgentReady(e){await this._asyncMsgSender.send({type:T.remoteAgentNotifyReady,data:{agentId:e}})}get hasFetchedOnce(){return this._state.hasFetchedOnce}handleMessageFromExtension(e){const s=e.data.type===T.asyncWrapper?e.data.baseMsg.type:e.data.type;if(!e||!s)return!1;switch(s){case T.remoteAgentChatResponse:return this._state.currentAgentId&&setTimeout(()=>{this.preloadDiffExplanation(this._state.currentAgentId)},0),!0;case T.getRemoteAgentChatHistoryResponse:case T.remoteAgentInterruptResponse:case T.createRemoteAgentResponse:case T.getRemoteAgentOverviewsResponse:return!0;case T.showRemoteAgentDiffPanel:return this._state.isDiffPanelOpen=!0,!0;case T.closeRemoteAgentDiffPanel:return this._state.isDiffPanelOpen=!1,!0;default:return!1}}get currentAgentId(){return this._state.currentAgentId}get currentConversation(){return this._agentConversations.get(this._state.currentAgentId??"")??void 0}get currentExchanges(){var s;const e=this._state.currentAgentId;return e&&((s=this._agentConversations.get(e))==null?void 0:s.exchanges)||[]}get currentStatus(){var s;const e=this._state.currentAgentId;return e&&((s=this._state.agentOverviews.find(i=>i.remote_agent_id===e))==null?void 0:s.status)||pe.agentIdle}get currentAgent(){const e=this._state.currentAgentId;return e?this._state.agentOverviews.find(s=>s.remote_agent_id===e):void 0}get agentOverviews(){return this._state.agentOverviews}get isLoading(){return this._state.isLoading}get isBackgroundRefreshing(){return this._state.isBackgroundRefreshing}get lastSuccessfulOverviewFetch(){return this._state.lastSuccessfulOverviewFetch}get error(){return this._state.error}get agentThreadsError(){return this._state.agentThreadsError}get isCurrentAgentRunning(){if(this.currentStatus===pe.agentRunning||this.currentStatus===pe.agentStarting)return!0;const e=this.currentExchanges;return!!(e.length>0&&e[e.length-1].exchange.request_id.startsWith("pending-"))}get maxRemoteAgents(){return this._state.maxRemoteAgents}getInitialPrompt(e){return this._initialPrompts.get(e)}clearInitialPrompt(e){this._initialPrompts.delete(e)}get notificationSettings(){return this._state.notificationSettings}getfinalSequenceId(e){var u;const s=this._agentConversations.get(e),i=s==null?void 0:s.exchanges;if(i)return((u=i[i.length-1])==null?void 0:u.sequence_id)??void 0}async listSetupScripts(){try{return(await this._asyncMsgSender.send({type:T.listSetupScriptsRequest},5e3)).data.scripts}catch(e){return this._state.error=e instanceof Error?e.message:String(e),this.notifySubscribers(),[]}}async saveSetupScript(e,s,i){try{const u=await this._asyncMsgSender.send({type:T.saveSetupScriptRequest,data:{name:e,content:s,location:i}},5e3);return u.data.success||(this._state.error=u.data.error||"Failed to save setup script",this.notifySubscribers()),u.data}catch(u){return this._state.error=u instanceof Error?u.message:String(u),this.notifySubscribers(),{success:!1,error:u instanceof Error?u.message:String(u)}}}async deleteSetupScript(e,s){try{const i=await this._asyncMsgSender.send({type:T.deleteSetupScriptRequest,data:{name:e,location:s}},5e3);return i.data.success||(this._state.error=i.data.error||"Failed to delete setup script",this.notifySubscribers()),i.data}catch(i){return this._state.error=i instanceof Error?i.message:String(i),this.notifySubscribers(),{success:!1,error:i instanceof Error?i.message:String(i)}}}async renameSetupScript(e,s,i){try{const u=await this._asyncMsgSender.send({type:T.renameSetupScriptRequest,data:{oldName:e,newName:s,location:i}},5e3);return u.data.success||(this._state.error=u.data.error||"Failed to rename setup script",this.notifySubscribers()),u.data}catch(u){return this._state.error=u instanceof Error?u.message:String(u),this.notifySubscribers(),{success:!1,error:u instanceof Error?u.message:String(u)}}}startPolling(){this._flagsModel.enableBackgroundAgents&&(this.stopPolling(),this.refreshCurrentAgent(),this.refreshAgentOverviews(),this.refreshAgentNotificationSettings(),this._historyPollingTimer=setInterval(()=>{this._state.isActive&&this.refreshCurrentAgent()},1e3),this._overviewsPollingTimer=setInterval(()=>{this._state.isActive&&this.refreshAgentOverviews()},5e3))}stopPolling(){this._historyPollingTimer&&(clearInterval(this._historyPollingTimer),this._historyPollingTimer=null),this._overviewsPollingTimer&&(clearInterval(this._overviewsPollingTimer),this._overviewsPollingTimer=null),this._logPollingTimer&&(clearInterval(this._logPollingTimer),this._logPollingTimer=null)}get isActive(){return this._state.isActive}setIsActive(e){this._state.isActive=e,this.notifySubscribers()}get isPanelFocused(){return this._state.isPanelFocused}setIsPanelFocused(e){this._state.isPanelFocused=e,this.notifySubscribers()}setRemoteAgentCreationError(e){this._state.remoteAgentCreationError=e,this.notifySubscribers()}get isDiffPanelOpen(){return this._state.isDiffPanelOpen}get remoteAgentCreationError(){return this._state.remoteAgentCreationError}setNewAgentDraft(e){this._state.newAgentDraft=e,this.notifySubscribers()}get newAgentDraft(){return this._state.newAgentDraft}async getAgentLogs(e){this._state.isLoading=!0,this._state.error=void 0,this.notifySubscribers();try{const s=await this._asyncMsgSender.send({type:T.remoteAgentWorkspaceLogsRequest,data:{agentId:e}},1e4);return s.data.workspaceSetupStatus?s.data.workspaceSetupStatus:void 0}catch(s){const i=s instanceof Error?s.message:String(s);return this._state.error=i,void this.notifySubscribers()}finally{this._state.isLoading=!1,this.notifySubscribers()}}setIsCreatingAgent(e){this._state.isCreatingAgent=e,this.notifySubscribers()}get isCreatingAgent(){return this._state.isCreatingAgent}_startLogPolling(e){this._logPollingTimer&&this._stopLogPolling(),this.agentSetupLogs={steps:[]},this._fetchAgentLogs(e),this._logPollingTimer=setInterval(()=>{this._fetchAgentLogs(e)},1e3)}_stopLogPolling(){this._logPollingTimer&&(clearInterval(this._logPollingTimer),this._logPollingTimer=null)}async _fetchAgentLogs(e){var i;try{const u=await this.getAgentLogs(e);if(u){const p={steps:(s=u,(i=s==null?void 0:s.steps)!=null&&i.length?s.steps.reduce((v,E)=>{const R=v[v.length-1];return R&&R.step_number===E.step_number?(R.logs+=`
${E.logs}`,R.status=E.status):v.push(E),v},[]):[])};let y=!1;if(this.agentSetupLogs&&p.steps.length===this.agentSetupLogs.steps.length){for(let v=0;v<p.steps.length;v++){if(p.steps[v].status!==this.agentSetupLogs.steps[v].status){y=!0;break}if(p.steps[v].logs.length!==this.agentSetupLogs.steps[v].logs.length){y=!0;break}}y||JSON.stringify(p)!==JSON.stringify(this.agentSetupLogs)&&(y=!0)}else y=!0;y&&(this.agentSetupLogs=p,this._agentSetupLogsCache.set(e,p),this.notifySubscribers())}const l=this._state.agentOverviews.find(p=>p.remote_agent_id===e);if(l&&l.status!==pe.agentStarting)return void this._stopLogPolling()}catch(u){console.error("Error fetching agent logs:",u)}var s}}d(Sf,"key","remoteAgentsModel");var qr,Pr,xa={exports:{}};qr=xa,Pr=xa.exports,(function(){var a,e="Expected a function",s="__lodash_hash_undefined__",i="__lodash_placeholder__",u=16,l=32,p=64,y=128,v=256,E=1/0,R=9007199254740991,O=NaN,ut=4294967295,J=[["ary",y],["bind",1],["bindKey",2],["curry",8],["curryRight",u],["flip",512],["partial",l],["partialRight",p],["rearg",v]],V="[object Arguments]",it="[object Array]",st="[object Boolean]",H="[object Date]",ht="[object Error]",ie="[object Function]",ae="[object GeneratorFunction]",bt="[object Map]",Ee="[object Number]",qt="[object Object]",$e="[object Promise]",Ue="[object RegExp]",Te="[object Set]",us="[object String]",Ps="[object Symbol]",cs="[object WeakMap]",ls="[object ArrayBuffer]",Hn="[object DataView]",Ur="[object Float32Array]",jr="[object Float64Array]",zr="[object Int8Array]",Br="[object Int16Array]",Wr="[object Int32Array]",Gr="[object Uint8Array]",$r="[object Uint8ClampedArray]",Vr="[object Uint16Array]",Zr="[object Uint32Array]",qc=/\b__p \+= '';/g,Pc=/\b(__p \+=) '' \+/g,Dc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ea=/&(?:amp|lt|gt|quot|#39);/g,Ta=/[&<>"']/g,Oc=RegExp(Ea.source),kc=RegExp(Ta.source),Lc=/<%-([\s\S]+?)%>/g,Nc=/<%([\s\S]+?)%>/g,Ma=/<%=([\s\S]+?)%>/g,Hc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Uc=/^\w*$/,jc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jr=/[\\^$.*+?()[\]{}|]/g,zc=RegExp(Jr.source),Yr=/^\s+/,Bc=/\s/,Wc=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gc=/\{\n\/\* \[wrapped with (.+)\] \*/,$c=/,? & /,Vc=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zc=/[()=,{}\[\]\/\s]/,Jc=/\\(\\)?/g,Yc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ra=/\w*$/,Kc=/^[-+]0x[0-9a-f]+$/i,Xc=/^0b[01]+$/i,Qc=/^\[object .+?Constructor\]$/,tl=/^0o[0-7]+$/i,el=/^(?:0|[1-9]\d*)$/,nl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ds=/($^)/,sl=/['\n\r\u2028\u2029\\]/g,Os="\\ud800-\\udfff",Fa="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",qa="\\u2700-\\u27bf",Pa="a-z\\xdf-\\xf6\\xf8-\\xff",Da="A-Z\\xc0-\\xd6\\xd8-\\xde",Oa="\\ufe0e\\ufe0f",ka="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rl="[']",il="["+Os+"]",La="["+ka+"]",ks="["+Fa+"]",Na="\\d+",al="["+qa+"]",Ha="["+Pa+"]",Ua="[^"+Os+ka+Na+qa+Pa+Da+"]",Kr="\\ud83c[\\udffb-\\udfff]",ja="[^"+Os+"]",Xr="(?:\\ud83c[\\udde6-\\uddff]){2}",Qr="[\\ud800-\\udbff][\\udc00-\\udfff]",Un="["+Da+"]",za="\\u200d",Ba="(?:"+Ha+"|"+Ua+")",ol="(?:"+Un+"|"+Ua+")",Wa="(?:['](?:d|ll|m|re|s|t|ve))?",Ga="(?:['](?:D|LL|M|RE|S|T|VE))?",$a="(?:"+ks+"|"+Kr+")?",Va="["+Oa+"]?",Za=Va+$a+"(?:"+za+"(?:"+[ja,Xr,Qr].join("|")+")"+Va+$a+")*",ul="(?:"+[al,Xr,Qr].join("|")+")"+Za,cl="(?:"+[ja+ks+"?",ks,Xr,Qr,il].join("|")+")",ll=RegExp(rl,"g"),hl=RegExp(ks,"g"),ti=RegExp(Kr+"(?="+Kr+")|"+cl+Za,"g"),dl=RegExp([Un+"?"+Ha+"+"+Wa+"(?="+[La,Un,"$"].join("|")+")",ol+"+"+Ga+"(?="+[La,Un+Ba,"$"].join("|")+")",Un+"?"+Ba+"+"+Wa,Un+"+"+Ga,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Na,ul].join("|"),"g"),fl=RegExp("["+za+Os+Fa+Oa+"]"),gl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],_l=-1,gt={};gt[Ur]=gt[jr]=gt[zr]=gt[Br]=gt[Wr]=gt[Gr]=gt[$r]=gt[Vr]=gt[Zr]=!0,gt[V]=gt[it]=gt[ls]=gt[st]=gt[Hn]=gt[H]=gt[ht]=gt[ie]=gt[bt]=gt[Ee]=gt[qt]=gt[Ue]=gt[Te]=gt[us]=gt[cs]=!1;var ft={};ft[V]=ft[it]=ft[ls]=ft[Hn]=ft[st]=ft[H]=ft[Ur]=ft[jr]=ft[zr]=ft[Br]=ft[Wr]=ft[bt]=ft[Ee]=ft[qt]=ft[Ue]=ft[Te]=ft[us]=ft[Ps]=ft[Gr]=ft[$r]=ft[Vr]=ft[Zr]=!0,ft[ht]=ft[ie]=ft[cs]=!1;var ml={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},yl=parseFloat,vl=parseInt,Ja=typeof Is=="object"&&Is&&Is.Object===Object&&Is,bl=typeof self=="object"&&self&&self.Object===Object&&self,Nt=Ja||bl||Function("return this")(),ei=Pr&&!Pr.nodeType&&Pr,wn=ei&&qr&&!qr.nodeType&&qr,Ya=wn&&wn.exports===ei,ni=Ya&&Ja.process,ye=function(){try{var S=wn&&wn.require&&wn.require("util").types;return S||ni&&ni.binding&&ni.binding("util")}catch{}}(),Ka=ye&&ye.isArrayBuffer,Xa=ye&&ye.isDate,Qa=ye&&ye.isMap,to=ye&&ye.isRegExp,eo=ye&&ye.isSet,no=ye&&ye.isTypedArray;function oe(S,A,I){switch(I.length){case 0:return S.call(A);case 1:return S.call(A,I[0]);case 2:return S.call(A,I[0],I[1]);case 3:return S.call(A,I[0],I[1],I[2])}return S.apply(A,I)}function Sl(S,A,I,D){for(var Y=-1,rt=S==null?0:S.length;++Y<rt;){var Tt=S[Y];A(D,Tt,I(Tt),S)}return D}function ve(S,A){for(var I=-1,D=S==null?0:S.length;++I<D&&A(S[I],I,S)!==!1;);return S}function Cl(S,A){for(var I=S==null?0:S.length;I--&&A(S[I],I,S)!==!1;);return S}function so(S,A){for(var I=-1,D=S==null?0:S.length;++I<D;)if(!A(S[I],I,S))return!1;return!0}function rn(S,A){for(var I=-1,D=S==null?0:S.length,Y=0,rt=[];++I<D;){var Tt=S[I];A(Tt,I,S)&&(rt[Y++]=Tt)}return rt}function Ls(S,A){return!(S==null||!S.length)&&jn(S,A,0)>-1}function si(S,A,I){for(var D=-1,Y=S==null?0:S.length;++D<Y;)if(I(A,S[D]))return!0;return!1}function vt(S,A){for(var I=-1,D=S==null?0:S.length,Y=Array(D);++I<D;)Y[I]=A(S[I],I,S);return Y}function an(S,A){for(var I=-1,D=A.length,Y=S.length;++I<D;)S[Y+I]=A[I];return S}function ri(S,A,I,D){var Y=-1,rt=S==null?0:S.length;for(D&&rt&&(I=S[++Y]);++Y<rt;)I=A(I,S[Y],Y,S);return I}function wl(S,A,I,D){var Y=S==null?0:S.length;for(D&&Y&&(I=S[--Y]);Y--;)I=A(I,S[Y],Y,S);return I}function ii(S,A){for(var I=-1,D=S==null?0:S.length;++I<D;)if(A(S[I],I,S))return!0;return!1}var xl=ai("length");function ro(S,A,I){var D;return I(S,function(Y,rt,Tt){if(A(Y,rt,Tt))return D=rt,!1}),D}function Ns(S,A,I,D){for(var Y=S.length,rt=I+(D?1:-1);D?rt--:++rt<Y;)if(A(S[rt],rt,S))return rt;return-1}function jn(S,A,I){return A==A?function(D,Y,rt){for(var Tt=rt-1,je=D.length;++Tt<je;)if(D[Tt]===Y)return Tt;return-1}(S,A,I):Ns(S,io,I)}function Al(S,A,I,D){for(var Y=I-1,rt=S.length;++Y<rt;)if(D(S[Y],A))return Y;return-1}function io(S){return S!=S}function ao(S,A){var I=S==null?0:S.length;return I?ui(S,A)/I:O}function ai(S){return function(A){return A==null?a:A[S]}}function oi(S){return function(A){return S==null?a:S[A]}}function oo(S,A,I,D,Y){return Y(S,function(rt,Tt,je){I=D?(D=!1,rt):A(I,rt,Tt,je)}),I}function ui(S,A){for(var I,D=-1,Y=S.length;++D<Y;){var rt=A(S[D]);rt!==a&&(I=I===a?rt:I+rt)}return I}function ci(S,A){for(var I=-1,D=Array(S);++I<S;)D[I]=A(I);return D}function uo(S){return S&&S.slice(0,fo(S)+1).replace(Yr,"")}function ue(S){return function(A){return S(A)}}function li(S,A){return vt(A,function(I){return S[I]})}function hs(S,A){return S.has(A)}function co(S,A){for(var I=-1,D=S.length;++I<D&&jn(A,S[I],0)>-1;);return I}function lo(S,A){for(var I=S.length;I--&&jn(A,S[I],0)>-1;);return I}var Il=oi({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),El=oi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Tl(S){return"\\"+ml[S]}function zn(S){return fl.test(S)}function hi(S){var A=-1,I=Array(S.size);return S.forEach(function(D,Y){I[++A]=[Y,D]}),I}function ho(S,A){return function(I){return S(A(I))}}function on(S,A){for(var I=-1,D=S.length,Y=0,rt=[];++I<D;){var Tt=S[I];Tt!==A&&Tt!==i||(S[I]=i,rt[Y++]=I)}return rt}function Hs(S){var A=-1,I=Array(S.size);return S.forEach(function(D){I[++A]=D}),I}function Ml(S){var A=-1,I=Array(S.size);return S.forEach(function(D){I[++A]=[D,D]}),I}function Bn(S){return zn(S)?function(A){for(var I=ti.lastIndex=0;ti.test(A);)++I;return I}(S):xl(S)}function Me(S){return zn(S)?function(A){return A.match(ti)||[]}(S):function(A){return A.split("")}(S)}function fo(S){for(var A=S.length;A--&&Bc.test(S.charAt(A)););return A}var Rl=oi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Wn=function S(A){var I,D=(A=A==null?Nt:Wn.defaults(Nt.Object(),A,Wn.pick(Nt,pl))).Array,Y=A.Date,rt=A.Error,Tt=A.Function,je=A.Math,pt=A.Object,di=A.RegExp,Fl=A.String,be=A.TypeError,Us=D.prototype,ql=Tt.prototype,Gn=pt.prototype,js=A["__core-js_shared__"],zs=ql.toString,dt=Gn.hasOwnProperty,Pl=0,go=(I=/[^.]+$/.exec(js&&js.keys&&js.keys.IE_PROTO||""))?"Symbol(src)_1."+I:"",Bs=Gn.toString,Dl=zs.call(pt),Ol=Nt._,kl=di("^"+zs.call(dt).replace(Jr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ws=Ya?A.Buffer:a,un=A.Symbol,Gs=A.Uint8Array,po=Ws?Ws.allocUnsafe:a,$s=ho(pt.getPrototypeOf,pt),_o=pt.create,mo=Gn.propertyIsEnumerable,Vs=Us.splice,yo=un?un.isConcatSpreadable:a,ds=un?un.iterator:a,xn=un?un.toStringTag:a,Zs=function(){try{var t=Mn(pt,"defineProperty");return t({},"",{}),t}catch{}}(),Ll=A.clearTimeout!==Nt.clearTimeout&&A.clearTimeout,Nl=Y&&Y.now!==Nt.Date.now&&Y.now,Hl=A.setTimeout!==Nt.setTimeout&&A.setTimeout,Js=je.ceil,Ys=je.floor,fi=pt.getOwnPropertySymbols,Ul=Ws?Ws.isBuffer:a,vo=A.isFinite,jl=Us.join,zl=ho(pt.keys,pt),Mt=je.max,jt=je.min,Bl=Y.now,Wl=A.parseInt,bo=je.random,Gl=Us.reverse,gi=Mn(A,"DataView"),fs=Mn(A,"Map"),pi=Mn(A,"Promise"),$n=Mn(A,"Set"),gs=Mn(A,"WeakMap"),ps=Mn(pt,"create"),Ks=gs&&new gs,Vn={},$l=Rn(gi),Vl=Rn(fs),Zl=Rn(pi),Jl=Rn($n),Yl=Rn(gs),Xs=un?un.prototype:a,_s=Xs?Xs.valueOf:a,So=Xs?Xs.toString:a;function h(t){if(Ct(t)&&!Q(t)&&!(t instanceof nt)){if(t instanceof Se)return t;if(dt.call(t,"__wrapped__"))return Cu(t)}return new Se(t)}var Zn=function(){function t(){}return function(n){if(!St(n))return{};if(_o)return _o(n);t.prototype=n;var r=new t;return t.prototype=a,r}}();function Qs(){}function Se(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=a}function nt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ut,this.__views__=[]}function An(t){var n=-1,r=t==null?0:t.length;for(this.clear();++n<r;){var o=t[n];this.set(o[0],o[1])}}function Ve(t){var n=-1,r=t==null?0:t.length;for(this.clear();++n<r;){var o=t[n];this.set(o[0],o[1])}}function Ze(t){var n=-1,r=t==null?0:t.length;for(this.clear();++n<r;){var o=t[n];this.set(o[0],o[1])}}function In(t){var n=-1,r=t==null?0:t.length;for(this.__data__=new Ze;++n<r;)this.add(t[n])}function Re(t){var n=this.__data__=new Ve(t);this.size=n.size}function Co(t,n){var r=Q(t),o=!r&&Fn(t),c=!r&&!o&&fn(t),f=!r&&!o&&!c&&Xn(t),_=r||o||c||f,m=_?ci(t.length,Fl):[],b=m.length;for(var w in t)!n&&!dt.call(t,w)||_&&(w=="length"||c&&(w=="offset"||w=="parent")||f&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||Xe(w,b))||m.push(w);return m}function wo(t){var n=t.length;return n?t[Ii(0,n-1)]:a}function Kl(t,n){return fr(te(t),En(n,0,t.length))}function Xl(t){return fr(te(t))}function _i(t,n,r){(r!==a&&!Fe(t[n],r)||r===a&&!(n in t))&&Je(t,n,r)}function ms(t,n,r){var o=t[n];dt.call(t,n)&&Fe(o,r)&&(r!==a||n in t)||Je(t,n,r)}function tr(t,n){for(var r=t.length;r--;)if(Fe(t[r][0],n))return r;return-1}function Ql(t,n,r,o){return cn(t,function(c,f,_){n(o,c,r(c),_)}),o}function xo(t,n){return t&&Be(n,Pt(n),t)}function Je(t,n,r){n=="__proto__"&&Zs?Zs(t,n,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[n]=r}function mi(t,n){for(var r=-1,o=n.length,c=D(o),f=t==null;++r<o;)c[r]=f?a:Ki(t,n[r]);return c}function En(t,n,r){return t==t&&(r!==a&&(t=t<=r?t:r),n!==a&&(t=t>=n?t:n)),t}function Ce(t,n,r,o,c,f){var _,m=1&n,b=2&n,w=4&n;if(r&&(_=c?r(t,o,c,f):r(t)),_!==a)return _;if(!St(t))return t;var C=Q(t);if(C){if(_=function(x){var F=x.length,G=new x.constructor(F);return F&&typeof x[0]=="string"&&dt.call(x,"index")&&(G.index=x.index,G.input=x.input),G}(t),!m)return te(t,_)}else{var M=zt(t),N=M==ie||M==ae;if(fn(t))return Zo(t,m);if(M==qt||M==V||N&&!c){if(_=b||N?{}:fu(t),!m)return b?function(x,F){return Be(x,hu(x),F)}(t,function(x,F){return x&&Be(F,ne(F),x)}(_,t)):function(x,F){return Be(x,Ui(x),F)}(t,xo(_,t))}else{if(!ft[M])return c?t:{};_=function(x,F,G){var P,K=x.constructor;switch(F){case ls:return Pi(x);case st:case H:return new K(+x);case Hn:return function(Z,ct){var j=ct?Pi(Z.buffer):Z.buffer;return new Z.constructor(j,Z.byteOffset,Z.byteLength)}(x,G);case Ur:case jr:case zr:case Br:case Wr:case Gr:case $r:case Vr:case Zr:return Jo(x,G);case bt:return new K;case Ee:case us:return new K(x);case Ue:return function(Z){var ct=new Z.constructor(Z.source,Ra.exec(Z));return ct.lastIndex=Z.lastIndex,ct}(x);case Te:return new K;case Ps:return P=x,_s?pt(_s.call(P)):{}}}(t,M,m)}}f||(f=new Re);var U=f.get(t);if(U)return U;f.set(t,_),Uu(t)?t.forEach(function(x){_.add(Ce(x,n,r,x,t,f))}):Nu(t)&&t.forEach(function(x,F){_.set(F,Ce(x,n,r,F,t,f))});var z=C?a:(w?b?Li:ki:b?ne:Pt)(t);return ve(z||t,function(x,F){z&&(x=t[F=x]),ms(_,F,Ce(x,n,r,F,t,f))}),_}function Ao(t,n,r){var o=r.length;if(t==null)return!o;for(t=pt(t);o--;){var c=r[o],f=n[c],_=t[c];if(_===a&&!(c in t)||!f(_))return!1}return!0}function Io(t,n,r){if(typeof t!="function")throw new be(e);return xs(function(){t.apply(a,r)},n)}function ys(t,n,r,o){var c=-1,f=Ls,_=!0,m=t.length,b=[],w=n.length;if(!m)return b;r&&(n=vt(n,ue(r))),o?(f=si,_=!1):n.length>=200&&(f=hs,_=!1,n=new In(n));t:for(;++c<m;){var C=t[c],M=r==null?C:r(C);if(C=o||C!==0?C:0,_&&M==M){for(var N=w;N--;)if(n[N]===M)continue t;b.push(C)}else f(n,M,o)||b.push(C)}return b}h.templateSettings={escape:Lc,evaluate:Nc,interpolate:Ma,variable:"",imports:{_:h}},h.prototype=Qs.prototype,h.prototype.constructor=h,Se.prototype=Zn(Qs.prototype),Se.prototype.constructor=Se,nt.prototype=Zn(Qs.prototype),nt.prototype.constructor=nt,An.prototype.clear=function(){this.__data__=ps?ps(null):{},this.size=0},An.prototype.delete=function(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},An.prototype.get=function(t){var n=this.__data__;if(ps){var r=n[t];return r===s?a:r}return dt.call(n,t)?n[t]:a},An.prototype.has=function(t){var n=this.__data__;return ps?n[t]!==a:dt.call(n,t)},An.prototype.set=function(t,n){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ps&&n===a?s:n,this},Ve.prototype.clear=function(){this.__data__=[],this.size=0},Ve.prototype.delete=function(t){var n=this.__data__,r=tr(n,t);return!(r<0||(r==n.length-1?n.pop():Vs.call(n,r,1),--this.size,0))},Ve.prototype.get=function(t){var n=this.__data__,r=tr(n,t);return r<0?a:n[r][1]},Ve.prototype.has=function(t){return tr(this.__data__,t)>-1},Ve.prototype.set=function(t,n){var r=this.__data__,o=tr(r,t);return o<0?(++this.size,r.push([t,n])):r[o][1]=n,this},Ze.prototype.clear=function(){this.size=0,this.__data__={hash:new An,map:new(fs||Ve),string:new An}},Ze.prototype.delete=function(t){var n=dr(this,t).delete(t);return this.size-=n?1:0,n},Ze.prototype.get=function(t){return dr(this,t).get(t)},Ze.prototype.has=function(t){return dr(this,t).has(t)},Ze.prototype.set=function(t,n){var r=dr(this,t),o=r.size;return r.set(t,n),this.size+=r.size==o?0:1,this},In.prototype.add=In.prototype.push=function(t){return this.__data__.set(t,s),this},In.prototype.has=function(t){return this.__data__.has(t)},Re.prototype.clear=function(){this.__data__=new Ve,this.size=0},Re.prototype.delete=function(t){var n=this.__data__,r=n.delete(t);return this.size=n.size,r},Re.prototype.get=function(t){return this.__data__.get(t)},Re.prototype.has=function(t){return this.__data__.has(t)},Re.prototype.set=function(t,n){var r=this.__data__;if(r instanceof Ve){var o=r.__data__;if(!fs||o.length<199)return o.push([t,n]),this.size=++r.size,this;r=this.__data__=new Ze(o)}return r.set(t,n),this.size=r.size,this};var cn=Qo(ze),Eo=Qo(vi,!0);function th(t,n){var r=!0;return cn(t,function(o,c,f){return r=!!n(o,c,f)}),r}function er(t,n,r){for(var o=-1,c=t.length;++o<c;){var f=t[o],_=n(f);if(_!=null&&(m===a?_==_&&!le(_):r(_,m)))var m=_,b=f}return b}function To(t,n){var r=[];return cn(t,function(o,c,f){n(o,c,f)&&r.push(o)}),r}function Ht(t,n,r,o,c){var f=-1,_=t.length;for(r||(r=dh),c||(c=[]);++f<_;){var m=t[f];n>0&&r(m)?n>1?Ht(m,n-1,r,o,c):an(c,m):o||(c[c.length]=m)}return c}var yi=tu(),Mo=tu(!0);function ze(t,n){return t&&yi(t,n,Pt)}function vi(t,n){return t&&Mo(t,n,Pt)}function nr(t,n){return rn(n,function(r){return Qe(t[r])})}function Tn(t,n){for(var r=0,o=(n=hn(n,t)).length;t!=null&&r<o;)t=t[We(n[r++])];return r&&r==o?t:a}function Ro(t,n,r){var o=n(t);return Q(t)?o:an(o,r(t))}function Vt(t){return t==null?t===a?"[object Undefined]":"[object Null]":xn&&xn in pt(t)?function(n){var r=dt.call(n,xn),o=n[xn];try{n[xn]=a;var c=!0}catch{}var f=Bs.call(n);return c&&(r?n[xn]=o:delete n[xn]),f}(t):function(n){return Bs.call(n)}(t)}function bi(t,n){return t>n}function eh(t,n){return t!=null&&dt.call(t,n)}function nh(t,n){return t!=null&&n in pt(t)}function Si(t,n,r){for(var o=r?si:Ls,c=t[0].length,f=t.length,_=f,m=D(f),b=1/0,w=[];_--;){var C=t[_];_&&n&&(C=vt(C,ue(n))),b=jt(C.length,b),m[_]=!r&&(n||c>=120&&C.length>=120)?new In(_&&C):a}C=t[0];var M=-1,N=m[0];t:for(;++M<c&&w.length<b;){var U=C[M],z=n?n(U):U;if(U=r||U!==0?U:0,!(N?hs(N,z):o(w,z,r))){for(_=f;--_;){var x=m[_];if(!(x?hs(x,z):o(t[_],z,r)))continue t}N&&N.push(z),w.push(U)}}return w}function vs(t,n,r){var o=(t=mu(t,n=hn(n,t)))==null?t:t[We(xe(n))];return o==null?a:oe(o,t,r)}function Fo(t){return Ct(t)&&Vt(t)==V}function bs(t,n,r,o,c){return t===n||(t==null||n==null||!Ct(t)&&!Ct(n)?t!=t&&n!=n:function(f,_,m,b,w,C){var M=Q(f),N=Q(_),U=M?it:zt(f),z=N?it:zt(_),x=(U=U==V?qt:U)==qt,F=(z=z==V?qt:z)==qt,G=U==z;if(G&&fn(f)){if(!fn(_))return!1;M=!0,x=!1}if(G&&!x)return C||(C=new Re),M||Xn(f)?lu(f,_,m,b,w,C):function(j,$,Rt,It,Jt,_t,Bt){switch(Rt){case Hn:if(j.byteLength!=$.byteLength||j.byteOffset!=$.byteOffset)return!1;j=j.buffer,$=$.buffer;case ls:return!(j.byteLength!=$.byteLength||!_t(new Gs(j),new Gs($)));case st:case H:case Ee:return Fe(+j,+$);case ht:return j.name==$.name&&j.message==$.message;case Ue:case us:return j==$+"";case bt:var Ge=hi;case Te:var gn=1&It;if(Ge||(Ge=Hs),j.size!=$.size&&!gn)return!1;var Cr=Bt.get(j);if(Cr)return Cr==$;It|=2,Bt.set(j,$);var oa=lu(Ge(j),Ge($),It,Jt,_t,Bt);return Bt.delete(j),oa;case Ps:if(_s)return _s.call(j)==_s.call($)}return!1}(f,_,U,m,b,w,C);if(!(1&m)){var P=x&&dt.call(f,"__wrapped__"),K=F&&dt.call(_,"__wrapped__");if(P||K){var Z=P?f.value():f,ct=K?_.value():_;return C||(C=new Re),w(Z,ct,m,b,C)}}return!!G&&(C||(C=new Re),function(j,$,Rt,It,Jt,_t){var Bt=1&Rt,Ge=ki(j),gn=Ge.length,Cr=ki($),oa=Cr.length;if(gn!=oa&&!Bt)return!1;for(var wr=gn;wr--;){var qn=Ge[wr];if(!(Bt?qn in $:dt.call($,qn)))return!1}var tc=_t.get(j),ec=_t.get($);if(tc&&ec)return tc==$&&ec==j;var xr=!0;_t.set(j,$),_t.set($,j);for(var ua=Bt;++wr<gn;){var Ar=j[qn=Ge[wr]],Ir=$[qn];if(It)var nc=Bt?It(Ir,Ar,qn,$,j,_t):It(Ar,Ir,qn,j,$,_t);if(!(nc===a?Ar===Ir||Jt(Ar,Ir,Rt,It,_t):nc)){xr=!1;break}ua||(ua=qn=="constructor")}if(xr&&!ua){var Er=j.constructor,Tr=$.constructor;Er==Tr||!("constructor"in j)||!("constructor"in $)||typeof Er=="function"&&Er instanceof Er&&typeof Tr=="function"&&Tr instanceof Tr||(xr=!1)}return _t.delete(j),_t.delete($),xr}(f,_,m,b,w,C))}(t,n,r,o,bs,c))}function Ci(t,n,r,o){var c=r.length,f=c,_=!o;if(t==null)return!f;for(t=pt(t);c--;){var m=r[c];if(_&&m[2]?m[1]!==t[m[0]]:!(m[0]in t))return!1}for(;++c<f;){var b=(m=r[c])[0],w=t[b],C=m[1];if(_&&m[2]){if(w===a&&!(b in t))return!1}else{var M=new Re;if(o)var N=o(w,C,b,t,n,M);if(!(N===a?bs(C,w,3,o,M):N))return!1}}return!0}function qo(t){return!(!St(t)||(n=t,go&&go in n))&&(Qe(t)?kl:Qc).test(Rn(t));var n}function Po(t){return typeof t=="function"?t:t==null?se:typeof t=="object"?Q(t)?ko(t[0],t[1]):Oo(t):Qu(t)}function wi(t){if(!ws(t))return zl(t);var n=[];for(var r in pt(t))dt.call(t,r)&&r!="constructor"&&n.push(r);return n}function sh(t){if(!St(t))return function(c){var f=[];if(c!=null)for(var _ in pt(c))f.push(_);return f}(t);var n=ws(t),r=[];for(var o in t)(o!="constructor"||!n&&dt.call(t,o))&&r.push(o);return r}function xi(t,n){return t<n}function Do(t,n){var r=-1,o=ee(t)?D(t.length):[];return cn(t,function(c,f,_){o[++r]=n(c,f,_)}),o}function Oo(t){var n=Hi(t);return n.length==1&&n[0][2]?pu(n[0][0],n[0][1]):function(r){return r===t||Ci(r,t,n)}}function ko(t,n){return ji(t)&&gu(n)?pu(We(t),n):function(r){var o=Ki(r,t);return o===a&&o===n?Xi(r,t):bs(n,o,3)}}function sr(t,n,r,o,c){t!==n&&yi(n,function(f,_){if(c||(c=new Re),St(f))(function(b,w,C,M,N,U,z){var x=Bi(b,C),F=Bi(w,C),G=z.get(F);if(G)_i(b,C,G);else{var P=U?U(x,F,C+"",b,w,z):a,K=P===a;if(K){var Z=Q(F),ct=!Z&&fn(F),j=!Z&&!ct&&Xn(F);P=F,Z||ct||j?Q(x)?P=x:At(x)?P=te(x):ct?(K=!1,P=Zo(F,!0)):j?(K=!1,P=Jo(F,!0)):P=[]:As(F)||Fn(F)?(P=x,Fn(x)?P=Bu(x):St(x)&&!Qe(x)||(P=fu(F))):K=!1}K&&(z.set(F,P),N(P,F,M,U,z),z.delete(F)),_i(b,C,P)}})(t,n,_,r,sr,o,c);else{var m=o?o(Bi(t,_),f,_+"",t,n,c):a;m===a&&(m=f),_i(t,_,m)}},ne)}function Lo(t,n){var r=t.length;if(r)return Xe(n+=n<0?r:0,r)?t[n]:a}function No(t,n,r){n=n.length?vt(n,function(f){return Q(f)?function(_){return Tn(_,f.length===1?f[0]:f)}:f}):[se];var o=-1;n=vt(n,ue(B()));var c=Do(t,function(f,_,m){var b=vt(n,function(w){return w(f)});return{criteria:b,index:++o,value:f}});return function(f,_){var m=f.length;for(f.sort(_);m--;)f[m]=f[m].value;return f}(c,function(f,_){return function(m,b,w){for(var C=-1,M=m.criteria,N=b.criteria,U=M.length,z=w.length;++C<U;){var x=Yo(M[C],N[C]);if(x)return C>=z?x:x*(w[C]=="desc"?-1:1)}return m.index-b.index}(f,_,r)})}function Ho(t,n,r){for(var o=-1,c=n.length,f={};++o<c;){var _=n[o],m=Tn(t,_);r(m,_)&&Ss(f,hn(_,t),m)}return f}function Ai(t,n,r,o){var c=o?Al:jn,f=-1,_=n.length,m=t;for(t===n&&(n=te(n)),r&&(m=vt(t,ue(r)));++f<_;)for(var b=0,w=n[f],C=r?r(w):w;(b=c(m,C,b,o))>-1;)m!==t&&Vs.call(m,b,1),Vs.call(t,b,1);return t}function Uo(t,n){for(var r=t?n.length:0,o=r-1;r--;){var c=n[r];if(r==o||c!==f){var f=c;Xe(c)?Vs.call(t,c,1):Mi(t,c)}}return t}function Ii(t,n){return t+Ys(bo()*(n-t+1))}function Ei(t,n){var r="";if(!t||n<1||n>R)return r;do n%2&&(r+=t),(n=Ys(n/2))&&(t+=t);while(n);return r}function et(t,n){return Wi(_u(t,n,se),t+"")}function rh(t){return wo(Qn(t))}function ih(t,n){var r=Qn(t);return fr(r,En(n,0,r.length))}function Ss(t,n,r,o){if(!St(t))return t;for(var c=-1,f=(n=hn(n,t)).length,_=f-1,m=t;m!=null&&++c<f;){var b=We(n[c]),w=r;if(b==="__proto__"||b==="constructor"||b==="prototype")return t;if(c!=_){var C=m[b];(w=o?o(C,b,m):a)===a&&(w=St(C)?C:Xe(n[c+1])?[]:{})}ms(m,b,w),m=m[b]}return t}var jo=Ks?function(t,n){return Ks.set(t,n),t}:se,ah=Zs?function(t,n){return Zs(t,"toString",{configurable:!0,enumerable:!1,value:ta(n),writable:!0})}:se;function oh(t){return fr(Qn(t))}function we(t,n,r){var o=-1,c=t.length;n<0&&(n=-n>c?0:c+n),(r=r>c?c:r)<0&&(r+=c),c=n>r?0:r-n>>>0,n>>>=0;for(var f=D(c);++o<c;)f[o]=t[o+n];return f}function uh(t,n){var r;return cn(t,function(o,c,f){return!(r=n(o,c,f))}),!!r}function rr(t,n,r){var o=0,c=t==null?o:t.length;if(typeof n=="number"&&n==n&&c<=2147483647){for(;o<c;){var f=o+c>>>1,_=t[f];_!==null&&!le(_)&&(r?_<=n:_<n)?o=f+1:c=f}return c}return Ti(t,n,se,r)}function Ti(t,n,r,o){var c=0,f=t==null?0:t.length;if(f===0)return 0;for(var _=(n=r(n))!=n,m=n===null,b=le(n),w=n===a;c<f;){var C=Ys((c+f)/2),M=r(t[C]),N=M!==a,U=M===null,z=M==M,x=le(M);if(_)var F=o||z;else F=w?z&&(o||N):m?z&&N&&(o||!U):b?z&&N&&!U&&(o||!x):!U&&!x&&(o?M<=n:M<n);F?c=C+1:f=C}return jt(f,4294967294)}function zo(t,n){for(var r=-1,o=t.length,c=0,f=[];++r<o;){var _=t[r],m=n?n(_):_;if(!r||!Fe(m,b)){var b=m;f[c++]=_===0?0:_}}return f}function Bo(t){return typeof t=="number"?t:le(t)?O:+t}function ce(t){if(typeof t=="string")return t;if(Q(t))return vt(t,ce)+"";if(le(t))return So?So.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function ln(t,n,r){var o=-1,c=Ls,f=t.length,_=!0,m=[],b=m;if(r)_=!1,c=si;else if(f>=200){var w=n?null:lh(t);if(w)return Hs(w);_=!1,c=hs,b=new In}else b=n?[]:m;t:for(;++o<f;){var C=t[o],M=n?n(C):C;if(C=r||C!==0?C:0,_&&M==M){for(var N=b.length;N--;)if(b[N]===M)continue t;n&&b.push(M),m.push(C)}else c(b,M,r)||(b!==m&&b.push(M),m.push(C))}return m}function Mi(t,n){return(t=mu(t,n=hn(n,t)))==null||delete t[We(xe(n))]}function Wo(t,n,r,o){return Ss(t,n,r(Tn(t,n)),o)}function ir(t,n,r,o){for(var c=t.length,f=o?c:-1;(o?f--:++f<c)&&n(t[f],f,t););return r?we(t,o?0:f,o?f+1:c):we(t,o?f+1:0,o?c:f)}function Go(t,n){var r=t;return r instanceof nt&&(r=r.value()),ri(n,function(o,c){return c.func.apply(c.thisArg,an([o],c.args))},r)}function Ri(t,n,r){var o=t.length;if(o<2)return o?ln(t[0]):[];for(var c=-1,f=D(o);++c<o;)for(var _=t[c],m=-1;++m<o;)m!=c&&(f[c]=ys(f[c]||_,t[m],n,r));return ln(Ht(f,1),n,r)}function $o(t,n,r){for(var o=-1,c=t.length,f=n.length,_={};++o<c;){var m=o<f?n[o]:a;r(_,t[o],m)}return _}function Fi(t){return At(t)?t:[]}function qi(t){return typeof t=="function"?t:se}function hn(t,n){return Q(t)?t:ji(t,n)?[t]:Su(lt(t))}var ch=et;function dn(t,n,r){var o=t.length;return r=r===a?o:r,!n&&r>=o?t:we(t,n,r)}var Vo=Ll||function(t){return Nt.clearTimeout(t)};function Zo(t,n){if(n)return t.slice();var r=t.length,o=po?po(r):new t.constructor(r);return t.copy(o),o}function Pi(t){var n=new t.constructor(t.byteLength);return new Gs(n).set(new Gs(t)),n}function Jo(t,n){var r=n?Pi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function Yo(t,n){if(t!==n){var r=t!==a,o=t===null,c=t==t,f=le(t),_=n!==a,m=n===null,b=n==n,w=le(n);if(!m&&!w&&!f&&t>n||f&&_&&b&&!m&&!w||o&&_&&b||!r&&b||!c)return 1;if(!o&&!f&&!w&&t<n||w&&r&&c&&!o&&!f||m&&r&&c||!_&&c||!b)return-1}return 0}function Ko(t,n,r,o){for(var c=-1,f=t.length,_=r.length,m=-1,b=n.length,w=Mt(f-_,0),C=D(b+w),M=!o;++m<b;)C[m]=n[m];for(;++c<_;)(M||c<f)&&(C[r[c]]=t[c]);for(;w--;)C[m++]=t[c++];return C}function Xo(t,n,r,o){for(var c=-1,f=t.length,_=-1,m=r.length,b=-1,w=n.length,C=Mt(f-m,0),M=D(C+w),N=!o;++c<C;)M[c]=t[c];for(var U=c;++b<w;)M[U+b]=n[b];for(;++_<m;)(N||c<f)&&(M[U+r[_]]=t[c++]);return M}function te(t,n){var r=-1,o=t.length;for(n||(n=D(o));++r<o;)n[r]=t[r];return n}function Be(t,n,r,o){var c=!r;r||(r={});for(var f=-1,_=n.length;++f<_;){var m=n[f],b=o?o(r[m],t[m],m,r,t):a;b===a&&(b=t[m]),c?Je(r,m,b):ms(r,m,b)}return r}function ar(t,n){return function(r,o){var c=Q(r)?Sl:Ql,f=n?n():{};return c(r,t,B(o,2),f)}}function Jn(t){return et(function(n,r){var o=-1,c=r.length,f=c>1?r[c-1]:a,_=c>2?r[2]:a;for(f=t.length>3&&typeof f=="function"?(c--,f):a,_&&Zt(r[0],r[1],_)&&(f=c<3?a:f,c=1),n=pt(n);++o<c;){var m=r[o];m&&t(n,m,o,f)}return n})}function Qo(t,n){return function(r,o){if(r==null)return r;if(!ee(r))return t(r,o);for(var c=r.length,f=n?c:-1,_=pt(r);(n?f--:++f<c)&&o(_[f],f,_)!==!1;);return r}}function tu(t){return function(n,r,o){for(var c=-1,f=pt(n),_=o(n),m=_.length;m--;){var b=_[t?m:++c];if(r(f[b],b,f)===!1)break}return n}}function eu(t){return function(n){var r=zn(n=lt(n))?Me(n):a,o=r?r[0]:n.charAt(0),c=r?dn(r,1).join(""):n.slice(1);return o[t]()+c}}function Yn(t){return function(n){return ri(Ku(Yu(n).replace(ll,"")),t,"")}}function Cs(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var r=Zn(t.prototype),o=t.apply(r,n);return St(o)?o:r}}function nu(t){return function(n,r,o){var c=pt(n);if(!ee(n)){var f=B(r,3);n=Pt(n),r=function(m){return f(c[m],m,c)}}var _=t(n,r,o);return _>-1?c[f?n[_]:_]:a}}function su(t){return Ke(function(n){var r=n.length,o=r,c=Se.prototype.thru;for(t&&n.reverse();o--;){var f=n[o];if(typeof f!="function")throw new be(e);if(c&&!_&&hr(f)=="wrapper")var _=new Se([],!0)}for(o=_?o:r;++o<r;){var m=hr(f=n[o]),b=m=="wrapper"?Ni(f):a;_=b&&zi(b[0])&&b[1]==424&&!b[4].length&&b[9]==1?_[hr(b[0])].apply(_,b[3]):f.length==1&&zi(f)?_[m]():_.thru(f)}return function(){var w=arguments,C=w[0];if(_&&w.length==1&&Q(C))return _.plant(C).value();for(var M=0,N=r?n[M].apply(this,w):C;++M<r;)N=n[M].call(this,N);return N}})}function or(t,n,r,o,c,f,_,m,b,w){var C=n&y,M=1&n,N=2&n,U=24&n,z=512&n,x=N?a:Cs(t);return function F(){for(var G=arguments.length,P=D(G),K=G;K--;)P[K]=arguments[K];if(U)var Z=Kn(F),ct=function(It,Jt){for(var _t=It.length,Bt=0;_t--;)It[_t]===Jt&&++Bt;return Bt}(P,Z);if(o&&(P=Ko(P,o,c,U)),f&&(P=Xo(P,f,_,U)),G-=ct,U&&G<w){var j=on(P,Z);return au(t,n,or,F.placeholder,r,P,j,m,b,w-G)}var $=M?r:this,Rt=N?$[t]:t;return G=P.length,m?P=function(It,Jt){for(var _t=It.length,Bt=jt(Jt.length,_t),Ge=te(It);Bt--;){var gn=Jt[Bt];It[Bt]=Xe(gn,_t)?Ge[gn]:a}return It}(P,m):z&&G>1&&P.reverse(),C&&b<G&&(P.length=b),this&&this!==Nt&&this instanceof F&&(Rt=x||Cs(Rt)),Rt.apply($,P)}}function ru(t,n){return function(r,o){return function(c,f,_,m){return ze(c,function(b,w,C){f(m,_(b),w,C)}),m}(r,t,n(o),{})}}function ur(t,n){return function(r,o){var c;if(r===a&&o===a)return n;if(r!==a&&(c=r),o!==a){if(c===a)return o;typeof r=="string"||typeof o=="string"?(r=ce(r),o=ce(o)):(r=Bo(r),o=Bo(o)),c=t(r,o)}return c}}function Di(t){return Ke(function(n){return n=vt(n,ue(B())),et(function(r){var o=this;return t(n,function(c){return oe(c,o,r)})})})}function cr(t,n){var r=(n=n===a?" ":ce(n)).length;if(r<2)return r?Ei(n,t):n;var o=Ei(n,Js(t/Bn(n)));return zn(n)?dn(Me(o),0,t).join(""):o.slice(0,t)}function iu(t){return function(n,r,o){return o&&typeof o!="number"&&Zt(n,r,o)&&(r=o=a),n=tn(n),r===a?(r=n,n=0):r=tn(r),function(c,f,_,m){for(var b=-1,w=Mt(Js((f-c)/(_||1)),0),C=D(w);w--;)C[m?w:++b]=c,c+=_;return C}(n,r,o=o===a?n<r?1:-1:tn(o),t)}}function lr(t){return function(n,r){return typeof n=="string"&&typeof r=="string"||(n=Ae(n),r=Ae(r)),t(n,r)}}function au(t,n,r,o,c,f,_,m,b,w){var C=8&n;n|=C?l:p,4&(n&=~(C?p:l))||(n&=-4);var M=[t,n,c,C?f:a,C?_:a,C?a:f,C?a:_,m,b,w],N=r.apply(a,M);return zi(t)&&yu(N,M),N.placeholder=o,vu(N,t,n)}function Oi(t){var n=je[t];return function(r,o){if(r=Ae(r),(o=o==null?0:jt(tt(o),292))&&vo(r)){var c=(lt(r)+"e").split("e");return+((c=(lt(n(c[0]+"e"+(+c[1]+o)))+"e").split("e"))[0]+"e"+(+c[1]-o))}return n(r)}}var lh=$n&&1/Hs(new $n([,-0]))[1]==E?function(t){return new $n(t)}:sa;function ou(t){return function(n){var r=zt(n);return r==bt?hi(n):r==Te?Ml(n):function(o,c){return vt(c,function(f){return[f,o[f]]})}(n,t(n))}}function Ye(t,n,r,o,c,f,_,m){var b=2&n;if(!b&&typeof t!="function")throw new be(e);var w=o?o.length:0;if(w||(n&=-97,o=c=a),_=_===a?_:Mt(tt(_),0),m=m===a?m:tt(m),w-=c?c.length:0,n&p){var C=o,M=c;o=c=a}var N=b?a:Ni(t),U=[t,n,r,o,c,C,M,f,_,m];if(N&&function(x,F){var G=x[1],P=F[1],K=G|P,Z=K<131,ct=P==y&&G==8||P==y&&G==v&&x[7].length<=F[8]||P==384&&F[7].length<=F[8]&&G==8;if(!Z&&!ct)return x;1&P&&(x[2]=F[2],K|=1&G?0:4);var j=F[3];if(j){var $=x[3];x[3]=$?Ko($,j,F[4]):j,x[4]=$?on(x[3],i):F[4]}(j=F[5])&&($=x[5],x[5]=$?Xo($,j,F[6]):j,x[6]=$?on(x[5],i):F[6]),(j=F[7])&&(x[7]=j),P&y&&(x[8]=x[8]==null?F[8]:jt(x[8],F[8])),x[9]==null&&(x[9]=F[9]),x[0]=F[0],x[1]=K}(U,N),t=U[0],n=U[1],r=U[2],o=U[3],c=U[4],!(m=U[9]=U[9]===a?b?0:t.length:Mt(U[9]-w,0))&&24&n&&(n&=-25),n&&n!=1)z=n==8||n==u?function(x,F,G){var P=Cs(x);return function K(){for(var Z=arguments.length,ct=D(Z),j=Z,$=Kn(K);j--;)ct[j]=arguments[j];var Rt=Z<3&&ct[0]!==$&&ct[Z-1]!==$?[]:on(ct,$);return(Z-=Rt.length)<G?au(x,F,or,K.placeholder,a,ct,Rt,a,a,G-Z):oe(this&&this!==Nt&&this instanceof K?P:x,this,ct)}}(t,n,m):n!=l&&n!=33||c.length?or.apply(a,U):function(x,F,G,P){var K=1&F,Z=Cs(x);return function ct(){for(var j=-1,$=arguments.length,Rt=-1,It=P.length,Jt=D(It+$),_t=this&&this!==Nt&&this instanceof ct?Z:x;++Rt<It;)Jt[Rt]=P[Rt];for(;$--;)Jt[Rt++]=arguments[++j];return oe(_t,K?G:this,Jt)}}(t,n,r,o);else var z=function(x,F,G){var P=1&F,K=Cs(x);return function Z(){return(this&&this!==Nt&&this instanceof Z?K:x).apply(P?G:this,arguments)}}(t,n,r);return vu((N?jo:yu)(z,U),t,n)}function uu(t,n,r,o){return t===a||Fe(t,Gn[r])&&!dt.call(o,r)?n:t}function cu(t,n,r,o,c,f){return St(t)&&St(n)&&(f.set(n,t),sr(t,n,a,cu,f),f.delete(n)),t}function hh(t){return As(t)?a:t}function lu(t,n,r,o,c,f){var _=1&r,m=t.length,b=n.length;if(m!=b&&!(_&&b>m))return!1;var w=f.get(t),C=f.get(n);if(w&&C)return w==n&&C==t;var M=-1,N=!0,U=2&r?new In:a;for(f.set(t,n),f.set(n,t);++M<m;){var z=t[M],x=n[M];if(o)var F=_?o(x,z,M,n,t,f):o(z,x,M,t,n,f);if(F!==a){if(F)continue;N=!1;break}if(U){if(!ii(n,function(G,P){if(!hs(U,P)&&(z===G||c(z,G,r,o,f)))return U.push(P)})){N=!1;break}}else if(z!==x&&!c(z,x,r,o,f)){N=!1;break}}return f.delete(t),f.delete(n),N}function Ke(t){return Wi(_u(t,a,Au),t+"")}function ki(t){return Ro(t,Pt,Ui)}function Li(t){return Ro(t,ne,hu)}var Ni=Ks?function(t){return Ks.get(t)}:sa;function hr(t){for(var n=t.name+"",r=Vn[n],o=dt.call(Vn,n)?r.length:0;o--;){var c=r[o],f=c.func;if(f==null||f==t)return c.name}return n}function Kn(t){return(dt.call(h,"placeholder")?h:t).placeholder}function B(){var t=h.iteratee||ea;return t=t===ea?Po:t,arguments.length?t(arguments[0],arguments[1]):t}function dr(t,n){var r,o,c=t.__data__;return((o=typeof(r=n))=="string"||o=="number"||o=="symbol"||o=="boolean"?r!=="__proto__":r===null)?c[typeof n=="string"?"string":"hash"]:c.map}function Hi(t){for(var n=Pt(t),r=n.length;r--;){var o=n[r],c=t[o];n[r]=[o,c,gu(c)]}return n}function Mn(t,n){var r=function(o,c){return o==null?a:o[c]}(t,n);return qo(r)?r:a}var Ui=fi?function(t){return t==null?[]:(t=pt(t),rn(fi(t),function(n){return mo.call(t,n)}))}:ra,hu=fi?function(t){for(var n=[];t;)an(n,Ui(t)),t=$s(t);return n}:ra,zt=Vt;function du(t,n,r){for(var o=-1,c=(n=hn(n,t)).length,f=!1;++o<c;){var _=We(n[o]);if(!(f=t!=null&&r(t,_)))break;t=t[_]}return f||++o!=c?f:!!(c=t==null?0:t.length)&&vr(c)&&Xe(_,c)&&(Q(t)||Fn(t))}function fu(t){return typeof t.constructor!="function"||ws(t)?{}:Zn($s(t))}function dh(t){return Q(t)||Fn(t)||!!(yo&&t&&t[yo])}function Xe(t,n){var r=typeof t;return!!(n=n??R)&&(r=="number"||r!="symbol"&&el.test(t))&&t>-1&&t%1==0&&t<n}function Zt(t,n,r){if(!St(r))return!1;var o=typeof n;return!!(o=="number"?ee(r)&&Xe(n,r.length):o=="string"&&n in r)&&Fe(r[n],t)}function ji(t,n){if(Q(t))return!1;var r=typeof t;return!(r!="number"&&r!="symbol"&&r!="boolean"&&t!=null&&!le(t))||Uc.test(t)||!Hc.test(t)||n!=null&&t in pt(n)}function zi(t){var n=hr(t),r=h[n];if(typeof r!="function"||!(n in nt.prototype))return!1;if(t===r)return!0;var o=Ni(r);return!!o&&t===o[0]}(gi&&zt(new gi(new ArrayBuffer(1)))!=Hn||fs&&zt(new fs)!=bt||pi&&zt(pi.resolve())!=$e||$n&&zt(new $n)!=Te||gs&&zt(new gs)!=cs)&&(zt=function(t){var n=Vt(t),r=n==qt?t.constructor:a,o=r?Rn(r):"";if(o)switch(o){case $l:return Hn;case Vl:return bt;case Zl:return $e;case Jl:return Te;case Yl:return cs}return n});var fh=js?Qe:ia;function ws(t){var n=t&&t.constructor;return t===(typeof n=="function"&&n.prototype||Gn)}function gu(t){return t==t&&!St(t)}function pu(t,n){return function(r){return r!=null&&r[t]===n&&(n!==a||t in pt(r))}}function _u(t,n,r){return n=Mt(n===a?t.length-1:n,0),function(){for(var o=arguments,c=-1,f=Mt(o.length-n,0),_=D(f);++c<f;)_[c]=o[n+c];c=-1;for(var m=D(n+1);++c<n;)m[c]=o[c];return m[n]=r(_),oe(t,this,m)}}function mu(t,n){return n.length<2?t:Tn(t,we(n,0,-1))}function Bi(t,n){if((n!=="constructor"||typeof t[n]!="function")&&n!="__proto__")return t[n]}var yu=bu(jo),xs=Hl||function(t,n){return Nt.setTimeout(t,n)},Wi=bu(ah);function vu(t,n,r){var o=n+"";return Wi(t,function(c,f){var _=f.length;if(!_)return c;var m=_-1;return f[m]=(_>1?"& ":"")+f[m],f=f.join(_>2?", ":" "),c.replace(Wc,`{
/* [wrapped with `+f+`] */
`)}(o,function(c,f){return ve(J,function(_){var m="_."+_[0];f&_[1]&&!Ls(c,m)&&c.push(m)}),c.sort()}(function(c){var f=c.match(Gc);return f?f[1].split($c):[]}(o),r)))}function bu(t){var n=0,r=0;return function(){var o=Bl(),c=16-(o-r);if(r=o,c>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(a,arguments)}}function fr(t,n){var r=-1,o=t.length,c=o-1;for(n=n===a?o:n;++r<n;){var f=Ii(r,c),_=t[f];t[f]=t[r],t[r]=_}return t.length=n,t}var Su=function(t){var n=mr(t,function(o){return r.size===500&&r.clear(),o}),r=n.cache;return n}(function(t){var n=[];return t.charCodeAt(0)===46&&n.push(""),t.replace(jc,function(r,o,c,f){n.push(c?f.replace(Jc,"$1"):o||r)}),n});function We(t){if(typeof t=="string"||le(t))return t;var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function Rn(t){if(t!=null){try{return zs.call(t)}catch{}try{return t+""}catch{}}return""}function Cu(t){if(t instanceof nt)return t.clone();var n=new Se(t.__wrapped__,t.__chain__);return n.__actions__=te(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}var gh=et(function(t,n){return At(t)?ys(t,Ht(n,1,At,!0)):[]}),ph=et(function(t,n){var r=xe(n);return At(r)&&(r=a),At(t)?ys(t,Ht(n,1,At,!0),B(r,2)):[]}),_h=et(function(t,n){var r=xe(n);return At(r)&&(r=a),At(t)?ys(t,Ht(n,1,At,!0),a,r):[]});function wu(t,n,r){var o=t==null?0:t.length;if(!o)return-1;var c=r==null?0:tt(r);return c<0&&(c=Mt(o+c,0)),Ns(t,B(n,3),c)}function xu(t,n,r){var o=t==null?0:t.length;if(!o)return-1;var c=o-1;return r!==a&&(c=tt(r),c=r<0?Mt(o+c,0):jt(c,o-1)),Ns(t,B(n,3),c,!0)}function Au(t){return t!=null&&t.length?Ht(t,1):[]}function Iu(t){return t&&t.length?t[0]:a}var mh=et(function(t){var n=vt(t,Fi);return n.length&&n[0]===t[0]?Si(n):[]}),yh=et(function(t){var n=xe(t),r=vt(t,Fi);return n===xe(r)?n=a:r.pop(),r.length&&r[0]===t[0]?Si(r,B(n,2)):[]}),vh=et(function(t){var n=xe(t),r=vt(t,Fi);return(n=typeof n=="function"?n:a)&&r.pop(),r.length&&r[0]===t[0]?Si(r,a,n):[]});function xe(t){var n=t==null?0:t.length;return n?t[n-1]:a}var bh=et(Eu);function Eu(t,n){return t&&t.length&&n&&n.length?Ai(t,n):t}var Sh=Ke(function(t,n){var r=t==null?0:t.length,o=mi(t,n);return Uo(t,vt(n,function(c){return Xe(c,r)?+c:c}).sort(Yo)),o});function Gi(t){return t==null?t:Gl.call(t)}var Ch=et(function(t){return ln(Ht(t,1,At,!0))}),wh=et(function(t){var n=xe(t);return At(n)&&(n=a),ln(Ht(t,1,At,!0),B(n,2))}),xh=et(function(t){var n=xe(t);return n=typeof n=="function"?n:a,ln(Ht(t,1,At,!0),a,n)});function $i(t){if(!t||!t.length)return[];var n=0;return t=rn(t,function(r){if(At(r))return n=Mt(r.length,n),!0}),ci(n,function(r){return vt(t,ai(r))})}function Tu(t,n){if(!t||!t.length)return[];var r=$i(t);return n==null?r:vt(r,function(o){return oe(n,a,o)})}var Ah=et(function(t,n){return At(t)?ys(t,n):[]}),Ih=et(function(t){return Ri(rn(t,At))}),Eh=et(function(t){var n=xe(t);return At(n)&&(n=a),Ri(rn(t,At),B(n,2))}),Th=et(function(t){var n=xe(t);return n=typeof n=="function"?n:a,Ri(rn(t,At),a,n)}),Mh=et($i),Rh=et(function(t){var n=t.length,r=n>1?t[n-1]:a;return r=typeof r=="function"?(t.pop(),r):a,Tu(t,r)});function Mu(t){var n=h(t);return n.__chain__=!0,n}function gr(t,n){return n(t)}var Fh=Ke(function(t){var n=t.length,r=n?t[0]:0,o=this.__wrapped__,c=function(f){return mi(f,t)};return!(n>1||this.__actions__.length)&&o instanceof nt&&Xe(r)?((o=o.slice(r,+r+(n?1:0))).__actions__.push({func:gr,args:[c],thisArg:a}),new Se(o,this.__chain__).thru(function(f){return n&&!f.length&&f.push(a),f})):this.thru(c)}),qh=ar(function(t,n,r){dt.call(t,r)?++t[r]:Je(t,r,1)}),Ph=nu(wu),Dh=nu(xu);function Ru(t,n){return(Q(t)?ve:cn)(t,B(n,3))}function Fu(t,n){return(Q(t)?Cl:Eo)(t,B(n,3))}var Oh=ar(function(t,n,r){dt.call(t,r)?t[r].push(n):Je(t,r,[n])}),kh=et(function(t,n,r){var o=-1,c=typeof n=="function",f=ee(t)?D(t.length):[];return cn(t,function(_){f[++o]=c?oe(n,_,r):vs(_,n,r)}),f}),Lh=ar(function(t,n,r){Je(t,r,n)});function pr(t,n){return(Q(t)?vt:Do)(t,B(n,3))}var Nh=ar(function(t,n,r){t[r?0:1].push(n)},function(){return[[],[]]}),Hh=et(function(t,n){if(t==null)return[];var r=n.length;return r>1&&Zt(t,n[0],n[1])?n=[]:r>2&&Zt(n[0],n[1],n[2])&&(n=[n[0]]),No(t,Ht(n,1),[])}),_r=Nl||function(){return Nt.Date.now()};function qu(t,n,r){return n=r?a:n,n=t&&n==null?t.length:n,Ye(t,y,a,a,a,a,n)}function Pu(t,n){var r;if(typeof n!="function")throw new be(e);return t=tt(t),function(){return--t>0&&(r=n.apply(this,arguments)),t<=1&&(n=a),r}}var Vi=et(function(t,n,r){var o=1;if(r.length){var c=on(r,Kn(Vi));o|=l}return Ye(t,o,n,r,c)}),Du=et(function(t,n,r){var o=3;if(r.length){var c=on(r,Kn(Du));o|=l}return Ye(n,o,t,r,c)});function Ou(t,n,r){var o,c,f,_,m,b,w=0,C=!1,M=!1,N=!0;if(typeof t!="function")throw new be(e);function U(P){var K=o,Z=c;return o=c=a,w=P,_=t.apply(Z,K)}function z(P){var K=P-b;return b===a||K>=n||K<0||M&&P-w>=f}function x(){var P=_r();if(z(P))return F(P);m=xs(x,function(K){var Z=n-(K-b);return M?jt(Z,f-(K-w)):Z}(P))}function F(P){return m=a,N&&o?U(P):(o=c=a,_)}function G(){var P=_r(),K=z(P);if(o=arguments,c=this,b=P,K){if(m===a)return function(Z){return w=Z,m=xs(x,n),C?U(Z):_}(b);if(M)return Vo(m),m=xs(x,n),U(b)}return m===a&&(m=xs(x,n)),_}return n=Ae(n)||0,St(r)&&(C=!!r.leading,f=(M="maxWait"in r)?Mt(Ae(r.maxWait)||0,n):f,N="trailing"in r?!!r.trailing:N),G.cancel=function(){m!==a&&Vo(m),w=0,o=b=c=m=a},G.flush=function(){return m===a?_:F(_r())},G}var Uh=et(function(t,n){return Io(t,1,n)}),jh=et(function(t,n,r){return Io(t,Ae(n)||0,r)});function mr(t,n){if(typeof t!="function"||n!=null&&typeof n!="function")throw new be(e);var r=function(){var o=arguments,c=n?n.apply(this,o):o[0],f=r.cache;if(f.has(c))return f.get(c);var _=t.apply(this,o);return r.cache=f.set(c,_)||f,_};return r.cache=new(mr.Cache||Ze),r}function yr(t){if(typeof t!="function")throw new be(e);return function(){var n=arguments;switch(n.length){case 0:return!t.call(this);case 1:return!t.call(this,n[0]);case 2:return!t.call(this,n[0],n[1]);case 3:return!t.call(this,n[0],n[1],n[2])}return!t.apply(this,n)}}mr.Cache=Ze;var zh=ch(function(t,n){var r=(n=n.length==1&&Q(n[0])?vt(n[0],ue(B())):vt(Ht(n,1),ue(B()))).length;return et(function(o){for(var c=-1,f=jt(o.length,r);++c<f;)o[c]=n[c].call(this,o[c]);return oe(t,this,o)})}),Zi=et(function(t,n){var r=on(n,Kn(Zi));return Ye(t,l,a,n,r)}),ku=et(function(t,n){var r=on(n,Kn(ku));return Ye(t,p,a,n,r)}),Bh=Ke(function(t,n){return Ye(t,v,a,a,a,n)});function Fe(t,n){return t===n||t!=t&&n!=n}var Wh=lr(bi),Gh=lr(function(t,n){return t>=n}),Fn=Fo(function(){return arguments}())?Fo:function(t){return Ct(t)&&dt.call(t,"callee")&&!mo.call(t,"callee")},Q=D.isArray,$h=Ka?ue(Ka):function(t){return Ct(t)&&Vt(t)==ls};function ee(t){return t!=null&&vr(t.length)&&!Qe(t)}function At(t){return Ct(t)&&ee(t)}var fn=Ul||ia,Vh=Xa?ue(Xa):function(t){return Ct(t)&&Vt(t)==H};function Ji(t){if(!Ct(t))return!1;var n=Vt(t);return n==ht||n=="[object DOMException]"||typeof t.message=="string"&&typeof t.name=="string"&&!As(t)}function Qe(t){if(!St(t))return!1;var n=Vt(t);return n==ie||n==ae||n=="[object AsyncFunction]"||n=="[object Proxy]"}function Lu(t){return typeof t=="number"&&t==tt(t)}function vr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=R}function St(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}function Ct(t){return t!=null&&typeof t=="object"}var Nu=Qa?ue(Qa):function(t){return Ct(t)&&zt(t)==bt};function Hu(t){return typeof t=="number"||Ct(t)&&Vt(t)==Ee}function As(t){if(!Ct(t)||Vt(t)!=qt)return!1;var n=$s(t);if(n===null)return!0;var r=dt.call(n,"constructor")&&n.constructor;return typeof r=="function"&&r instanceof r&&zs.call(r)==Dl}var Yi=to?ue(to):function(t){return Ct(t)&&Vt(t)==Ue},Uu=eo?ue(eo):function(t){return Ct(t)&&zt(t)==Te};function br(t){return typeof t=="string"||!Q(t)&&Ct(t)&&Vt(t)==us}function le(t){return typeof t=="symbol"||Ct(t)&&Vt(t)==Ps}var Xn=no?ue(no):function(t){return Ct(t)&&vr(t.length)&&!!gt[Vt(t)]},Zh=lr(xi),Jh=lr(function(t,n){return t<=n});function ju(t){if(!t)return[];if(ee(t))return br(t)?Me(t):te(t);if(ds&&t[ds])return function(r){for(var o,c=[];!(o=r.next()).done;)c.push(o.value);return c}(t[ds]());var n=zt(t);return(n==bt?hi:n==Te?Hs:Qn)(t)}function tn(t){return t?(t=Ae(t))===E||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:t===0?t:0}function tt(t){var n=tn(t),r=n%1;return n==n?r?n-r:n:0}function zu(t){return t?En(tt(t),0,ut):0}function Ae(t){if(typeof t=="number")return t;if(le(t))return O;if(St(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=St(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=uo(t);var r=Xc.test(t);return r||tl.test(t)?vl(t.slice(2),r?2:8):Kc.test(t)?O:+t}function Bu(t){return Be(t,ne(t))}function lt(t){return t==null?"":ce(t)}var Yh=Jn(function(t,n){if(ws(n)||ee(n))Be(n,Pt(n),t);else for(var r in n)dt.call(n,r)&&ms(t,r,n[r])}),Wu=Jn(function(t,n){Be(n,ne(n),t)}),Sr=Jn(function(t,n,r,o){Be(n,ne(n),t,o)}),Kh=Jn(function(t,n,r,o){Be(n,Pt(n),t,o)}),Xh=Ke(mi),Qh=et(function(t,n){t=pt(t);var r=-1,o=n.length,c=o>2?n[2]:a;for(c&&Zt(n[0],n[1],c)&&(o=1);++r<o;)for(var f=n[r],_=ne(f),m=-1,b=_.length;++m<b;){var w=_[m],C=t[w];(C===a||Fe(C,Gn[w])&&!dt.call(t,w))&&(t[w]=f[w])}return t}),td=et(function(t){return t.push(a,cu),oe(Gu,a,t)});function Ki(t,n,r){var o=t==null?a:Tn(t,n);return o===a?r:o}function Xi(t,n){return t!=null&&du(t,n,nh)}var ed=ru(function(t,n,r){n!=null&&typeof n.toString!="function"&&(n=Bs.call(n)),t[n]=r},ta(se)),nd=ru(function(t,n,r){n!=null&&typeof n.toString!="function"&&(n=Bs.call(n)),dt.call(t,n)?t[n].push(r):t[n]=[r]},B),sd=et(vs);function Pt(t){return ee(t)?Co(t):wi(t)}function ne(t){return ee(t)?Co(t,!0):sh(t)}var rd=Jn(function(t,n,r){sr(t,n,r)}),Gu=Jn(function(t,n,r,o){sr(t,n,r,o)}),id=Ke(function(t,n){var r={};if(t==null)return r;var o=!1;n=vt(n,function(f){return f=hn(f,t),o||(o=f.length>1),f}),Be(t,Li(t),r),o&&(r=Ce(r,7,hh));for(var c=n.length;c--;)Mi(r,n[c]);return r}),ad=Ke(function(t,n){return t==null?{}:function(r,o){return Ho(r,o,function(c,f){return Xi(r,f)})}(t,n)});function $u(t,n){if(t==null)return{};var r=vt(Li(t),function(o){return[o]});return n=B(n),Ho(t,r,function(o,c){return n(o,c[0])})}var Vu=ou(Pt),Zu=ou(ne);function Qn(t){return t==null?[]:li(t,Pt(t))}var od=Yn(function(t,n,r){return n=n.toLowerCase(),t+(r?Ju(n):n)});function Ju(t){return Qi(lt(t).toLowerCase())}function Yu(t){return(t=lt(t))&&t.replace(nl,Il).replace(hl,"")}var ud=Yn(function(t,n,r){return t+(r?"-":"")+n.toLowerCase()}),cd=Yn(function(t,n,r){return t+(r?" ":"")+n.toLowerCase()}),ld=eu("toLowerCase"),hd=Yn(function(t,n,r){return t+(r?"_":"")+n.toLowerCase()}),dd=Yn(function(t,n,r){return t+(r?" ":"")+Qi(n)}),fd=Yn(function(t,n,r){return t+(r?" ":"")+n.toUpperCase()}),Qi=eu("toUpperCase");function Ku(t,n,r){return t=lt(t),(n=r?a:n)===a?function(o){return gl.test(o)}(t)?function(o){return o.match(dl)||[]}(t):function(o){return o.match(Vc)||[]}(t):t.match(n)||[]}var Xu=et(function(t,n){try{return oe(t,a,n)}catch(r){return Ji(r)?r:new rt(r)}}),gd=Ke(function(t,n){return ve(n,function(r){r=We(r),Je(t,r,Vi(t[r],t))}),t});function ta(t){return function(){return t}}var pd=su(),_d=su(!0);function se(t){return t}function ea(t){return Po(typeof t=="function"?t:Ce(t,1))}var md=et(function(t,n){return function(r){return vs(r,t,n)}}),yd=et(function(t,n){return function(r){return vs(t,r,n)}});function na(t,n,r){var o=Pt(n),c=nr(n,o);r!=null||St(n)&&(c.length||!o.length)||(r=n,n=t,t=this,c=nr(n,Pt(n)));var f=!(St(r)&&"chain"in r&&!r.chain),_=Qe(t);return ve(c,function(m){var b=n[m];t[m]=b,_&&(t.prototype[m]=function(){var w=this.__chain__;if(f||w){var C=t(this.__wrapped__);return(C.__actions__=te(this.__actions__)).push({func:b,args:arguments,thisArg:t}),C.__chain__=w,C}return b.apply(t,an([this.value()],arguments))})}),t}function sa(){}var vd=Di(vt),bd=Di(so),Sd=Di(ii);function Qu(t){return ji(t)?ai(We(t)):function(n){return function(r){return Tn(r,n)}}(t)}var Cd=iu(),wd=iu(!0);function ra(){return[]}function ia(){return!1}var aa,xd=ur(function(t,n){return t+n},0),Ad=Oi("ceil"),Id=ur(function(t,n){return t/n},1),Ed=Oi("floor"),Td=ur(function(t,n){return t*n},1),Md=Oi("round"),Rd=ur(function(t,n){return t-n},0);return h.after=function(t,n){if(typeof n!="function")throw new be(e);return t=tt(t),function(){if(--t<1)return n.apply(this,arguments)}},h.ary=qu,h.assign=Yh,h.assignIn=Wu,h.assignInWith=Sr,h.assignWith=Kh,h.at=Xh,h.before=Pu,h.bind=Vi,h.bindAll=gd,h.bindKey=Du,h.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Q(t)?t:[t]},h.chain=Mu,h.chunk=function(t,n,r){n=(r?Zt(t,n,r):n===a)?1:Mt(tt(n),0);var o=t==null?0:t.length;if(!o||n<1)return[];for(var c=0,f=0,_=D(Js(o/n));c<o;)_[f++]=we(t,c,c+=n);return _},h.compact=function(t){for(var n=-1,r=t==null?0:t.length,o=0,c=[];++n<r;){var f=t[n];f&&(c[o++]=f)}return c},h.concat=function(){var t=arguments.length;if(!t)return[];for(var n=D(t-1),r=arguments[0],o=t;o--;)n[o-1]=arguments[o];return an(Q(r)?te(r):[r],Ht(n,1))},h.cond=function(t){var n=t==null?0:t.length,r=B();return t=n?vt(t,function(o){if(typeof o[1]!="function")throw new be(e);return[r(o[0]),o[1]]}):[],et(function(o){for(var c=-1;++c<n;){var f=t[c];if(oe(f[0],this,o))return oe(f[1],this,o)}})},h.conforms=function(t){return function(n){var r=Pt(n);return function(o){return Ao(o,n,r)}}(Ce(t,1))},h.constant=ta,h.countBy=qh,h.create=function(t,n){var r=Zn(t);return n==null?r:xo(r,n)},h.curry=function t(n,r,o){var c=Ye(n,8,a,a,a,a,a,r=o?a:r);return c.placeholder=t.placeholder,c},h.curryRight=function t(n,r,o){var c=Ye(n,u,a,a,a,a,a,r=o?a:r);return c.placeholder=t.placeholder,c},h.debounce=Ou,h.defaults=Qh,h.defaultsDeep=td,h.defer=Uh,h.delay=jh,h.difference=gh,h.differenceBy=ph,h.differenceWith=_h,h.drop=function(t,n,r){var o=t==null?0:t.length;return o?we(t,(n=r||n===a?1:tt(n))<0?0:n,o):[]},h.dropRight=function(t,n,r){var o=t==null?0:t.length;return o?we(t,0,(n=o-(n=r||n===a?1:tt(n)))<0?0:n):[]},h.dropRightWhile=function(t,n){return t&&t.length?ir(t,B(n,3),!0,!0):[]},h.dropWhile=function(t,n){return t&&t.length?ir(t,B(n,3),!0):[]},h.fill=function(t,n,r,o){var c=t==null?0:t.length;return c?(r&&typeof r!="number"&&Zt(t,n,r)&&(r=0,o=c),function(f,_,m,b){var w=f.length;for((m=tt(m))<0&&(m=-m>w?0:w+m),(b=b===a||b>w?w:tt(b))<0&&(b+=w),b=m>b?0:zu(b);m<b;)f[m++]=_;return f}(t,n,r,o)):[]},h.filter=function(t,n){return(Q(t)?rn:To)(t,B(n,3))},h.flatMap=function(t,n){return Ht(pr(t,n),1)},h.flatMapDeep=function(t,n){return Ht(pr(t,n),E)},h.flatMapDepth=function(t,n,r){return r=r===a?1:tt(r),Ht(pr(t,n),r)},h.flatten=Au,h.flattenDeep=function(t){return t!=null&&t.length?Ht(t,E):[]},h.flattenDepth=function(t,n){return t!=null&&t.length?Ht(t,n=n===a?1:tt(n)):[]},h.flip=function(t){return Ye(t,512)},h.flow=pd,h.flowRight=_d,h.fromPairs=function(t){for(var n=-1,r=t==null?0:t.length,o={};++n<r;){var c=t[n];o[c[0]]=c[1]}return o},h.functions=function(t){return t==null?[]:nr(t,Pt(t))},h.functionsIn=function(t){return t==null?[]:nr(t,ne(t))},h.groupBy=Oh,h.initial=function(t){return t!=null&&t.length?we(t,0,-1):[]},h.intersection=mh,h.intersectionBy=yh,h.intersectionWith=vh,h.invert=ed,h.invertBy=nd,h.invokeMap=kh,h.iteratee=ea,h.keyBy=Lh,h.keys=Pt,h.keysIn=ne,h.map=pr,h.mapKeys=function(t,n){var r={};return n=B(n,3),ze(t,function(o,c,f){Je(r,n(o,c,f),o)}),r},h.mapValues=function(t,n){var r={};return n=B(n,3),ze(t,function(o,c,f){Je(r,c,n(o,c,f))}),r},h.matches=function(t){return Oo(Ce(t,1))},h.matchesProperty=function(t,n){return ko(t,Ce(n,1))},h.memoize=mr,h.merge=rd,h.mergeWith=Gu,h.method=md,h.methodOf=yd,h.mixin=na,h.negate=yr,h.nthArg=function(t){return t=tt(t),et(function(n){return Lo(n,t)})},h.omit=id,h.omitBy=function(t,n){return $u(t,yr(B(n)))},h.once=function(t){return Pu(2,t)},h.orderBy=function(t,n,r,o){return t==null?[]:(Q(n)||(n=n==null?[]:[n]),Q(r=o?a:r)||(r=r==null?[]:[r]),No(t,n,r))},h.over=vd,h.overArgs=zh,h.overEvery=bd,h.overSome=Sd,h.partial=Zi,h.partialRight=ku,h.partition=Nh,h.pick=ad,h.pickBy=$u,h.property=Qu,h.propertyOf=function(t){return function(n){return t==null?a:Tn(t,n)}},h.pull=bh,h.pullAll=Eu,h.pullAllBy=function(t,n,r){return t&&t.length&&n&&n.length?Ai(t,n,B(r,2)):t},h.pullAllWith=function(t,n,r){return t&&t.length&&n&&n.length?Ai(t,n,a,r):t},h.pullAt=Sh,h.range=Cd,h.rangeRight=wd,h.rearg=Bh,h.reject=function(t,n){return(Q(t)?rn:To)(t,yr(B(n,3)))},h.remove=function(t,n){var r=[];if(!t||!t.length)return r;var o=-1,c=[],f=t.length;for(n=B(n,3);++o<f;){var _=t[o];n(_,o,t)&&(r.push(_),c.push(o))}return Uo(t,c),r},h.rest=function(t,n){if(typeof t!="function")throw new be(e);return et(t,n=n===a?n:tt(n))},h.reverse=Gi,h.sampleSize=function(t,n,r){return n=(r?Zt(t,n,r):n===a)?1:tt(n),(Q(t)?Kl:ih)(t,n)},h.set=function(t,n,r){return t==null?t:Ss(t,n,r)},h.setWith=function(t,n,r,o){return o=typeof o=="function"?o:a,t==null?t:Ss(t,n,r,o)},h.shuffle=function(t){return(Q(t)?Xl:oh)(t)},h.slice=function(t,n,r){var o=t==null?0:t.length;return o?(r&&typeof r!="number"&&Zt(t,n,r)?(n=0,r=o):(n=n==null?0:tt(n),r=r===a?o:tt(r)),we(t,n,r)):[]},h.sortBy=Hh,h.sortedUniq=function(t){return t&&t.length?zo(t):[]},h.sortedUniqBy=function(t,n){return t&&t.length?zo(t,B(n,2)):[]},h.split=function(t,n,r){return r&&typeof r!="number"&&Zt(t,n,r)&&(n=r=a),(r=r===a?ut:r>>>0)?(t=lt(t))&&(typeof n=="string"||n!=null&&!Yi(n))&&!(n=ce(n))&&zn(t)?dn(Me(t),0,r):t.split(n,r):[]},h.spread=function(t,n){if(typeof t!="function")throw new be(e);return n=n==null?0:Mt(tt(n),0),et(function(r){var o=r[n],c=dn(r,0,n);return o&&an(c,o),oe(t,this,c)})},h.tail=function(t){var n=t==null?0:t.length;return n?we(t,1,n):[]},h.take=function(t,n,r){return t&&t.length?we(t,0,(n=r||n===a?1:tt(n))<0?0:n):[]},h.takeRight=function(t,n,r){var o=t==null?0:t.length;return o?we(t,(n=o-(n=r||n===a?1:tt(n)))<0?0:n,o):[]},h.takeRightWhile=function(t,n){return t&&t.length?ir(t,B(n,3),!1,!0):[]},h.takeWhile=function(t,n){return t&&t.length?ir(t,B(n,3)):[]},h.tap=function(t,n){return n(t),t},h.throttle=function(t,n,r){var o=!0,c=!0;if(typeof t!="function")throw new be(e);return St(r)&&(o="leading"in r?!!r.leading:o,c="trailing"in r?!!r.trailing:c),Ou(t,n,{leading:o,maxWait:n,trailing:c})},h.thru=gr,h.toArray=ju,h.toPairs=Vu,h.toPairsIn=Zu,h.toPath=function(t){return Q(t)?vt(t,We):le(t)?[t]:te(Su(lt(t)))},h.toPlainObject=Bu,h.transform=function(t,n,r){var o=Q(t),c=o||fn(t)||Xn(t);if(n=B(n,4),r==null){var f=t&&t.constructor;r=c?o?new f:[]:St(t)&&Qe(f)?Zn($s(t)):{}}return(c?ve:ze)(t,function(_,m,b){return n(r,_,m,b)}),r},h.unary=function(t){return qu(t,1)},h.union=Ch,h.unionBy=wh,h.unionWith=xh,h.uniq=function(t){return t&&t.length?ln(t):[]},h.uniqBy=function(t,n){return t&&t.length?ln(t,B(n,2)):[]},h.uniqWith=function(t,n){return n=typeof n=="function"?n:a,t&&t.length?ln(t,a,n):[]},h.unset=function(t,n){return t==null||Mi(t,n)},h.unzip=$i,h.unzipWith=Tu,h.update=function(t,n,r){return t==null?t:Wo(t,n,qi(r))},h.updateWith=function(t,n,r,o){return o=typeof o=="function"?o:a,t==null?t:Wo(t,n,qi(r),o)},h.values=Qn,h.valuesIn=function(t){return t==null?[]:li(t,ne(t))},h.without=Ah,h.words=Ku,h.wrap=function(t,n){return Zi(qi(n),t)},h.xor=Ih,h.xorBy=Eh,h.xorWith=Th,h.zip=Mh,h.zipObject=function(t,n){return $o(t||[],n||[],ms)},h.zipObjectDeep=function(t,n){return $o(t||[],n||[],Ss)},h.zipWith=Rh,h.entries=Vu,h.entriesIn=Zu,h.extend=Wu,h.extendWith=Sr,na(h,h),h.add=xd,h.attempt=Xu,h.camelCase=od,h.capitalize=Ju,h.ceil=Ad,h.clamp=function(t,n,r){return r===a&&(r=n,n=a),r!==a&&(r=(r=Ae(r))==r?r:0),n!==a&&(n=(n=Ae(n))==n?n:0),En(Ae(t),n,r)},h.clone=function(t){return Ce(t,4)},h.cloneDeep=function(t){return Ce(t,5)},h.cloneDeepWith=function(t,n){return Ce(t,5,n=typeof n=="function"?n:a)},h.cloneWith=function(t,n){return Ce(t,4,n=typeof n=="function"?n:a)},h.conformsTo=function(t,n){return n==null||Ao(t,n,Pt(n))},h.deburr=Yu,h.defaultTo=function(t,n){return t==null||t!=t?n:t},h.divide=Id,h.endsWith=function(t,n,r){t=lt(t),n=ce(n);var o=t.length,c=r=r===a?o:En(tt(r),0,o);return(r-=n.length)>=0&&t.slice(r,c)==n},h.eq=Fe,h.escape=function(t){return(t=lt(t))&&kc.test(t)?t.replace(Ta,El):t},h.escapeRegExp=function(t){return(t=lt(t))&&zc.test(t)?t.replace(Jr,"\\$&"):t},h.every=function(t,n,r){var o=Q(t)?so:th;return r&&Zt(t,n,r)&&(n=a),o(t,B(n,3))},h.find=Ph,h.findIndex=wu,h.findKey=function(t,n){return ro(t,B(n,3),ze)},h.findLast=Dh,h.findLastIndex=xu,h.findLastKey=function(t,n){return ro(t,B(n,3),vi)},h.floor=Ed,h.forEach=Ru,h.forEachRight=Fu,h.forIn=function(t,n){return t==null?t:yi(t,B(n,3),ne)},h.forInRight=function(t,n){return t==null?t:Mo(t,B(n,3),ne)},h.forOwn=function(t,n){return t&&ze(t,B(n,3))},h.forOwnRight=function(t,n){return t&&vi(t,B(n,3))},h.get=Ki,h.gt=Wh,h.gte=Gh,h.has=function(t,n){return t!=null&&du(t,n,eh)},h.hasIn=Xi,h.head=Iu,h.identity=se,h.includes=function(t,n,r,o){t=ee(t)?t:Qn(t),r=r&&!o?tt(r):0;var c=t.length;return r<0&&(r=Mt(c+r,0)),br(t)?r<=c&&t.indexOf(n,r)>-1:!!c&&jn(t,n,r)>-1},h.indexOf=function(t,n,r){var o=t==null?0:t.length;if(!o)return-1;var c=r==null?0:tt(r);return c<0&&(c=Mt(o+c,0)),jn(t,n,c)},h.inRange=function(t,n,r){return n=tn(n),r===a?(r=n,n=0):r=tn(r),function(o,c,f){return o>=jt(c,f)&&o<Mt(c,f)}(t=Ae(t),n,r)},h.invoke=sd,h.isArguments=Fn,h.isArray=Q,h.isArrayBuffer=$h,h.isArrayLike=ee,h.isArrayLikeObject=At,h.isBoolean=function(t){return t===!0||t===!1||Ct(t)&&Vt(t)==st},h.isBuffer=fn,h.isDate=Vh,h.isElement=function(t){return Ct(t)&&t.nodeType===1&&!As(t)},h.isEmpty=function(t){if(t==null)return!0;if(ee(t)&&(Q(t)||typeof t=="string"||typeof t.splice=="function"||fn(t)||Xn(t)||Fn(t)))return!t.length;var n=zt(t);if(n==bt||n==Te)return!t.size;if(ws(t))return!wi(t).length;for(var r in t)if(dt.call(t,r))return!1;return!0},h.isEqual=function(t,n){return bs(t,n)},h.isEqualWith=function(t,n,r){var o=(r=typeof r=="function"?r:a)?r(t,n):a;return o===a?bs(t,n,a,r):!!o},h.isError=Ji,h.isFinite=function(t){return typeof t=="number"&&vo(t)},h.isFunction=Qe,h.isInteger=Lu,h.isLength=vr,h.isMap=Nu,h.isMatch=function(t,n){return t===n||Ci(t,n,Hi(n))},h.isMatchWith=function(t,n,r){return r=typeof r=="function"?r:a,Ci(t,n,Hi(n),r)},h.isNaN=function(t){return Hu(t)&&t!=+t},h.isNative=function(t){if(fh(t))throw new rt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return qo(t)},h.isNil=function(t){return t==null},h.isNull=function(t){return t===null},h.isNumber=Hu,h.isObject=St,h.isObjectLike=Ct,h.isPlainObject=As,h.isRegExp=Yi,h.isSafeInteger=function(t){return Lu(t)&&t>=-9007199254740991&&t<=R},h.isSet=Uu,h.isString=br,h.isSymbol=le,h.isTypedArray=Xn,h.isUndefined=function(t){return t===a},h.isWeakMap=function(t){return Ct(t)&&zt(t)==cs},h.isWeakSet=function(t){return Ct(t)&&Vt(t)=="[object WeakSet]"},h.join=function(t,n){return t==null?"":jl.call(t,n)},h.kebabCase=ud,h.last=xe,h.lastIndexOf=function(t,n,r){var o=t==null?0:t.length;if(!o)return-1;var c=o;return r!==a&&(c=(c=tt(r))<0?Mt(o+c,0):jt(c,o-1)),n==n?function(f,_,m){for(var b=m+1;b--;)if(f[b]===_)return b;return b}(t,n,c):Ns(t,io,c,!0)},h.lowerCase=cd,h.lowerFirst=ld,h.lt=Zh,h.lte=Jh,h.max=function(t){return t&&t.length?er(t,se,bi):a},h.maxBy=function(t,n){return t&&t.length?er(t,B(n,2),bi):a},h.mean=function(t){return ao(t,se)},h.meanBy=function(t,n){return ao(t,B(n,2))},h.min=function(t){return t&&t.length?er(t,se,xi):a},h.minBy=function(t,n){return t&&t.length?er(t,B(n,2),xi):a},h.stubArray=ra,h.stubFalse=ia,h.stubObject=function(){return{}},h.stubString=function(){return""},h.stubTrue=function(){return!0},h.multiply=Td,h.nth=function(t,n){return t&&t.length?Lo(t,tt(n)):a},h.noConflict=function(){return Nt._===this&&(Nt._=Ol),this},h.noop=sa,h.now=_r,h.pad=function(t,n,r){t=lt(t);var o=(n=tt(n))?Bn(t):0;if(!n||o>=n)return t;var c=(n-o)/2;return cr(Ys(c),r)+t+cr(Js(c),r)},h.padEnd=function(t,n,r){t=lt(t);var o=(n=tt(n))?Bn(t):0;return n&&o<n?t+cr(n-o,r):t},h.padStart=function(t,n,r){t=lt(t);var o=(n=tt(n))?Bn(t):0;return n&&o<n?cr(n-o,r)+t:t},h.parseInt=function(t,n,r){return r||n==null?n=0:n&&(n=+n),Wl(lt(t).replace(Yr,""),n||0)},h.random=function(t,n,r){if(r&&typeof r!="boolean"&&Zt(t,n,r)&&(n=r=a),r===a&&(typeof n=="boolean"?(r=n,n=a):typeof t=="boolean"&&(r=t,t=a)),t===a&&n===a?(t=0,n=1):(t=tn(t),n===a?(n=t,t=0):n=tn(n)),t>n){var o=t;t=n,n=o}if(r||t%1||n%1){var c=bo();return jt(t+c*(n-t+yl("1e-"+((c+"").length-1))),n)}return Ii(t,n)},h.reduce=function(t,n,r){var o=Q(t)?ri:oo,c=arguments.length<3;return o(t,B(n,4),r,c,cn)},h.reduceRight=function(t,n,r){var o=Q(t)?wl:oo,c=arguments.length<3;return o(t,B(n,4),r,c,Eo)},h.repeat=function(t,n,r){return n=(r?Zt(t,n,r):n===a)?1:tt(n),Ei(lt(t),n)},h.replace=function(){var t=arguments,n=lt(t[0]);return t.length<3?n:n.replace(t[1],t[2])},h.result=function(t,n,r){var o=-1,c=(n=hn(n,t)).length;for(c||(c=1,t=a);++o<c;){var f=t==null?a:t[We(n[o])];f===a&&(o=c,f=r),t=Qe(f)?f.call(t):f}return t},h.round=Md,h.runInContext=S,h.sample=function(t){return(Q(t)?wo:rh)(t)},h.size=function(t){if(t==null)return 0;if(ee(t))return br(t)?Bn(t):t.length;var n=zt(t);return n==bt||n==Te?t.size:wi(t).length},h.snakeCase=hd,h.some=function(t,n,r){var o=Q(t)?ii:uh;return r&&Zt(t,n,r)&&(n=a),o(t,B(n,3))},h.sortedIndex=function(t,n){return rr(t,n)},h.sortedIndexBy=function(t,n,r){return Ti(t,n,B(r,2))},h.sortedIndexOf=function(t,n){var r=t==null?0:t.length;if(r){var o=rr(t,n);if(o<r&&Fe(t[o],n))return o}return-1},h.sortedLastIndex=function(t,n){return rr(t,n,!0)},h.sortedLastIndexBy=function(t,n,r){return Ti(t,n,B(r,2),!0)},h.sortedLastIndexOf=function(t,n){if(t!=null&&t.length){var r=rr(t,n,!0)-1;if(Fe(t[r],n))return r}return-1},h.startCase=dd,h.startsWith=function(t,n,r){return t=lt(t),r=r==null?0:En(tt(r),0,t.length),n=ce(n),t.slice(r,r+n.length)==n},h.subtract=Rd,h.sum=function(t){return t&&t.length?ui(t,se):0},h.sumBy=function(t,n){return t&&t.length?ui(t,B(n,2)):0},h.template=function(t,n,r){var o=h.templateSettings;r&&Zt(t,n,r)&&(n=a),t=lt(t),n=Sr({},n,o,uu);var c,f,_=Sr({},n.imports,o.imports,uu),m=Pt(_),b=li(_,m),w=0,C=n.interpolate||Ds,M="__p += '",N=di((n.escape||Ds).source+"|"+C.source+"|"+(C===Ma?Yc:Ds).source+"|"+(n.evaluate||Ds).source+"|$","g"),U="//# sourceURL="+(dt.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++_l+"]")+`
`;t.replace(N,function(F,G,P,K,Z,ct){return P||(P=K),M+=t.slice(w,ct).replace(sl,Tl),G&&(c=!0,M+=`' +
__e(`+G+`) +
'`),Z&&(f=!0,M+=`';
`+Z+`;
__p += '`),P&&(M+=`' +
((__t = (`+P+`)) == null ? '' : __t) +
'`),w=ct+F.length,F}),M+=`';
`;var z=dt.call(n,"variable")&&n.variable;if(z){if(Zc.test(z))throw new rt("Invalid `variable` option passed into `_.template`")}else M=`with (obj) {
`+M+`
}
`;M=(f?M.replace(qc,""):M).replace(Pc,"$1").replace(Dc,"$1;"),M="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(c?", __e = _.escape":"")+(f?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+M+`return __p
}`;var x=Xu(function(){return Tt(m,U+"return "+M).apply(a,b)});if(x.source=M,Ji(x))throw x;return x},h.times=function(t,n){if((t=tt(t))<1||t>R)return[];var r=ut,o=jt(t,ut);n=B(n),t-=ut;for(var c=ci(o,n);++r<t;)n(r);return c},h.toFinite=tn,h.toInteger=tt,h.toLength=zu,h.toLower=function(t){return lt(t).toLowerCase()},h.toNumber=Ae,h.toSafeInteger=function(t){return t?En(tt(t),-9007199254740991,R):t===0?t:0},h.toString=lt,h.toUpper=function(t){return lt(t).toUpperCase()},h.trim=function(t,n,r){if((t=lt(t))&&(r||n===a))return uo(t);if(!t||!(n=ce(n)))return t;var o=Me(t),c=Me(n);return dn(o,co(o,c),lo(o,c)+1).join("")},h.trimEnd=function(t,n,r){if((t=lt(t))&&(r||n===a))return t.slice(0,fo(t)+1);if(!t||!(n=ce(n)))return t;var o=Me(t);return dn(o,0,lo(o,Me(n))+1).join("")},h.trimStart=function(t,n,r){if((t=lt(t))&&(r||n===a))return t.replace(Yr,"");if(!t||!(n=ce(n)))return t;var o=Me(t);return dn(o,co(o,Me(n))).join("")},h.truncate=function(t,n){var r=30,o="...";if(St(n)){var c="separator"in n?n.separator:c;r="length"in n?tt(n.length):r,o="omission"in n?ce(n.omission):o}var f=(t=lt(t)).length;if(zn(t)){var _=Me(t);f=_.length}if(r>=f)return t;var m=r-Bn(o);if(m<1)return o;var b=_?dn(_,0,m).join(""):t.slice(0,m);if(c===a)return b+o;if(_&&(m+=b.length-m),Yi(c)){if(t.slice(m).search(c)){var w,C=b;for(c.global||(c=di(c.source,lt(Ra.exec(c))+"g")),c.lastIndex=0;w=c.exec(C);)var M=w.index;b=b.slice(0,M===a?m:M)}}else if(t.indexOf(ce(c),m)!=m){var N=b.lastIndexOf(c);N>-1&&(b=b.slice(0,N))}return b+o},h.unescape=function(t){return(t=lt(t))&&Oc.test(t)?t.replace(Ea,Rl):t},h.uniqueId=function(t){var n=++Pl;return lt(t)+n},h.upperCase=fd,h.upperFirst=Qi,h.each=Ru,h.eachRight=Fu,h.first=Iu,na(h,(aa={},ze(h,function(t,n){dt.call(h.prototype,n)||(aa[n]=t)}),aa),{chain:!1}),h.VERSION="4.17.21",ve(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){h[t].placeholder=h}),ve(["drop","take"],function(t,n){nt.prototype[t]=function(r){r=r===a?1:Mt(tt(r),0);var o=this.__filtered__&&!n?new nt(this):this.clone();return o.__filtered__?o.__takeCount__=jt(r,o.__takeCount__):o.__views__.push({size:jt(r,ut),type:t+(o.__dir__<0?"Right":"")}),o},nt.prototype[t+"Right"]=function(r){return this.reverse()[t](r).reverse()}}),ve(["filter","map","takeWhile"],function(t,n){var r=n+1,o=r==1||r==3;nt.prototype[t]=function(c){var f=this.clone();return f.__iteratees__.push({iteratee:B(c,3),type:r}),f.__filtered__=f.__filtered__||o,f}}),ve(["head","last"],function(t,n){var r="take"+(n?"Right":"");nt.prototype[t]=function(){return this[r](1).value()[0]}}),ve(["initial","tail"],function(t,n){var r="drop"+(n?"":"Right");nt.prototype[t]=function(){return this.__filtered__?new nt(this):this[r](1)}}),nt.prototype.compact=function(){return this.filter(se)},nt.prototype.find=function(t){return this.filter(t).head()},nt.prototype.findLast=function(t){return this.reverse().find(t)},nt.prototype.invokeMap=et(function(t,n){return typeof t=="function"?new nt(this):this.map(function(r){return vs(r,t,n)})}),nt.prototype.reject=function(t){return this.filter(yr(B(t)))},nt.prototype.slice=function(t,n){t=tt(t);var r=this;return r.__filtered__&&(t>0||n<0)?new nt(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),n!==a&&(r=(n=tt(n))<0?r.dropRight(-n):r.take(n-t)),r)},nt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},nt.prototype.toArray=function(){return this.take(ut)},ze(nt.prototype,function(t,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),o=/^(?:head|last)$/.test(n),c=h[o?"take"+(n=="last"?"Right":""):n],f=o||/^find/.test(n);c&&(h.prototype[n]=function(){var _=this.__wrapped__,m=o?[1]:arguments,b=_ instanceof nt,w=m[0],C=b||Q(_),M=function(G){var P=c.apply(h,an([G],m));return o&&N?P[0]:P};C&&r&&typeof w=="function"&&w.length!=1&&(b=C=!1);var N=this.__chain__,U=!!this.__actions__.length,z=f&&!N,x=b&&!U;if(!f&&C){_=x?_:new nt(this);var F=t.apply(_,m);return F.__actions__.push({func:gr,args:[M],thisArg:a}),new Se(F,N)}return z&&x?t.apply(this,m):(F=this.thru(M),z?o?F.value()[0]:F.value():F)})}),ve(["pop","push","shift","sort","splice","unshift"],function(t){var n=Us[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",o=/^(?:pop|shift)$/.test(t);h.prototype[t]=function(){var c=arguments;if(o&&!this.__chain__){var f=this.value();return n.apply(Q(f)?f:[],c)}return this[r](function(_){return n.apply(Q(_)?_:[],c)})}}),ze(nt.prototype,function(t,n){var r=h[n];if(r){var o=r.name+"";dt.call(Vn,o)||(Vn[o]=[]),Vn[o].push({name:n,func:r})}}),Vn[or(a,2).name]=[{name:"wrapper",func:a}],nt.prototype.clone=function(){var t=new nt(this.__wrapped__);return t.__actions__=te(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=te(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=te(this.__views__),t},nt.prototype.reverse=function(){if(this.__filtered__){var t=new nt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},nt.prototype.value=function(){var t=this.__wrapped__.value(),n=this.__dir__,r=Q(t),o=n<0,c=r?t.length:0,f=function(ct,j,$){for(var Rt=-1,It=$.length;++Rt<It;){var Jt=$[Rt],_t=Jt.size;switch(Jt.type){case"drop":ct+=_t;break;case"dropRight":j-=_t;break;case"take":j=jt(j,ct+_t);break;case"takeRight":ct=Mt(ct,j-_t)}}return{start:ct,end:j}}(0,c,this.__views__),_=f.start,m=f.end,b=m-_,w=o?m:_-1,C=this.__iteratees__,M=C.length,N=0,U=jt(b,this.__takeCount__);if(!r||!o&&c==b&&U==b)return Go(t,this.__actions__);var z=[];t:for(;b--&&N<U;){for(var x=-1,F=t[w+=n];++x<M;){var G=C[x],P=G.iteratee,K=G.type,Z=P(F);if(K==2)F=Z;else if(!Z){if(K==1)continue t;break t}}z[N++]=F}return z},h.prototype.at=Fh,h.prototype.chain=function(){return Mu(this)},h.prototype.commit=function(){return new Se(this.value(),this.__chain__)},h.prototype.next=function(){this.__values__===a&&(this.__values__=ju(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?a:this.__values__[this.__index__++]}},h.prototype.plant=function(t){for(var n,r=this;r instanceof Qs;){var o=Cu(r);o.__index__=0,o.__values__=a,n?c.__wrapped__=o:n=o;var c=o;r=r.__wrapped__}return c.__wrapped__=t,n},h.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof nt){var n=t;return this.__actions__.length&&(n=new nt(this)),(n=n.reverse()).__actions__.push({func:gr,args:[Gi],thisArg:a}),new Se(n,this.__chain__)}return this.thru(Gi)},h.prototype.toJSON=h.prototype.valueOf=h.prototype.value=function(){return Go(this.__wrapped__,this.__actions__)},h.prototype.first=h.prototype.head,ds&&(h.prototype[ds]=function(){return this}),h}();wn?((wn.exports=Wn)._=Wn,ei._=Wn):Nt._=Wn}).call(Is);var Sg=xa.exports;const Cg="messageRenderOptions",wg={doHideThreadSelector:!1,doHideStatusBars:!1,doHideSlashActions:!1,doHideAtMentions:!1,doHideAgentSwitcher:!1,doHideNewThreadButton:!1,doHideMultimodalActions:!1,doHideContextBar:!1,doShowTurnSelector:!1,doHideFloatingButtons:!1},xg={doHideThreadSelector:!0,doHideStatusBars:!0,doHideSlashActions:!0,doHideAtMentions:!0,doHideAgentSwitcher:!1,doHideNewThreadButton:!0,doHideMultimodalActions:!0,doHideContextBar:!0,doShowTurnSelector:!0,doHideFloatingButtons:!0},Ag="selectedTurnIndex";function Ig(){const a=Dd("chatModel");return a||console.warn("ChatModel not found in context"),a}function Eg(a){return Od("chatModel",a),a}function Cf(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M12 13C12.5523 13 13 12.5523 13 12V3C13 2.44771 12.5523 2 12 2H3C2.44771 2 2 2.44771 2 3V6.5C2 6.77614 2.22386 7 2.5 7C2.77614 7 3 6.77614 3 6.5V3H12V12H8.5C8.22386 12 8 12.2239 8 12.5C8 12.7761 8.22386 13 8.5 13H12ZM9 6.5C9 6.5001 9 6.50021 9 6.50031V6.50035V9.5C9 9.77614 8.77614 10 8.5 10C8.22386 10 8 9.77614 8 9.5V7.70711L2.85355 12.8536C2.65829 13.0488 2.34171 13.0488 2.14645 12.8536C1.95118 12.6583 1.95118 12.3417 2.14645 12.1464L7.29289 7H5.5C5.22386 7 5 6.77614 5 6.5C5 6.22386 5.22386 6 5.5 6H8.5C8.56779 6 8.63244 6.01349 8.69139 6.03794C8.74949 6.06198 8.80398 6.09744 8.85143 6.14433C8.94251 6.23434 8.9992 6.35909 8.99999 6.49708L8.99999 6.49738"),L(s,"fill","currentColor"),L(e,"class",a[0]),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p(i,[u]){1&u&&L(e,"class",i[0])},i:xt,o:xt,d(i){i&&sn(e)}}}function wf(a,e,s){let{class:i=""}=e;return a.$$set=u=>{"class"in u&&s(0,i=u.class)},[i]}class Tg extends bn{constructor(e){super(),Sn(this,e,wf,Cf,Cn,{class:0})}}function xf(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M3.5 2.82672C3.5 2.55058 3.72386 2.32672 4 2.32672H9.79289L12.5 5.03383V12.8267C12.5 13.1028 12.2761 13.3267 12 13.3267H4C3.72386 13.3267 3.5 13.1028 3.5 12.8267V2.82672ZM4 1.32672C3.17157 1.32672 2.5 1.99829 2.5 2.82672V12.8267C2.5 13.6551 3.17157 14.3267 4 14.3267H12C12.8284 14.3267 13.5 13.6551 13.5 12.8267V4.93027C13.5 4.73136 13.421 4.5406 13.2803 4.39994L10.3535 1.47317C10.2598 1.3794 10.1326 1.32672 10 1.32672H4ZM10.25 6.6595C10.5261 6.6595 10.75 6.43564 10.75 6.1595C10.75 5.88336 10.5261 5.6595 10.25 5.6595H8.49996L8.49996 3.9095C8.49996 3.6334 8.2761 3.4095 7.99996 3.4095C7.72382 3.4095 7.49996 3.6334 7.49996 3.9095V5.6595H5.74996C5.47386 5.6595 5.24996 5.88336 5.24996 6.1595C5.24996 6.43564 5.47386 6.6595 5.74996 6.6595L7.49996 6.6595V8.4095C7.49996 8.68564 7.72382 8.9095 7.99996 8.9095C8.2761 8.9095 8.49996 8.68564 8.49996 8.4095V6.6595H10.25ZM10.4999 11.4188C10.4999 11.695 10.2761 11.9188 9.99993 11.9188H5.99993C5.72379 11.9188 5.49993 11.695 5.49993 11.4188C5.49993 11.1427 5.72379 10.9188 5.99993 10.9188H9.99993C10.2761 10.9188 10.4999 11.1427 10.4999 11.4188Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class Mg extends bn{constructor(e){super(),Sn(this,e,null,xf,Cn,{})}}function Af(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class Rg extends bn{constructor(e){super(),Sn(this,e,null,Af,Cn,{})}}function If(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V4.70711L9.29289 2H3.5ZM2 2.5C2 1.67157 2.67157 1 3.5 1H9.5C9.63261 1 9.75979 1.05268 9.85355 1.14645L12.7803 4.07322C12.921 4.21388 13 4.40464 13 4.60355V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5ZM4.75 7.5C4.75 7.22386 4.97386 7 5.25 7H7V5.25C7 4.97386 7.22386 4.75 7.5 4.75C7.77614 4.75 8 4.97386 8 5.25V7H9.75C10.0261 7 10.25 7.22386 10.25 7.5C10.25 7.77614 10.0261 8 9.75 8H8V9.75C8 10.0261 7.77614 10.25 7.5 10.25C7.22386 10.25 7 10.0261 7 9.75V8H5.25C4.97386 8 4.75 7.77614 4.75 7.5Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class Fg extends bn{constructor(e){super(),Sn(this,e,null,If,Cn,{})}}function Ef(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M3.13523 8.84197C3.3241 9.04343 3.64052 9.05363 3.84197 8.86477L7.5 5.43536L11.158 8.86477C11.3595 9.05363 11.6759 9.04343 11.8648 8.84197C12.0536 8.64051 12.0434 8.32409 11.842 8.13523L7.84197 4.38523C7.64964 4.20492 7.35036 4.20492 7.15803 4.38523L3.15803 8.13523C2.95657 8.32409 2.94637 8.64051 3.13523 8.84197Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class qg extends bn{constructor(e){super(),Sn(this,e,null,Ef,Cn,{})}}function Tf(a){let e,s,i=[{xmlns:"http://www.w3.org/2000/svg"},{"data-ds-icon":"fa"},{viewBox:"0 0 448 512"},a[0]],u={};for(let l=0;l<i.length;l+=1)u=fa(u,i[l]);return{c(){e=Qt("svg"),s=new kd(!0),this.h()},l(l){e=Ld(l,"svg",{xmlns:!0,"data-ds-icon":!0,viewBox:!0});var p=Nd(e);s=Hd(p,!0),p.forEach(sn),this.h()},h(){s.a=null,rc(e,u)},m(l,p){Ud(l,e,p),s.m('<!--! Font Awesome Pro 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2024 Fonticons, Inc.--><path d="M448 128c0 53-43 96-96 96-28.9 0-54.8-12.8-72.4-33l-89.7 44.9c1.4 6.5 2.1 13.2 2.1 20.1s-.7 13.6-2.1 20.1l89.7 44.9c17.6-20.2 43.5-33 72.4-33 53 0 96 43 96 96s-43 96-96 96-96-43-96-96c0-6.9.7-13.6 2.1-20.1L168.4 319c-17.6 20.2-43.5 33-72.4 33-53 0-96-43-96-96s43-96 96-96c28.9 0 54.8 12.8 72.4 33l89.7-44.9c-1.4-6.5-2.1-13.2-2.1-20.1 0-53 43-96 96-96s96 43 96 96M96 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96m304-176a48 48 0 1 0-96 0 48 48 0 1 0 96 0m-48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96"/>',e)},p(l,[p]){rc(e,u=jd(i,[{xmlns:"http://www.w3.org/2000/svg"},{"data-ds-icon":"fa"},{viewBox:"0 0 448 512"},1&p&&l[0]]))},i:xt,o:xt,d(l){l&&sn(e)}}}function Mf(a,e,s){return a.$$set=i=>{s(0,e=fa(fa({},e),ic(i)))},[e=ic(e)]}class Pg extends bn{constructor(e){super(),Sn(this,e,Mf,Tf,Cn,{})}}function Rf(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M1.90321 7.29677C1.90321 10.341 4.11041 12.4147 6.58893 12.8439C6.87255 12.893 7.06266 13.1627 7.01355 13.4464C6.96444 13.73 6.69471 13.9201 6.41109 13.871C3.49942 13.3668 0.86084 10.9127 0.86084 7.29677C0.860839 5.76009 1.55996 4.55245 2.37639 3.63377C2.96124 2.97568 3.63034 2.44135 4.16846 2.03202L2.53205 2.03202C2.25591 2.03202 2.03205 1.80816 2.03205 1.53202C2.03205 1.25588 2.25591 1.03202 2.53205 1.03202L5.53205 1.03202C5.80819 1.03202 6.03205 1.25588 6.03205 1.53202L6.03205 4.53202C6.03205 4.80816 5.80819 5.03202 5.53205 5.03202C5.25591 5.03202 5.03205 4.80816 5.03205 4.53202L5.03205 2.68645L5.03054 2.68759L5.03045 2.68766L5.03044 2.68767L5.03043 2.68767C4.45896 3.11868 3.76059 3.64538 3.15554 4.3262C2.44102 5.13021 1.90321 6.10154 1.90321 7.29677ZM13.0109 7.70321C13.0109 4.69115 10.8505 2.6296 8.40384 2.17029C8.12093 2.11718 7.93465 1.84479 7.98776 1.56188C8.04087 1.27898 8.31326 1.0927 8.59616 1.14581C11.4704 1.68541 14.0532 4.12605 14.0532 7.70321C14.0532 9.23988 13.3541 10.4475 12.5377 11.3662C11.9528 12.0243 11.2837 12.5586 10.7456 12.968L12.3821 12.968C12.6582 12.968 12.8821 13.1918 12.8821 13.468C12.8821 13.7441 12.6582 13.968 12.3821 13.968L9.38205 13.968C9.10591 13.968 8.88205 13.7441 8.88205 13.468L8.88205 10.468C8.88205 10.1918 9.10591 9.96796 9.38205 9.96796C9.65819 9.96796 9.88205 10.1918 9.88205 10.468L9.88205 12.3135L9.88362 12.3123C10.4551 11.8813 11.1535 11.3546 11.7585 10.6738C12.4731 9.86976 13.0109 8.89844 13.0109 7.70321Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class Dg extends bn{constructor(e){super(),Sn(this,e,null,Rf,Cn,{})}}function Ff(a){let e,s;return{c(){e=Qt("svg"),s=Qt("path"),L(s,"fill-rule","evenodd"),L(s,"clip-rule","evenodd"),L(s,"d","M7.49991 0.877075C3.84222 0.877075 0.877075 3.84222 0.877075 7.49991C0.877075 11.1576 3.84222 14.1227 7.49991 14.1227C11.1576 14.1227 14.1227 11.1576 14.1227 7.49991C14.1227 3.84222 11.1576 0.877075 7.49991 0.877075ZM3.85768 3.15057C4.84311 2.32448 6.11342 1.82708 7.49991 1.82708C10.6329 1.82708 13.1727 4.36689 13.1727 7.49991C13.1727 8.88638 12.6753 10.1567 11.8492 11.1421L3.85768 3.15057ZM3.15057 3.85768C2.32448 4.84311 1.82708 6.11342 1.82708 7.49991C1.82708 10.6329 4.36689 13.1727 7.49991 13.1727C8.88638 13.1727 10.1567 12.6753 11.1421 11.8492L3.15057 3.85768Z"),L(s,"fill","currentColor"),L(e,"width","15"),L(e,"height","15"),L(e,"viewBox","0 0 15 15"),L(e,"fill","none"),L(e,"xmlns","http://www.w3.org/2000/svg")},m(i,u){Ln(i,e,u),Nn(e,s)},p:xt,i:xt,o:xt,d(i){i&&sn(e)}}}class Og extends bn{constructor(e){super(),Sn(this,e,null,Ff,Cn,{})}}export{cc as $,Pn as A,Hr as B,pg as C,wg as D,ot as E,dg as F,ns as G,gf as H,gg as I,Mg as J,Rg as K,Fg as L,Cg as M,fg as N,Tg as O,Zf as P,xg as Q,Sf as R,Lt as S,Xt as T,qg as U,Sc as V,ga as W,Cc as X,wc as Y,pa as Z,lc as _,Bf as a,Aa as a0,Ig as a1,Qf as a2,ng as a3,kt as a4,og as a5,ag as a6,tg as a7,sg as a8,rg as a9,ig as aa,eg as ab,sf as ac,Pg as ad,Dg as ae,Og as af,Fc as ag,bf as ah,bg as ai,Ag as aj,rf as ak,Ac as al,ug as am,vg as an,Wf as b,$f as c,Gf as d,Uf as e,jf as f,zf as g,Vf as h,_e as i,Rs as j,Kf as k,Xf as l,_g as m,Yf as n,Jf as o,es as p,yg as q,Sg as r,Eg as s,mg as t,yf as u,ss as v,lg as w,wt as x,cg as y,hg as z};
