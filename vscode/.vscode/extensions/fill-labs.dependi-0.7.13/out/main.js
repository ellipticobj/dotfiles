"use strict";var fo=Object.create;var Rt=Object.defineProperty;var mo=Object.getOwnPropertyDescriptor;var ho=Object.getOwnPropertyNames;var go=Object.getPrototypeOf,Eo=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),yo=(t,e)=>{for(var r in e)Rt(t,r,{get:e[r],enumerable:!0})},hn=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ho(e))!Eo.call(t,s)&&s!==r&&Rt(t,s,{get:()=>e[s],enumerable:!(n=mo(e,s))||n.enumerable});return t};var O=(t,e,r)=>(r=t!=null?fo(go(t)):{},hn(e||!t||!t.__esModule?Rt(r,"default",{value:t,enumerable:!0}):r,t)),Ro=t=>hn(Rt({},"__esModule",{value:!0}),t);var yn=y((Fu,vt)=>{var xo=function(){"use strict";function t(u,p){return p!=null&&u instanceof p}var e;try{e=Map}catch{e=function(){}}var r;try{r=Set}catch{r=function(){}}var n;try{n=Promise}catch{n=function(){}}function s(u,p,m,d,x){typeof p=="object"&&(m=p.depth,d=p.prototype,x=p.includeNonEnumerable,p=p.circular);var S=[],ce=[],Q=typeof Buffer<"u";typeof p>"u"&&(p=!0),typeof m>"u"&&(m=1/0);function F(b,B){if(b===null)return null;if(B===0)return b;var L,le;if(typeof b!="object")return b;if(t(b,e))L=new e;else if(t(b,r))L=new r;else if(t(b,n))L=new n(function(Je,ze){b.then(function(Qe){Je(F(Qe,B-1))},function(Qe){ze(F(Qe,B-1))})});else if(s.__isArray(b))L=[];else if(s.__isRegExp(b))L=new RegExp(b.source,c(b)),b.lastIndex&&(L.lastIndex=b.lastIndex);else if(s.__isDate(b))L=new Date(b.getTime());else{if(Q&&Buffer.isBuffer(b))return Buffer.allocUnsafe?L=Buffer.allocUnsafe(b.length):L=new Buffer(b.length),b.copy(L),L;t(b,Error)?L=Object.create(b):typeof d>"u"?(le=Object.getPrototypeOf(b),L=Object.create(le)):(L=Object.create(d),le=d)}if(p){var fn=S.indexOf(b);if(fn!=-1)return ce[fn];S.push(b),ce.push(L)}t(b,e)&&b.forEach(function(Je,ze){var Qe=F(ze,B-1),po=F(Je,B-1);L.set(Qe,po)}),t(b,r)&&b.forEach(function(Je){var ze=F(Je,B-1);L.add(ze)});for(var Z in b){var mr;le&&(mr=Object.getOwnPropertyDescriptor(le,Z)),!(mr&&mr.set==null)&&(L[Z]=F(b[Z],B-1))}if(Object.getOwnPropertySymbols)for(var mn=Object.getOwnPropertySymbols(b),Z=0;Z<mn.length;Z++){var Et=mn[Z],Le=Object.getOwnPropertyDescriptor(b,Et);Le&&!Le.enumerable&&!x||(L[Et]=F(b[Et],B-1),Le.enumerable||Object.defineProperty(L,Et,{enumerable:!1}))}if(x)for(var dn=Object.getOwnPropertyNames(b),Z=0;Z<dn.length;Z++){var yt=dn[Z],Le=Object.getOwnPropertyDescriptor(b,yt);Le&&Le.enumerable||(L[yt]=F(b[yt],B-1),Object.defineProperty(L,yt,{enumerable:!1}))}return L}return F(u,m)}s.clonePrototype=function(p){if(p===null)return null;var m=function(){};return m.prototype=p,new m};function i(u){return Object.prototype.toString.call(u)}s.__objToStr=i;function o(u){return typeof u=="object"&&i(u)==="[object Date]"}s.__isDate=o;function l(u){return typeof u=="object"&&i(u)==="[object Array]"}s.__isArray=l;function a(u){return typeof u=="object"&&i(u)==="[object RegExp]"}s.__isRegExp=a;function c(u){var p="";return u.global&&(p+="g"),u.ignoreCase&&(p+="i"),u.multiline&&(p+="m"),p}return s.__getRegExpFlags=c,s}();typeof vt=="object"&&vt.exports&&(vt.exports=xo)});var vn=y((Rn,bn)=>{(function(){var t,e,r,n=[].splice,s=function(o,l){if(!(o instanceof l))throw new Error("Bound instance method accessed before binding")},i=[].indexOf;r=yn(),t=require("events").EventEmitter,bn.exports=e=function(){class o extends t{constructor(a={}){super(),this.get=this.get.bind(this),this.mget=this.mget.bind(this),this.set=this.set.bind(this),this.mset=this.mset.bind(this),this.del=this.del.bind(this),this.take=this.take.bind(this),this.ttl=this.ttl.bind(this),this.getTtl=this.getTtl.bind(this),this.keys=this.keys.bind(this),this.has=this.has.bind(this),this.getStats=this.getStats.bind(this),this.flushAll=this.flushAll.bind(this),this.flushStats=this.flushStats.bind(this),this.close=this.close.bind(this),this._checkData=this._checkData.bind(this),this._check=this._check.bind(this),this._isInvalidKey=this._isInvalidKey.bind(this),this._wrap=this._wrap.bind(this),this._getValLength=this._getValLength.bind(this),this._error=this._error.bind(this),this._initErrors=this._initErrors.bind(this),this.options=a,this._initErrors(),this.data={},this.options=Object.assign({forceString:!1,objectValueSize:80,promiseValueSize:80,arrayValueSize:40,stdTTL:0,checkperiod:600,useClones:!0,deleteOnExpire:!0,enableLegacyCallbacks:!1,maxKeys:-1},this.options),this.options.enableLegacyCallbacks&&(console.warn("WARNING! node-cache legacy callback support will drop in v6.x"),["get","mget","set","del","ttl","getTtl","keys","has"].forEach(c=>{var u;u=this[c],this[c]=function(...p){var m,d,x,S;if(x=p,[...p]=x,[m]=n.call(p,-1),typeof m=="function")try{S=u(...p),m(null,S)}catch(ce){d=ce,m(d)}else return u(...p,m)}})),this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this.validKeyTypes=["string","number"],this._checkData()}get(a){var c,u;if(s(this,o),(u=this._isInvalidKey(a))!=null)throw u;if(this.data[a]!=null&&this._check(a,this.data[a]))return this.stats.hits++,c=this._unwrap(this.data[a]),c;this.stats.misses++}mget(a){var c,u,p,m,d,x;if(s(this,o),!Array.isArray(a))throw c=this._error("EKEYSTYPE"),c;for(x={},p=0,d=a.length;p<d;p++){if(m=a[p],(u=this._isInvalidKey(m))!=null)throw u;this.data[m]!=null&&this._check(m,this.data[m])?(this.stats.hits++,x[m]=this._unwrap(this.data[m])):this.stats.misses++}return x}set(a,c,u){var p,m,d;if(s(this,o),this.options.maxKeys>-1&&this.stats.keys>=this.options.maxKeys)throw p=this._error("ECACHEFULL"),p;if(this.options.forceString&&!1==="string"&&(c=JSON.stringify(c)),u==null&&(u=this.options.stdTTL),(m=this._isInvalidKey(a))!=null)throw m;return d=!1,this.data[a]&&(d=!0,this.stats.vsize-=this._getValLength(this._unwrap(this.data[a],!1))),this.data[a]=this._wrap(c,u),this.stats.vsize+=this._getValLength(c),d||(this.stats.ksize+=this._getKeyLength(a),this.stats.keys++),this.emit("set",a,c),!0}mset(a){var c,u,p,m,d,x,S,ce,Q,F;if(s(this,o),this.options.maxKeys>-1&&this.stats.keys+a.length>=this.options.maxKeys)throw c=this._error("ECACHEFULL"),c;for(p=0,S=a.length;p<S;p++){if(x=a[p],{key:d,val:F,ttl:Q}=x,Q&&typeof Q!="number")throw c=this._error("ETTLTYPE"),c;if((u=this._isInvalidKey(d))!=null)throw u}for(m=0,ce=a.length;m<ce;m++)x=a[m],{key:d,val:F,ttl:Q}=x,this.set(d,F,Q);return!0}del(a){var c,u,p,m,d,x;for(s(this,o),Array.isArray(a)||(a=[a]),c=0,p=0,d=a.length;p<d;p++){if(m=a[p],(u=this._isInvalidKey(m))!=null)throw u;this.data[m]!=null&&(this.stats.vsize-=this._getValLength(this._unwrap(this.data[m],!1)),this.stats.ksize-=this._getKeyLength(m),this.stats.keys--,c++,x=this.data[m],delete this.data[m],this.emit("del",m,x.v))}return c}take(a){var c;return s(this,o),c=this.get(a),c!=null&&this.del(a),c}ttl(a,c){var u;if(s(this,o),c||(c=this.options.stdTTL),!a)return!1;if((u=this._isInvalidKey(a))!=null)throw u;return this.data[a]!=null&&this._check(a,this.data[a])?(c>=0?this.data[a]=this._wrap(this.data[a].v,c,!1):this.del(a),!0):!1}getTtl(a){var c,u;if(s(this,o),!!a){if((u=this._isInvalidKey(a))!=null)throw u;if(this.data[a]!=null&&this._check(a,this.data[a]))return c=this.data[a].t,c}}keys(){var a;return s(this,o),a=Object.keys(this.data),a}has(a){var c;return s(this,o),c=this.data[a]!=null&&this._check(a,this.data[a]),c}getStats(){return s(this,o),this.stats}flushAll(a=!0){s(this,o),this.data={},this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this._killCheckPeriod(),this._checkData(a),this.emit("flush")}flushStats(){s(this,o),this.stats={hits:0,misses:0,keys:0,ksize:0,vsize:0},this.emit("flush_stats")}close(){s(this,o),this._killCheckPeriod()}_checkData(a=!0){var c,u,p;s(this,o),u=this.data;for(c in u)p=u[c],this._check(c,p);a&&this.options.checkperiod>0&&(this.checkTimeout=setTimeout(this._checkData,this.options.checkperiod*1e3,a),this.checkTimeout!=null&&this.checkTimeout.unref!=null&&this.checkTimeout.unref())}_killCheckPeriod(){if(this.checkTimeout!=null)return clearTimeout(this.checkTimeout)}_check(a,c){var u;return s(this,o),u=!0,c.t!==0&&c.t<Date.now()&&(this.options.deleteOnExpire&&(u=!1,this.del(a)),this.emit("expired",a,this._unwrap(c))),u}_isInvalidKey(a){var c;if(s(this,o),c=typeof a,i.call(this.validKeyTypes,c)<0)return this._error("EKEYTYPE",{type:typeof a})}_wrap(a,c,u=!0){var p,m,d,x;return s(this,o),this.options.useClones||(u=!1),m=Date.now(),p=0,x=1e3,c===0?p=0:c?p=m+c*x:this.options.stdTTL===0?p=this.options.stdTTL:p=m+this.options.stdTTL*x,d={t:p,v:u?r(a):a}}_unwrap(a,c=!0){return this.options.useClones||(c=!1),a.v!=null?c?r(a.v):a.v:null}_getKeyLength(a){return a.toString().length}_getValLength(a){return s(this,o),typeof a=="string"?a.length:this.options.forceString?JSON.stringify(a).length:Array.isArray(a)?this.options.arrayValueSize*a.length:typeof a=="number"?8:typeof a?.then=="function"?this.options.promiseValueSize:typeof Buffer<"u"&&Buffer!==null&&Buffer.isBuffer(a)?a.length:a!=null&&typeof a=="object"?this.options.objectValueSize*Object.keys(a).length:typeof a=="boolean"?8:0}_error(a,c={}){var u;return s(this,o),u=new Error,u.name=a,u.errorcode=a,u.message=this.ERRORS[a]!=null?this.ERRORS[a](c):"-",u.data=c,u}_initErrors(){var a,c,u;s(this,o),this.ERRORS={},u=this._ERRORS;for(c in u)a=u[c],this.ERRORS[c]=this.createErrorMessage(a)}createErrorMessage(a){return function(c){return a.replace("__key",c.type)}}}return o.prototype._ERRORS={ENOTFOUND:"Key `__key` not found",ECACHEFULL:"Cache max keys amount exceeded",EKEYTYPE:"The key argument has to be of type `string` or `number`. Found: `__key`",EKEYSTYPE:"The keys argument has to be an array.",ETTLTYPE:"The ttl argument has to be a number."},o}.call(this)}).call(Rn)});var br=y((In,xn)=>{(function(){var t;t=xn.exports=vn(),t.version="5.1.2"}).call(In)});var et=y((qu,Ln)=>{var Lo="2.0.0",Po=Number.MAX_SAFE_INTEGER||9007199254740991,To=16,wo=250,Oo=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Ln.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:To,MAX_SAFE_BUILD_LENGTH:wo,MAX_SAFE_INTEGER:Po,RELEASE_TYPES:Oo,SEMVER_SPEC_VERSION:Lo,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var tt=y((Mu,Pn)=>{var So=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Pn.exports=So});var we=y((ue,Tn)=>{var{MAX_SAFE_COMPONENT_LENGTH:vr,MAX_SAFE_BUILD_LENGTH:Do,MAX_LENGTH:_o}=et(),No=tt();ue=Tn.exports={};var Co=ue.re=[],ko=ue.safeRe=[],h=ue.src=[],g=ue.t={},Ao=0,Ir="[a-zA-Z0-9-]",$o=[["\\s",1],["\\d",_o],[Ir,Do]],Vo=t=>{for(let[e,r]of $o)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},v=(t,e,r)=>{let n=Vo(e),s=Ao++;No(t,s,e),g[t]=s,h[s]=e,Co[s]=new RegExp(e,r?"g":void 0),ko[s]=new RegExp(n,r?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Ir}*`);v("MAINVERSION",`(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})\\.(${h[g.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})\\.(${h[g.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${h[g.NUMERICIDENTIFIER]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${h[g.NUMERICIDENTIFIERLOOSE]}|${h[g.NONNUMERICIDENTIFIER]})`);v("PRERELEASE",`(?:-(${h[g.PRERELEASEIDENTIFIER]}(?:\\.${h[g.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${h[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[g.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${Ir}+`);v("BUILD",`(?:\\+(${h[g.BUILDIDENTIFIER]}(?:\\.${h[g.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${h[g.MAINVERSION]}${h[g.PRERELEASE]}?${h[g.BUILD]}?`);v("FULL",`^${h[g.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${h[g.MAINVERSIONLOOSE]}${h[g.PRERELEASELOOSE]}?${h[g.BUILD]}?`);v("LOOSE",`^${h[g.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${h[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${h[g.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:\\.(${h[g.XRANGEIDENTIFIER]})(?:${h[g.PRERELEASE]})?${h[g.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[g.XRANGEIDENTIFIERLOOSE]})(?:${h[g.PRERELEASELOOSE]})?${h[g.BUILD]}?)?)?`);v("XRANGE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${h[g.GTLT]}\\s*${h[g.XRANGEPLAINLOOSE]}$`);v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${vr}})(?:\\.(\\d{1,${vr}}))?(?:\\.(\\d{1,${vr}}))?`);v("COERCE",`${h[g.COERCEPLAIN]}(?:$|[^\\d])`);v("COERCEFULL",h[g.COERCEPLAIN]+`(?:${h[g.PRERELEASE]})?(?:${h[g.BUILD]})?(?:$|[^\\d])`);v("COERCERTL",h[g.COERCE],!0);v("COERCERTLFULL",h[g.COERCEFULL],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${h[g.LONETILDE]}\\s+`,!0);ue.tildeTrimReplace="$1~";v("TILDE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${h[g.LONETILDE]}${h[g.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${h[g.LONECARET]}\\s+`,!0);ue.caretTrimReplace="$1^";v("CARET",`^${h[g.LONECARET]}${h[g.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${h[g.LONECARET]}${h[g.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${h[g.GTLT]}\\s*(${h[g.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${h[g.GTLT]}\\s*(${h[g.LOOSEPLAIN]}|${h[g.XRANGEPLAIN]})`,!0);ue.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${h[g.XRANGEPLAIN]})\\s+-\\s+(${h[g.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${h[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[g.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var It=y((Hu,wn)=>{var Uo=Object.freeze({loose:!0}),Fo=Object.freeze({}),qo=t=>t?typeof t!="object"?Uo:t:Fo;wn.exports=qo});var xr=y((Bu,Dn)=>{var On=/^[0-9]+$/,Sn=(t,e)=>{let r=On.test(t),n=On.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},Mo=(t,e)=>Sn(e,t);Dn.exports={compareIdentifiers:Sn,rcompareIdentifiers:Mo}});var k=y((Gu,kn)=>{var xt=tt(),{MAX_LENGTH:_n,MAX_SAFE_INTEGER:Lt}=et(),{safeRe:Nn,t:Cn}=we(),Ho=It(),{compareIdentifiers:Oe}=xr(),Lr=class t{constructor(e,r){if(r=Ho(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>_n)throw new TypeError(`version is longer than ${_n} characters`);xt("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Nn[Cn.LOOSE]:Nn[Cn.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Lt||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Lt||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Lt||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Lt)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(xt("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Oe(this.major,e.major)||Oe(this.minor,e.minor)||Oe(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],s=e.prerelease[r];if(xt("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Oe(n,s)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],s=e.build[r];if(xt("build compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Oe(n,s)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let i=[r,s];n===!1&&(i=[r]),Oe(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};kn.exports=Lr});var he=y((Wu,$n)=>{var An=k(),Bo=(t,e,r=!1)=>{if(t instanceof An)return t;try{return new An(t,e)}catch(n){if(!r)return null;throw n}};$n.exports=Bo});var Un=y((ju,Vn)=>{var Go=he(),Wo=(t,e)=>{let r=Go(t,e);return r?r.version:null};Vn.exports=Wo});var qn=y((Ku,Fn)=>{var jo=he(),Ko=(t,e)=>{let r=jo(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};Fn.exports=Ko});var Bn=y((Xu,Hn)=>{var Mn=k(),Xo=(t,e,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new Mn(t instanceof Mn?t.version:t,r).inc(e,n,s).version}catch{return null}};Hn.exports=Xo});var jn=y((Yu,Wn)=>{var Gn=he(),Yo=(t,e)=>{let r=Gn(t,null,!0),n=Gn(e,null,!0),s=r.compare(n);if(s===0)return null;let i=s>0,o=i?r:n,l=i?n:r,a=!!o.prerelease.length;if(!!l.prerelease.length&&!a)return!l.patch&&!l.minor?"major":o.patch?"patch":o.minor?"minor":"major";let u=a?"pre":"";return r.major!==n.major?u+"major":r.minor!==n.minor?u+"minor":r.patch!==n.patch?u+"patch":"prerelease"};Wn.exports=Yo});var Xn=y((Ju,Kn)=>{var Jo=k(),zo=(t,e)=>new Jo(t,e).major;Kn.exports=zo});var Jn=y((zu,Yn)=>{var Qo=k(),Zo=(t,e)=>new Qo(t,e).minor;Yn.exports=Zo});var Qn=y((Qu,zn)=>{var ea=k(),ta=(t,e)=>new ea(t,e).patch;zn.exports=ta});var es=y((Zu,Zn)=>{var ra=he(),na=(t,e)=>{let r=ra(t,e);return r&&r.prerelease.length?r.prerelease:null};Zn.exports=na});var X=y((ep,rs)=>{var ts=k(),sa=(t,e,r)=>new ts(t,r).compare(new ts(e,r));rs.exports=sa});var ss=y((tp,ns)=>{var ia=X(),oa=(t,e,r)=>ia(e,t,r);ns.exports=oa});var os=y((rp,is)=>{var aa=X(),ca=(t,e)=>aa(t,e,!0);is.exports=ca});var Pt=y((np,cs)=>{var as=k(),la=(t,e,r)=>{let n=new as(t,r),s=new as(e,r);return n.compare(s)||n.compareBuild(s)};cs.exports=la});var us=y((sp,ls)=>{var ua=Pt(),pa=(t,e)=>t.sort((r,n)=>ua(r,n,e));ls.exports=pa});var fs=y((ip,ps)=>{var fa=Pt(),ma=(t,e)=>t.sort((r,n)=>fa(n,r,e));ps.exports=ma});var rt=y((op,ms)=>{var da=X(),ha=(t,e,r)=>da(t,e,r)>0;ms.exports=ha});var Tt=y((ap,ds)=>{var ga=X(),Ea=(t,e,r)=>ga(t,e,r)<0;ds.exports=Ea});var Pr=y((cp,hs)=>{var ya=X(),Ra=(t,e,r)=>ya(t,e,r)===0;hs.exports=Ra});var Tr=y((lp,gs)=>{var ba=X(),va=(t,e,r)=>ba(t,e,r)!==0;gs.exports=va});var wt=y((up,Es)=>{var Ia=X(),xa=(t,e,r)=>Ia(t,e,r)>=0;Es.exports=xa});var Ot=y((pp,ys)=>{var La=X(),Pa=(t,e,r)=>La(t,e,r)<=0;ys.exports=Pa});var wr=y((fp,Rs)=>{var Ta=Pr(),wa=Tr(),Oa=rt(),Sa=wt(),Da=Tt(),_a=Ot(),Na=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return Ta(t,r,n);case"!=":return wa(t,r,n);case">":return Oa(t,r,n);case">=":return Sa(t,r,n);case"<":return Da(t,r,n);case"<=":return _a(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Rs.exports=Na});var vs=y((mp,bs)=>{var Ca=k(),ka=he(),{safeRe:St,t:Dt}=we(),Aa=(t,e)=>{if(t instanceof Ca)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(e.includePrerelease?St[Dt.COERCEFULL]:St[Dt.COERCE]);else{let a=e.includePrerelease?St[Dt.COERCERTLFULL]:St[Dt.COERCERTL],c;for(;(c=a.exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||c.index+c[0].length!==r.index+r[0].length)&&(r=c),a.lastIndex=c.index+c[1].length+c[2].length;a.lastIndex=-1}if(r===null)return null;let n=r[2],s=r[3]||"0",i=r[4]||"0",o=e.includePrerelease&&r[5]?`-${r[5]}`:"",l=e.includePrerelease&&r[6]?`+${r[6]}`:"";return ka(`${n}.${s}.${i}${o}${l}`,e)};bs.exports=Aa});var xs=y((dp,Is)=>{var Or=class{constructor(){this.max=1e3,this.map=new Map}get(e){let r=this.map.get(e);if(r!==void 0)return this.map.delete(e),this.map.set(e,r),r}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&r!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,r)}return this}};Is.exports=Or});var Y=y((hp,ws)=>{var $a=/\s+/g,Sr=class t{constructor(e,r){if(r=Ua(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof Dr)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().replace($a," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!Ps(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&Wa(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let r=this.set[e];for(let n=0;n<r.length;n++)n>0&&(this.formatted+=" "),this.formatted+=r[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Ba)|(this.options.loose&&Ga))+":"+e,s=Ls.get(n);if(s)return s;let i=this.options.loose,o=i?M[$.HYPHENRANGELOOSE]:M[$.HYPHENRANGE];e=e.replace(o,tc(this.options.includePrerelease)),w("hyphen replace",e),e=e.replace(M[$.COMPARATORTRIM],qa),w("comparator trim",e),e=e.replace(M[$.TILDETRIM],Ma),w("tilde trim",e),e=e.replace(M[$.CARETTRIM],Ha),w("caret trim",e);let l=e.split(" ").map(p=>ja(p,this.options)).join(" ").split(/\s+/).map(p=>ec(p,this.options));i&&(l=l.filter(p=>(w("loose invalid filter",p,this.options),!!p.match(M[$.COMPARATORLOOSE])))),w("range list",l);let a=new Map,c=l.map(p=>new Dr(p,this.options));for(let p of c){if(Ps(p))return[p];a.set(p.value,p)}a.size>1&&a.has("")&&a.delete("");let u=[...a.values()];return Ls.set(n,u),u}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Ts(n,r)&&e.set.some(s=>Ts(s,r)&&n.every(i=>s.every(o=>i.intersects(o,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Fa(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(rc(this.set[r],e,this.options))return!0;return!1}};ws.exports=Sr;var Va=xs(),Ls=new Va,Ua=It(),Dr=nt(),w=tt(),Fa=k(),{safeRe:M,t:$,comparatorTrimReplace:qa,tildeTrimReplace:Ma,caretTrimReplace:Ha}=we(),{FLAG_INCLUDE_PRERELEASE:Ba,FLAG_LOOSE:Ga}=et(),Ps=t=>t.value==="<0.0.0-0",Wa=t=>t.value==="",Ts=(t,e)=>{let r=!0,n=t.slice(),s=n.pop();for(;r&&n.length;)r=n.every(i=>s.intersects(i,e)),s=n.pop();return r},ja=(t,e)=>(w("comp",t,e),t=Ya(t,e),w("caret",t),t=Ka(t,e),w("tildes",t),t=za(t,e),w("xrange",t),t=Za(t,e),w("stars",t),t),V=t=>!t||t.toLowerCase()==="x"||t==="*",Ka=(t,e)=>t.trim().split(/\s+/).map(r=>Xa(r,e)).join(" "),Xa=(t,e)=>{let r=e.loose?M[$.TILDELOOSE]:M[$.TILDE];return t.replace(r,(n,s,i,o,l)=>{w("tilde",t,n,s,i,o,l);let a;return V(s)?a="":V(i)?a=`>=${s}.0.0 <${+s+1}.0.0-0`:V(o)?a=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:l?(w("replaceTilde pr",l),a=`>=${s}.${i}.${o}-${l} <${s}.${+i+1}.0-0`):a=`>=${s}.${i}.${o} <${s}.${+i+1}.0-0`,w("tilde return",a),a})},Ya=(t,e)=>t.trim().split(/\s+/).map(r=>Ja(r,e)).join(" "),Ja=(t,e)=>{w("caret",t,e);let r=e.loose?M[$.CARETLOOSE]:M[$.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(s,i,o,l,a)=>{w("caret",t,s,i,o,l,a);let c;return V(i)?c="":V(o)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:V(l)?i==="0"?c=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${n} <${+i+1}.0.0-0`:a?(w("replaceCaret pr",a),i==="0"?o==="0"?c=`>=${i}.${o}.${l}-${a} <${i}.${o}.${+l+1}-0`:c=`>=${i}.${o}.${l}-${a} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${l}-${a} <${+i+1}.0.0-0`):(w("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${l}${n} <${i}.${o}.${+l+1}-0`:c=`>=${i}.${o}.${l}${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${l} <${+i+1}.0.0-0`),w("caret return",c),c})},za=(t,e)=>(w("replaceXRanges",t,e),t.split(/\s+/).map(r=>Qa(r,e)).join(" ")),Qa=(t,e)=>{t=t.trim();let r=e.loose?M[$.XRANGELOOSE]:M[$.XRANGE];return t.replace(r,(n,s,i,o,l,a)=>{w("xRange",t,n,s,i,o,l,a);let c=V(i),u=c||V(o),p=u||V(l),m=p;return s==="="&&m&&(s=""),a=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&m?(u&&(o=0),l=0,s===">"?(s=">=",u?(i=+i+1,o=0,l=0):(o=+o+1,l=0)):s==="<="&&(s="<",u?i=+i+1:o=+o+1),s==="<"&&(a="-0"),n=`${s+i}.${o}.${l}${a}`):u?n=`>=${i}.0.0${a} <${+i+1}.0.0-0`:p&&(n=`>=${i}.${o}.0${a} <${i}.${+o+1}.0-0`),w("xRange return",n),n})},Za=(t,e)=>(w("replaceStars",t,e),t.trim().replace(M[$.STAR],"")),ec=(t,e)=>(w("replaceGTE0",t,e),t.trim().replace(M[e.includePrerelease?$.GTE0PRE:$.GTE0],"")),tc=t=>(e,r,n,s,i,o,l,a,c,u,p,m)=>(V(n)?r="":V(s)?r=`>=${n}.0.0${t?"-0":""}`:V(i)?r=`>=${n}.${s}.0${t?"-0":""}`:o?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,V(c)?a="":V(u)?a=`<${+c+1}.0.0-0`:V(p)?a=`<${c}.${+u+1}.0-0`:m?a=`<=${c}.${u}.${p}-${m}`:t?a=`<${c}.${u}.${+p+1}-0`:a=`<=${a}`,`${r} ${a}`.trim()),rc=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(w(t[n].semver),t[n].semver!==Dr.ANY&&t[n].semver.prerelease.length>0){let s=t[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var nt=y((gp,Cs)=>{var st=Symbol("SemVer ANY"),Cr=class t{static get ANY(){return st}constructor(e,r){if(r=Os(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Nr("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===st?this.value="":this.value=this.operator+this.semver.version,Nr("comp",this)}parse(e){let r=this.options.loose?Ss[Ds.COMPARATORLOOSE]:Ss[Ds.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new _s(n[2],this.options.loose):this.semver=st}toString(){return this.value}test(e){if(Nr("Comparator.test",e,this.options.loose),this.semver===st||e===st)return!0;if(typeof e=="string")try{e=new _s(e,this.options)}catch{return!1}return _r(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Ns(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Ns(this.value,r).test(e.semver):(r=Os(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||_r(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||_r(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Cs.exports=Cr;var Os=It(),{safeRe:Ss,t:Ds}=we(),_r=wr(),Nr=tt(),_s=k(),Ns=Y()});var it=y((Ep,ks)=>{var nc=Y(),sc=(t,e,r)=>{try{e=new nc(e,r)}catch{return!1}return e.test(t)};ks.exports=sc});var $s=y((yp,As)=>{var ic=Y(),oc=(t,e)=>new ic(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));As.exports=oc});var Us=y((Rp,Vs)=>{var ac=k(),cc=Y(),lc=(t,e,r)=>{let n=null,s=null,i=null;try{i=new cc(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===-1)&&(n=o,s=new ac(n,r))}),n};Vs.exports=lc});var qs=y((bp,Fs)=>{var uc=k(),pc=Y(),fc=(t,e,r)=>{let n=null,s=null,i=null;try{i=new pc(e,r)}catch{return null}return t.forEach(o=>{i.test(o)&&(!n||s.compare(o)===1)&&(n=o,s=new uc(n,r))}),n};Fs.exports=fc});var Bs=y((vp,Hs)=>{var kr=k(),mc=Y(),Ms=rt(),dc=(t,e)=>{t=new mc(t,e);let r=new kr("0.0.0");if(t.test(r)||(r=new kr("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let s=t.set[n],i=null;s.forEach(o=>{let l=new kr(o.semver.version);switch(o.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!i||Ms(l,i))&&(i=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!r||Ms(r,i))&&(r=i)}return r&&t.test(r)?r:null};Hs.exports=dc});var Ws=y((Ip,Gs)=>{var hc=Y(),gc=(t,e)=>{try{return new hc(t,e).range||"*"}catch{return null}};Gs.exports=gc});var _t=y((xp,Ys)=>{var Ec=k(),Xs=nt(),{ANY:yc}=Xs,Rc=Y(),bc=it(),js=rt(),Ks=Tt(),vc=Ot(),Ic=wt(),xc=(t,e,r,n)=>{t=new Ec(t,n),e=new Rc(e,n);let s,i,o,l,a;switch(r){case">":s=js,i=vc,o=Ks,l=">",a=">=";break;case"<":s=Ks,i=Ic,o=js,l="<",a="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(bc(t,e,n))return!1;for(let c=0;c<e.set.length;++c){let u=e.set[c],p=null,m=null;if(u.forEach(d=>{d.semver===yc&&(d=new Xs(">=0.0.0")),p=p||d,m=m||d,s(d.semver,p.semver,n)?p=d:o(d.semver,m.semver,n)&&(m=d)}),p.operator===l||p.operator===a||(!m.operator||m.operator===l)&&i(t,m.semver))return!1;if(m.operator===a&&o(t,m.semver))return!1}return!0};Ys.exports=xc});var zs=y((Lp,Js)=>{var Lc=_t(),Pc=(t,e,r)=>Lc(t,e,">",r);Js.exports=Pc});var Zs=y((Pp,Qs)=>{var Tc=_t(),wc=(t,e,r)=>Tc(t,e,"<",r);Qs.exports=wc});var ri=y((Tp,ti)=>{var ei=Y(),Oc=(t,e,r)=>(t=new ei(t,r),e=new ei(e,r),t.intersects(e,r));ti.exports=Oc});var si=y((wp,ni)=>{var Sc=it(),Dc=X();ni.exports=(t,e,r)=>{let n=[],s=null,i=null,o=t.sort((u,p)=>Dc(u,p,r));for(let u of o)Sc(u,e,r)?(i=u,s||(s=u)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let l=[];for(let[u,p]of n)u===p?l.push(u):!p&&u===o[0]?l.push("*"):p?u===o[0]?l.push(`<=${p}`):l.push(`${u} - ${p}`):l.push(`>=${u}`);let a=l.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return a.length<c.length?a:e}});var ui=y((Op,li)=>{var ii=Y(),$r=nt(),{ANY:Ar}=$r,ot=it(),Vr=X(),_c=(t,e,r={})=>{if(t===e)return!0;t=new ii(t,r),e=new ii(e,r);let n=!1;e:for(let s of t.set){for(let i of e.set){let o=Cc(s,i,r);if(n=n||o!==null,o)continue e}if(n)return!1}return!0},Nc=[new $r(">=0.0.0-0")],oi=[new $r(">=0.0.0")],Cc=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Ar){if(e.length===1&&e[0].semver===Ar)return!0;r.includePrerelease?t=Nc:t=oi}if(e.length===1&&e[0].semver===Ar){if(r.includePrerelease)return!0;e=oi}let n=new Set,s,i;for(let d of t)d.operator===">"||d.operator===">="?s=ai(s,d,r):d.operator==="<"||d.operator==="<="?i=ci(i,d,r):n.add(d.semver);if(n.size>1)return null;let o;if(s&&i){if(o=Vr(s.semver,i.semver,r),o>0)return null;if(o===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let d of n){if(s&&!ot(d,String(s),r)||i&&!ot(d,String(i),r))return null;for(let x of e)if(!ot(d,String(x),r))return!1;return!0}let l,a,c,u,p=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;p&&p.prerelease.length===1&&i.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let d of e){if(u=u||d.operator===">"||d.operator===">=",c=c||d.operator==="<"||d.operator==="<=",s){if(m&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===m.major&&d.semver.minor===m.minor&&d.semver.patch===m.patch&&(m=!1),d.operator===">"||d.operator===">="){if(l=ai(s,d,r),l===d&&l!==s)return!1}else if(s.operator===">="&&!ot(s.semver,String(d),r))return!1}if(i){if(p&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===p.major&&d.semver.minor===p.minor&&d.semver.patch===p.patch&&(p=!1),d.operator==="<"||d.operator==="<="){if(a=ci(i,d,r),a===d&&a!==i)return!1}else if(i.operator==="<="&&!ot(i.semver,String(d),r))return!1}if(!d.operator&&(i||s)&&o!==0)return!1}return!(s&&c&&!i&&o!==0||i&&u&&!s&&o!==0||m||p)},ai=(t,e,r)=>{if(!t)return e;let n=Vr(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},ci=(t,e,r)=>{if(!t)return e;let n=Vr(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};li.exports=_c});var at=y((Sp,mi)=>{var Ur=we(),pi=et(),kc=k(),fi=xr(),Ac=he(),$c=Un(),Vc=qn(),Uc=Bn(),Fc=jn(),qc=Xn(),Mc=Jn(),Hc=Qn(),Bc=es(),Gc=X(),Wc=ss(),jc=os(),Kc=Pt(),Xc=us(),Yc=fs(),Jc=rt(),zc=Tt(),Qc=Pr(),Zc=Tr(),el=wt(),tl=Ot(),rl=wr(),nl=vs(),sl=nt(),il=Y(),ol=it(),al=$s(),cl=Us(),ll=qs(),ul=Bs(),pl=Ws(),fl=_t(),ml=zs(),dl=Zs(),hl=ri(),gl=si(),El=ui();mi.exports={parse:Ac,valid:$c,clean:Vc,inc:Uc,diff:Fc,major:qc,minor:Mc,patch:Hc,prerelease:Bc,compare:Gc,rcompare:Wc,compareLoose:jc,compareBuild:Kc,sort:Xc,rsort:Yc,gt:Jc,lt:zc,eq:Qc,neq:Zc,gte:el,lte:tl,cmp:rl,coerce:nl,Comparator:sl,Range:il,satisfies:ol,toComparators:al,maxSatisfying:cl,minSatisfying:ll,minVersion:ul,validRange:pl,outside:fl,gtr:ml,ltr:dl,intersects:hl,simplifyRange:gl,subset:El,SemVer:kc,re:Ur.re,src:Ur.src,tokens:Ur.t,SEMVER_SPEC_VERSION:pi.SEMVER_SPEC_VERSION,RELEASE_TYPES:pi.RELEASE_TYPES,compareIdentifiers:fi.compareIdentifiers,rcompareIdentifiers:fi.rcompareIdentifiers}});var yu={};yo(yu,{Logger:()=>I,activate:()=>hu,deactivate:()=>gu});module.exports=Ro(yu);var U=require("vscode");var Ne=require("vscode");var D={inProgress:!1,updateAllData:[]};var dr=require("vscode"),G="dependi.";var Pe=(n=>(n[n.Exclude=0]="Exclude",n[n.IncludeAlways=1]="IncludeAlways",n[n.IncludeIfUnstable=2]="IncludeIfUnstable",n))(Pe||{}),P=(E=>(E.RUST_ENABLED="rust.enabled",E.RUST_INDEX_SERVER_URL="rust.indexServerURL",E.RUST_UNSTABLE_FILTER="rust.unstableFilter",E.RUST_IGNORE_LINE_PATTERN="rust.ignoreLinePattern",E.RUST_INFORM_PATCH_UPDATES="rust.informPatchUpdates",E.RUST_ENABLED_LOCK_FILE="rust.lockFileEnabled",E.RUST_SILENCE_VERSION_OVERFLOWS="rust.silenceVersionOverflows",E.NPM_ENABLED="npm.enabled",E.NPM_INDEX_SERVER_URL="npm.indexServerURL",E.NPM_UNSTABLE_FILTER="npm.unstableFilter",E.NPM_IGNORE_LINE_PATTERN="npm.ignoreLinePattern",E.NPM_INFORM_PATCH_UPDATES="npm.informPatchUpdates",E.NPM_ENABLED_LOCK_FILE="npm.lockFileEnabled",E.NPM_SILENCE_VERSION_OVERFLOWS="npm.silenceVersionOverflows",E.PHP_ENABLED="php.enabled",E.PHP_INDEX_SERVER_URL="php.indexServerURL",E.PHP_UNSTABLE_FILTER="php.unstableFilter",E.PHP_IGNORE_LINE_PATTERN="php.ignoreLinePattern",E.PHP_INFORM_PATCH_UPDATES="php.informPatchUpdates",E.PHP_ENABLED_LOCK_FILE="php.lockFileEnabled",E.PHP_SILENCE_VERSION_OVERFLOWS="php.silenceVersionOverflows",E.GO_ENABLED="go.enabled",E.GO_INDEX_SERVER_URL="go.indexServerURL",E.GO_UNSTABLE_FILTER="go.unstableFilter",E.GO_IGNORE_LINE_PATTERN="go.ignoreLinePattern",E.GO_INFORM_PATCH_UPDATES="go.informPatchUpdates",E.GO_SILENCE_VERSION_OVERFLOWS="go.silenceVersionOverflows",E.PYTHON_ENABLED="python.enabled",E.PYTHON_INDEX_SERVER_URL="python.indexServerURL",E.PYTHON_UNSTABLE_FILTER="python.unstableFilter",E.PYTHON_IGNORE_LINE_PATTERN="python.ignoreLinePattern",E.PYTHON_INFORM_PATCH_UPDATES="python.informPatchUpdates",E.PYTHON_ENABLED_LOCK_FILE="python.lockFileEnabled",E.PYTHON_SILENCE_VERSION_OVERFLOWS="python.silenceVersionOverflows",E.VULS_ENABLED="vulnerability.enabled",E.VULS_GHSA_ENABLED="vulnerability.ghsa.enabled",E.VULS_OSV_BATCH_URL="vulnerability.osvQueryURL.batch",E.VULS_OSV_URL="vulnerability.osvQueryURL.single",E.INDEX_SERVER_API_KEY="apiKey",E.INDEX_SERVER_URL="apiURL",E.DECORATOR_POSITION="decoration.position",E.ERROR_DECORATOR="decoration.error.template",E.ERROR_DECORATOR_CSS="decoration.error.style",E.INCOMPATIBLE_DECORATOR="decoration.incompatible.template",E.INCOMPATIBLE_DECORATOR_CSS="decoration.incompatible.style",E.PATCH_UPDATE_DECORATOR="decoration.patchUpdate.template",E.PATCH_UPDATE_DECORATOR_CSS="decoration.patchUpdate.style",E.COMPATIBLE_DECORATOR="decoration.compatible.template",E.COMPATIBLE_DECORATOR_CSS="decoration.compatible.style",E.VULNERABILITY_DECORATOR="decoration.vulnerability.template",E.REPLACE_VERSIONS=`${G}commands.replaceVersion`,E.GENERATE_VULNERABILITY_REPORT=`${G}commands.vulnerability.report`,E.GENERATE_VULNERABILITY_CURRENT_REPORT=`${G}commands.vulnerability.currentReport`,E.UPDATE_ALL=`${G}commands.updateAll`,E.RETRY=`${G}commands.retry`,E.ENABLE_LOCK_FILE_PARSING=`${G}commands.enableLockFileParsing`,E.DISABLE_LOCK_FILE_PARSING=`${G}commands.disableLockFileParsing`,E.LOCK_FILE_PARSED=`${G}commands.lockFileParsed`,E.SILENCE_UPDATE_MESSAGES="extras.silenceUpdateMessages",E.DEVICE_ID=`${G}deviceID`,E.SHOWN_VERSION=`${G}shownVersion`,E.RUST_UNSTABLE_OLD="rust.excludeUnstableVersions",E.NPM_UNSTABLE_OLD="npm.excludeUnstableVersions",E.PHP_UNSTABLE_OLD="php.excludeUnstableVersions",E.GO_UNSTABLE_OLD="go.excludeUnstableVersions",E.PYTHON_UNSTABLE_OLD="python.excludeUnstableVersions",E))(P||{}),f={version:"0.0.1",rust:{enabled:!0,index:"",unstableFilter:0,ignoreLinePattern:"",informPatchUpdates:!1,lockFileEnabled:!0,silenceVersionOverflows:!1},npm:{enabled:!0,index:"",unstableFilter:0,ignoreLinePattern:"",informPatchUpdates:!1,lockFileEnabled:!0,silenceVersionOverflows:!1},php:{enabled:!0,index:"",unstableFilter:0,ignoreLinePattern:"",informPatchUpdates:!1,lockFileEnabled:!0,silenceVersionOverflows:!1},go:{enabled:!0,index:"",unstableFilter:0,ignoreLinePattern:"",informPatchUpdates:!0,silenceVersionOverflows:!1},python:{enabled:!0,index:"",unstableFilter:0,ignoreLinePattern:"",informPatchUpdates:!1,lockFileEnabled:!0,silenceVersionOverflows:!1},vulnerability:{enabled:!1,ghsa:!1,osvBatch:"",osvSingle:""},api:{key:"",url:"",proPanelURL:"https://www.dependi.io/pro",deviceID:""},decorator:{position:"",error:{template:"",css:{}},incompatible:{template:"",css:{}},patchUpdate:{template:"",css:{}},compatible:{template:"",css:{}},vulnerability:{template:""}},extras:{silenceUpdateMessages:!1},load:function(){let t=dr.workspace.getConfiguration("dependi");console.log(this.version),this.rust.enabled=t.get("rust.enabled")??!0,this.rust.index=t.get("rust.indexServerURL")||"https://index.crates.io",this.rust.unstableFilter=Ze("rust.unstableFilter","rust.excludeUnstableVersions"),this.rust.ignoreLinePattern=t.get("rust.ignoreLinePattern")||"",this.rust.informPatchUpdates=t.get("rust.informPatchUpdates")??!1,this.rust.lockFileEnabled=t.get("rust.lockFileEnabled")??!0,this.rust.silenceVersionOverflows=t.get("rust.silenceVersionOverflows")??!1,this.npm.enabled=t.get("npm.enabled")??!0,this.npm.index=t.get("npm.indexServerURL")||"https://registry.npmjs.org",this.npm.unstableFilter=Ze("npm.unstableFilter","npm.excludeUnstableVersions"),this.npm.ignoreLinePattern=t.get("npm.ignoreLinePattern")||"",this.npm.informPatchUpdates=t.get("npm.informPatchUpdates")??!1,this.npm.lockFileEnabled=t.get("npm.lockFileEnabled")??!0,this.npm.silenceVersionOverflows=t.get("npm.silenceVersionOverflows")??!1,this.php.enabled=t.get("php.enabled")??!0,this.php.index=t.get("php.indexServerURL")||"https://repo.packagist.org",this.php.unstableFilter=Ze("php.unstableFilter","php.excludeUnstableVersions"),this.php.ignoreLinePattern=t.get("php.ignoreLinePattern")||"",this.php.informPatchUpdates=t.get("php.informPatchUpdates")??!1,this.php.lockFileEnabled=t.get("php.lockFileEnabled")??!0,this.php.silenceVersionOverflows=t.get("php.silenceVersionOverflows")??!1,this.go.enabled=t.get("go.enabled")??!0,this.go.index=t.get("go.indexServerURL")||"https://proxy.golang.org",this.go.unstableFilter=Ze("go.unstableFilter","go.excludeUnstableVersions"),this.go.ignoreLinePattern=t.get("go.ignoreLinePattern")||"",this.go.informPatchUpdates=t.get("go.informPatchUpdates")??!1,this.go.silenceVersionOverflows=t.get("go.silenceVersionOverflows")??!1,this.python.enabled=t.get("python.enabled")??!0,this.python.index=t.get("python.indexServerURL")||"https://pypi.org/pypi",this.python.unstableFilter=Ze("python.unstableFilter","python.excludeUnstableVersions"),this.python.ignoreLinePattern=t.get("python.ignoreLinePattern")||"",this.python.informPatchUpdates=t.get("python.informPatchUpdates")??!1,this.python.lockFileEnabled=t.get("python.lockFileEnabled")??!0,this.python.silenceVersionOverflows=t.get("python.silenceVersionOverflows")??!1,this.vulnerability.enabled=t.get("vulnerability.enabled")??!0,this.vulnerability.ghsa=t.get("vulnerability.ghsa.enabled")??!1,this.vulnerability.osvBatch=t.get("vulnerability.osvQueryURL.batch")||"https://api.osv.dev/v1/querybatch",this.vulnerability.osvSingle=t.get("vulnerability.osvQueryURL.single")||"https://api.osv.dev/v1/query",this.api.key=t.get("apiKey")||"",this.api.url=t.get("apiURL")||"https://index.dependi.io",this.decorator.position=t.get("decoration.position")||"after",this.decorator.error.template=t.get("decoration.error.template")??"\u2757\uFE0F\u2757\uFE0F\u2757\uFE0F",this.decorator.error.css=t.get("decoration.error.style")||{},this.decorator.incompatible.template=t.get("decoration.incompatible.template")??"\u274C ${version}",this.decorator.incompatible.css=t.get("decoration.incompatible.style")||{},this.decorator.patchUpdate.template=t.get("decoration.patchUpdate.template")??"\u26A0\uFE0F ${version}",this.decorator.patchUpdate.css=t.get("decoration.patchUpdate.style")||{},this.decorator.compatible.template=t.get("decoration.compatible.template")??"\u2705",this.decorator.compatible.css=t.get("decoration.compatible.style")||{},this.decorator.vulnerability.template=t.get("decoration.vulnerability.template")??"\u{1F6A8} ${count}",this.extras.silenceUpdateMessages=t.get("extras.silenceUpdateMessages")??!1,console.debug("Settings loaded",this)},onChange:function(t){t.affectsConfiguration("dependi")&&(console.debug("Config changed"),this.load())}};function Ze(t,e){let r=dr.workspace.getConfiguration("dependi"),n=r.get(t);if(f.version>"0.7.9"){let s=r.get(e);if(s!==void 0)return r.update(e,void 0,!0),r.update(t,s?"Exclude":"IncludeAlways",!0),s?0:1}return Pe[n]||0}var Er=O(require("path"));var hr=O(require("os"));function bo(){let t=hr.default.platform(),e=hr.default.release(),r="Unknown OS";switch(t){case"win32":r="Windows",e.startsWith("10")?r+=" 10":e.startsWith("6.3")?r+=" 8.1":e.startsWith("6.2")?r+=" 8":e.startsWith("6.1")&&(r+=" 7");break;case"darwin":r="Mac OS X";let n=e.split(".").slice(0,2).join(".");r+=` ${n}`;break;case"linux":r="Linux";break;default:r=t}return r}function vo(){return`Dependi (https://www.dependi.io) (${f.version}) - ${bo()}`}var gr=vo();function K(t){let e=new URL(t);return{protocol:e.protocol,hostname:e.hostname,port:e.port,path:e.pathname+e.search,headers:{"User-Agent":gr},timeout:1e3}}function te(t){return new Error(`statusCode=${t.statusCode}: ${t.url}`)}function re(t){return!t.statusCode||t.statusCode<200||t.statusCode>=300}function gn(t){return t.statusCode?t.statusCode>=300&&t.statusCode<400:!1}function ne(t,e,r,n){let s=[];return e.on("data",function(i){s.push(i)}),r.on("error",function(i){n(i)}),r.on("timeout",function(){r.destroy(),n(new Error(`Request to ${t} timed out`))}),s}function q(t){let e=t.replace("///","");return e.endsWith("/")&&(e=e.slice(0,-1)),e}async function pe(t,e){try{let r=await fetch(Io(t),{method:"GET",credentials:"include",cache:"default",...e,headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":gr,...e?.headers}}),n,s,i=r.headers.get("Content-Type");if(r.status>0&&r.status<300)if(r.status!==204)try{i&&i.includes("application/json")?s=await r.json():i&&i.includes("text/html")?s=await r.text():i&&i.includes("application/pdf")?s=await r.blob():s=await r.text()}catch{n=await r.text()}else I.appendLine(`${t}:${e?.method||"GET"} ${r.status}-${r.statusText}`);else{if(n=await r.text(),n)try{n=JSON.parse(n),n=n.message||n.error||n}catch(o){I.appendLine(`${t}:${e?.method||"GET"} ${r.status}-${r.statusText}, ${o}, ${n}`)}console.error(t,e?.method||"GET",n,r.status,r.statusText),I.appendLine(`${t}:${e?.method||"GET"} ${r.status}-${r.statusText}, ${n}`)}return{status:r.status,statusText:r.statusText,body:s,headers:r.headers,error:n,isLoading:!1}}catch(r){return console.error(t,e?.method||"GET",r),I.appendLine(`${t}:${e?.method||"GET"} ${r}`),{status:0,statusText:"",body:void 0,headers:void 0,error:r.message||r+"",isLoading:!1}}}function Io(t){return q(`${f.api.url}/${t}`)}async function En(t){t.DeviceID=f.api.deviceID,t.FileName=t.FileName.toLowerCase();let e=await pe("v1/public/telemetries",{method:"POST",headers:{"X-Device-ID":f.api.deviceID,"Content-Type":"application/json"},body:JSON.stringify(t)});return e.error&&I.appendLine(`Error sending telemetry: ${e.error}`),e}var Te=require("vscode");var R=0,yr="",Rr="crates.io";function bt(t){if(!t){R=0;return}let e=Er.default.basename(t),r=Er.default.extname(e);switch(e.toLowerCase()){case"cargo.toml":return de(1,"rust",e,"crates.io",f.rust.lockFileEnabled);case"go.mod":return de(2,"go",e,"Go");case"package.json":return de(3,"npm",e,"npm",f.npm.lockFileEnabled);case"composer.json":return de(5,"php",e,"Packagist",f.php.lockFileEnabled);case"pyproject.toml":return de(4,"python",e,"PyPI",f.python.lockFileEnabled);case"pixi.toml":return de(4,"python",e,"PyPI",f.python.lockFileEnabled);default:if(r===".txt"&&e.toLowerCase().startsWith("requirement"))return de(4,"python",e,"PyPI",f.python.lockFileEnabled)}}function de(t,e,r,n,s){return R=t,yr=e,Rr=n,Te.commands.executeCommand("setContext","dependi.supportedFiles",[r]),Te.env.isTelemetryEnabled&&En({FileName:r}),s!==void 0&&(Te.commands.executeCommand("setContext","dependi.hasLockFile",!1),Te.commands.executeCommand("setContext","dependi.isEnableLockParsing",s)),t}var yi=O(br());var ct=require("vscode"),hi=O(at());var W=O(at());function di(t="0.0.0",e,r){let n=Fr(t),s=e.map(Fr),i=yl(e,s);n=Rl(n);let o=s[0];if(r){let u=bl(r,n,s);if(u)return u}if(xl()&&o){let u=(0,W.minVersion)(n)?.toString()??"0.0.0";if((0,W.gt)(u,o))return[!0,!1,t]}let l=!1;switch(R){case 1:l=f.rust.informPatchUpdates;break;case 3:l=f.npm.informPatchUpdates;break;case 5:l=f.php.informPatchUpdates;break;case 2:l=f.go.informPatchUpdates;break;case 4:l=f.python.informPatchUpdates;break}let a=l?(0,W.compare)(o,(0,W.minVersion)(n)??"0.0.0")===1:!1,c=(0,W.maxSatisfying)(s,n);return c&&R===4?[(0,W.satisfies)(o,n),a,i[c]]:[(0,W.satisfies)(o,n),a,c]}function yl(t,e){return R!==4?{}:t.reduce((r,n,s)=>(r[e[s]]=n,r),{})}function Rl(t){let e=t.charCodeAt(0);return e>47&&e<58?`^${t}`:t}function bl(t,e,r){let n=Fr(t);return(0,W.satisfies)(n,e,{includePrerelease:!0})?[n===r[0],!1,t]:[!1,!1,t]}function Fr(t){return R===4?qr(t):vl(t)}function vl(t){let e=0;for(let r=0;r<t.length;r++)if(t[r]==="."&&(e++,e>1))return t;if(t.includes(".")){if(t.split(".").length===2)return`${t}.0`}else return`${t}.0.0`;return t}function Il(t){return t.replace(/\.dev(\d+)/,"-dev.$1").replace(/\.post(\d+)/,"-post.$1").replace(/\.a(\d+)/,"-alpha.$1").replace(/\.b(\d+)/,"-beta.$1").replace(/\.rc(\d+)/,"-rc.$1").replace(/a(\d+)/,"-alpha.$1").replace(/b(\d+)/,"-beta.$1").replace(/rc(\d+)/,"-rc.$1").replace(/c(\d+)/,"-c.$1")}function qr(t){let e=Il(t),r=/^(\d+)\.(\d+)(?:\.(\d+))?([-a-zA-Z0-9.]+)?$/,n=e.match(r);if(n){let s=n[1],i=n[2],o=n[3]||0,l=n[4]?`-${n[4].slice(1)}`:"";return`${s}.${i}.${o}${l}`}else return e}function xl(){switch(R){case 1:return f.rust.silenceVersionOverflows;case 3:return f.npm.silenceVersionOverflows;case 5:return f.php.silenceVersionOverflows;case 2:return f.go.silenceVersionOverflows;case 4:return f.python.silenceVersionOverflows}return!1}function Mr(t,e,r,n,s,i,o){let l=e.value?.replace(",",""),[a,c,u]=di(l,r,e.lockedAt),p=b=>{let B=b.split(`
`),L=new ct.MarkdownString("#### Errors ");return L.appendMarkdown(`
`),B.filter(le=>le).forEach(le=>{L.appendMarkdown("* "),L.appendText(le.trim()),L.appendMarkdown(`
`)}),L},m=new ct.MarkdownString,d=n.position,x={[d]:{contentText:""}},S="COMP";if(o)m=p(o),S="ERROR";else{if(Ol(m,i,l),m.appendMarkdown("#### Versions"),m.appendMarkdown(Tl(s,e.key)),m.isTrusted=!0,Sl(m,r,e,u??"",i,n,s),l=="?"){let b=r[0];t.edit(B=>{B.replace(e.range,b.slice(1,b.length-2))}),t.document.save()}(0,hi.validRange)(R===4?qr(l):l)?r[0]!==u&&(S=a?"COMP":"INCOMP"):S="ERROR",c&&S==="COMP"&&(S="PATCH")}let ce=Pl(n,S);x[d].contentText=ce.replace("${version}",r[0]);let Q=i?.get(e.lockedAt??l);if(Q&&Q.length>0){let b=n.vulnText.replace("${count}",`${Q?.length}`);x[d].contentText=x[d].contentText+"	"+b}return Ll(l)&&(x[d].contentText=""),[{range:d=="after"?e.decoRange:new ct.Range(e.line,0,e.line,e.endOfLine),hoverMessage:m,renderOptions:x},S]}function Ll(t){return t?t.startsWith("file:")||t.startsWith("path:")||t.startsWith("link:")||t.startsWith("git:")||t.startsWith("git+")||t.startsWith("github:")||t.startsWith("workspace:")||t.startsWith("ssh:")||t.startsWith("http:")||t.startsWith("https:"):!1}function Pl(t,e){let r=t.compatibleText;switch(e){case"PATCH":r=t.patchUpdateText;break;case"INCOMP":r=t.incompatibleText;break;case"ERROR":r=t.errorText;break}return r}function Tl(t,e){let r=e.replace(/"/g,"");switch(t){case 1:return` _([View crate](https://crates.io/crates/${r}) | [Check reviews](https://web.crev.dev/rust-reviews/crate/${r}))_`;case 2:return` _([View module](https://pkg.go.dev/${r}) | [Check docs](https://pkg.go.dev/${r}#section-documentation))_`;case 3:return` _([View package](https://npmjs.com/package/${r}))_`;case 5:return` _([View package](https://packagist.org/packages/${r}))_`;case 4:return` _([View package](https://pypi.org/project/${r}))_`;default:return""}}function wl(t,e,r){switch(t){case 1:return`[(docs)](https://docs.rs/crate/${e}/${r})`;case 2:return`[(docs)](https://pkg.go.dev/${e}@${r}#section-documentation)`;case 3:return`[(docs)](https://npmjs.com/package/${e}/v/${r})`;case 5:return`[(docs)](https://packagist.org/packages/${e}#${r})`;case 4:return`[(docs)](https://pypi.org/project/${e}/${r})`;default:return""}}function Ol(t,e,r){let n=e?.get(r);if(n?.length){t.appendMarkdown("#### Vulnerabilities (Current)");let s=[];n?.forEach(i=>{let o=` - [${i}](https://osv.dev/vulnerability/${i}) 
`;s.push(o)}),t.appendMarkdown(`
`+s.join(""))}}function Sl(t,e,r,n,s,i,o){for(let l=0;l<e.length;l++){let a=e[l],c=s?.get(a),u={key:r.key,version:a,startLine:r.range.start.line},p=a===n,m=encodeURI(JSON.stringify(u)),d=l===0||p?" "+wl(o,r.key,a):"",x=c?.length?i.vulnText.replace("${count}",`${c?.length}`):"",S=`${p?"**":""}[${a}](command:${P.REPLACE_VERSIONS}?${m})${d}${p?"**":""}  ${x}`;t.appendMarkdown(`
 * `),t.appendMarkdown(S)}}var gi=require("vscode");function Ei(){let t=f.decorator.compatible.template,e={...f.decorator.compatible.css},r=f.decorator.patchUpdate.template,n={...f.decorator.patchUpdate.css},s=f.decorator.incompatible.template,i={...f.decorator.incompatible.css},o=f.decorator.error.template,l={...f.decorator.error.css},a=f.decorator.vulnerability.template,c=f.decorator.position;return Hr(e,c,t),Hr(i,c,s),Hr(l,c,o),{compatibleType:Nt(e),patchUpdateType:Nt(n),incompatibleType:Nt(i),errorType:Nt(l),compatibleText:t,patchUpdateText:r,incompatibleText:s,errorText:o,vulnText:a,position:c}}function Hr(t,e,r){(t[e]==null||t[e]==null)&&(t[e]={margin:"0.5em"}),t[e].contentText=r}function Nt(t){return gi.window.createTextEditorDecorationType(t)}var Se=require("vscode");var T=Se.window.createStatusBarItem(Se.StatusBarAlignment.Right,-1e3);T.setText=(t,e,r=!1)=>{switch(t){case"Error":if(T.color="statusBarItem.errorForeground",T.text="$(error) Dependi",r){T.tooltip=e||"Error";return}else{T.tooltip="",Se.window.showErrorMessage(e||"Error");return}case"Warning":T.text="$(warning) Dependi",T.color="statusBarItem.warningForeground";break;case"Info":T.color="statusBarItem.foreground",T.text="$(check-all) Dependi";break;case"Loading":T.color="statusBarItem.activeForeground",T.text="$(sync~spin) Dependi"}e&&Se.window.setStatusBarMessage(`Dependi: ${e}`,2e3),T.tooltip=e,T.command=P.RETRY};T.fetching=t=>{T.color="statusBarItem.activeForeground",T.text="$(sync~spin) Dependi",T.tooltip="\u{1F440} Fetching "+t.replace(/^https?:\/\//,""),T.command=P.RETRY};var De;function _e(t,e,r){console.debug("Decorating",t.document.fileName);let n=Ei(),s=[],i=e.filter(c=>(c&&!c.error&&c.versions&&c.versions.length||(c.error||(c.error=c.item.key+": No versions found"),s.push(`${c.error}`)),c)),o=[],l=[],a=[];for(let c=i.length-1;c>-1;c--){let u=i[c];try{let p=Mr(t,u.item,u.versions||[],JSON.parse(JSON.stringify(n)),r,u.vulns,u.error);if(p)switch(p[1]){case"COMP":o.push(p[0]);break;case"PATCH":o.push(p[0]);break;case"INCOMP":l.push(p[0]);break;case"ERROR":a.push(p[0]);break}}catch(p){console.error(p),I.appendLine(`Failed to build decorator (${u.item.value})`),s.push(`Failed to build decorator (${u.item.value})`)}}De&&(De.compatibleType,De.compatibleType.dispose(),De.incompatibleType.dispose(),De.errorType.dispose()),t.setDecorations(n.compatibleType,o),t.setDecorations(n.incompatibleType,l),t.setDecorations(n.errorType,a),De=n,s.length?T.setText("Error",`Completed with errors ${s.join(`
`)}`,!0):T.setText("Info")}var lt=class{constructor(e){this.item=e}};var _=new Map,J=class{constructor(e,r){this.fetcher=e,this.parser=r}parse(e){let n=this.parser.parse(e.document).map(i=>new lt(i)),s=_.get(R);return s||(s=new yi.default({stdTTL:5*60,checkperiod:5*30,useClones:!1}),_.set(R,s)),n=n.map(i=>{let o=s.get(i.item.key+i.item.range.start.line);return o?(i.item.value==="latest"&&(i.item.value=o.item.latestVersion),i.item.latestVersion=o.item.latestVersion,o.item=i.item):s.set(i.item.key+i.item.range.start.line,i),o||i}),n.forEach(i=>{i.versions&&this.modifyDependecy(i)}),n}async parseAndDecorate(e){try{let r=this.parse(e),n=[this.fetcher.versions(r)];f.vulnerability.enabled&&n.push(this.fetcher.vulns(r)),await Promise.all(n),D.updateAllData=r.map(s=>({key:s.item.key,version:s.versions?.[0]??"",startLine:s.item.range.start.line})),_e(e,r,R),f.vulnerability.enabled&&this.fetcher.vulns(r).then(()=>{_e(e,r,R)})}catch(r){console.error(r)}}modifyDependecy(e){}};var Ri=Ne.commands.registerTextEditorCommand(P.REPLACE_VERSIONS,(t,e,r)=>{if(t&&r&&!D.inProgress){D.inProgress=!0;let n=_.get(R)?.get(r.key+r.startLine);if(!n){D.inProgress=!1;return}let s=new Ne.Range(n.item.range.start.line,n.item.range.start.character,n.item.range.end.line,n.item.range.end.character);e.replace(s,r.version),D.inProgress=!1}Ne.workspace.save(t.document.uri).then(n=>{n||(console.error("Failed to save",n),I.appendLine(`Failed to save ${n}`))})});var Ce=require("vscode");var bi=Ce.commands.registerTextEditorCommand(P.UPDATE_ALL,(t,e)=>{if(!t||D.inProgress){console.debug("Editor is undefined or in progress",t,D.inProgress);return}D.inProgress=!0,console.debug("Replacing All");for(let r=D.updateAllData.length-1;r>-1;r--){let n=D.updateAllData[r];if(n.version===""){console.debug("Version is empty",n),I.appendLine(`Version is empty ${n}`);continue}let s=_.get(R)?.get(n.key+n.startLine);if(!s){console.error("Dependency not found",n.key),I.appendLine(`Dependency not found ${n.key}`);continue}e.replace(new Ce.Range(s.item.range.start.line,s.item.range.start.character,s.item.range.end.line,s.item.range.end.character),n.version)}D.inProgress=!1,Ce.workspace.save(t.document.uri).then(r=>{r?console.debug("Saved",r):(console.error("Failed to save",r),I.appendLine(`Failed to save ${r}`))})});var ve=require("vscode");var Bt=require("vscode");var Dl=[{ID:1,Name:"Cargo.toml"},{ID:2,Name:"go.mod"},{ID:3,Name:"package.json"},{ID:5,Name:"composer.json"},{ID:4,Name:"requirements.txt"}],Br=t=>Dl.find(e=>e.Name===t)?.ID??0;async function vi(t,e){return await pe("v1/reports/vulnerability",{method:"POST",headers:{Authorization:f.api.key,"X-Device-ID":f.api.deviceID,"Content-Type":"application/json"},body:JSON.stringify(t),...e})}async function Ii(t,e){return await pe("v1/reports/vulnerability/current",{method:"POST",headers:{Authorization:f.api.key,"X-Device-ID":f.api.deviceID,"Content-Type":"application/json"},body:JSON.stringify(t),...e})}async function xi(t,e){return await pe("v1/reports/pdf",{method:"POST",body:JSON.stringify(t),headers:{Authorization:f.api.key,"X-Device-ID":f.api.deviceID,"Content-Type":"application/json"},...e})}var ee=require("vscode");var Si=O(require("os")),Di=require("vscode");var Ct=(a=>(a.NULL="Null",a.UNDEFINED="Undefined",a.DLR="Device Limit reached. You can edit your api key or visit dependi.io dashboard to manage devices.",a.IVDID="Invalid device ID",a.PAYRQ="Payment required. Please visit dependi.io dashboard to update your payment method.",a.UNAUTH="Unauthorized, please check your api key.",a.IVAK="Invalid api key or api key not found. Please check your api key.",a.UINA="User is not active. Please check emails from us or visit dependi.io dashboard.",a))(Ct||{});function ke(t){if(!t)return"Null";let e=t.split(" - ")[0];return Ct[e]||t}var ft=require("vscode");var ut=require("vscode"),C=class{constructor(e){this.key="";this.value="";this.start=-1;this.end=-1;this.line=-1;this.endOfLine=-1;this.range=new ut.Range(0,0,0,0);this.decoRange=new ut.Range(0,0,0,0);e&&(this.key=e.key,this.value=e.value,this.start=e.start,this.end=e.end,this.line=e.line,this.decoRange=e.decoRange)}copyFrom(e,r,n,s,i,o,l){e&&(this.key=e),r&&(this.value=r),n&&(this.start=n),s&&(this.end=s),i&&(this.line=i),o&&(this.endOfLine=o),l&&(this.lockedAt=l)}createRange(){this.range=new ut.Range(this.line,this.start,this.line,this.end)}createDecoRange(){this.decoRange=new ut.Range(this.line,this.start,this.line,this.endOfLine)}isValid(){return this.key.length>0&&this.value?.length&&this.start>-1&&this.end>-1&&(/\d/.test(this.value)||this.value==="*")}};function _l(t){switch(t[0]){case"<":return t.startsWith("<<<<<<<");case"=":return t.startsWith("=======");case">":return t.startsWith(">>>>>>>");default:return!1}}function N(t){return t==='"'||t==="'"}function Nl(t){return t.includes("dependi:")&&t.includes("disable-check")}function fe(t,e,r){if(t.isEmptyOrWhitespace)return!0;let n=t.firstNonWhitespaceCharacterIndex,s=t.text[n];return!!(r&&r.includes(s)||Nl(t.text)||_l(t.text)||Cl(t.text,e))}function Cl(t,e){if(!e||e.trim()==="")return!1;t=t.trim();let r=e.split(",").map(n=>n.trim());for(let n of r)if(n.startsWith("*")&&n.endsWith("*")){let s=n.slice(1,-1);if(t.includes(s))return!0}else if(n.startsWith("*")){let s=n.slice(1);if(t.endsWith(s))return!0}else if(n.endsWith("*")){let s=n.slice(0,-1);if(t.startsWith(s))return!0}return!1}var Wr=O(require("path")),jr=O(require("fs"));var Pi=O(at()),Gr=class{constructor(){this.isTable=!1,this.lockedValue="",this.dependency=""}},kt=class{constructor(){}parse(e,r){let n=e.split(`
`),s=new Gr;for(let i=0;i<n.length;i++){let o=n[i];this.isTableSection(o)&&(o=n[++i],o.startsWith("name")&&(s.dependency=this.getPackageName(o),pt(r,s.dependency)&&(o=n[++i],o.startsWith("version")&&(s.lockedValue=this.getParsedVersion(o),this.setLockValue(s,r),i++))))}return r}isTableSection(e){return e.startsWith("[[")&&e.endsWith("]]")}setLockValue(e,r){let n=r.find(s=>s.key===e.dependency);n&&(!n.lockedAt||n.value&&(0,Pi.satisfies)(e.lockedValue,n.value))&&(n.lockedAt=e.lockedValue),e.lockedValue="",e.dependency=""}getPackageName(e){let r=e.split(" = ")[1];return Li(r)}getParsedVersion(e){let r=e.split("version = ")[1];return Li(r)}};function pt(t,e){return t.some(r=>r.key===e)}function Li(t){return t.replace(/[^a-zA-Z0-9-_.*+]/g,"").trim()}var Kr=class{constructor(){this.inInlineTable=!1,this.inArray=!1,this.isMultipleDepTable=!1,this.isSingle=!1,this.items=[],this.currentItem=new C,this.bypass=!1,this.isSubTable=!1}},Ae=class{constructor(e,r){this.pattern=e;this.enableLockFileParsing=r}parse(e){let r=[],n=new Kr;for(let s=0;s<e.lineCount;s++){let i=e.lineAt(s);if(!fe(i,this.pattern,["#"])){if(Ul(i)){n.bypass=!1,n.isSingle&&this.addItem(n,r),kl(i.text)?(n.isMultipleDepTable=!0,n.isSingle=!1,n.isSubTable=!1):Vl(i.text)?(n.isMultipleDepTable=!1,n.isSubTable=!1,n.isSingle=!0,n.currentItem=new C,n.currentItem.key=i.text.substring(i.text.lastIndexOf(".")+1,i.text.indexOf("]"))):(n.isMultipleDepTable=!1,n.isSingle=!1,n.isSubTable=!1,n.bypass=!0);continue}else if(this.isSubTable(i.text,n)){n.bypass=!1,n.isSubTable=!0;continue}if(!n.bypass)if(n.isMultipleDepTable||n.isSubTable){let o=this.parsePair(i.text,s);if(!o)continue;n.currentItem.copyFrom(o.key,o.value,o.start,o.end,s,i.range.end.character),this.addItem(n,r);continue}else{let o=this.parsePair(i.text,s);if(!o)continue;switch(o.key){case"version":n.currentItem.copyFrom(void 0,o.value,o.start,o.end,s,i.range.end.character);continue;case"package":n.currentItem.copyFrom(o.value);continue;case"features":case"default-features":case"path":case"workspace":continue;default:}}}}return this.addItem(n,r),this.enableLockFileParsing?Fl(r):r}addItem(e,r){e.currentItem.isValid()&&(e.currentItem.createRange(),e.currentItem.createDecoRange(),r.push(e.currentItem),e.currentItem=new C)}parsePair(e,r){let n=new C,s=e.indexOf("=");if(s===-1)return;r=s+1;let i=e.indexOf("#");if(n.key=$e(e.substring(0,s)),n.key=n.key.replace(".version",""),n.value=e.substring(s+1,i>-1?i:e.length).trim().replace(/^"|"$|'/g,""),!(At(n.value)||ql(n.value)))return e.indexOf("{")>-1?(Yr(e,n),Xr(e,n),n.start>-1?n:void 0):(n.start=e.indexOf(n.value),n.end=n.start+n.value.length,n.start>-1?n:void 0)}isSubTable(e,r){return!1}};function Xr(t,e){let r=e.start,n=t.indexOf("version");if(n!==-1)for(r=n+7;r<t.length;){if(t[r]==="="){e.start=r,Al(t,e);return}r++}}function kl(t){return t.includes("dependencies]")}function Al(t,e){let r=e.start,n=-1,s=0;for(;r++<t.length;){let o=t[r];if(N(o)){if(s++,s===2){r++;break}continue}if(Ti(o)){if(n>-1)break;continue}else if(n>-1)continue;n=r}r--;let i=t.substring(n,r);At(i)||(e.value=i,e.start=n,e.end=e.start+e.value.length)}function Yr(t,e){let r=e.start,n=t.indexOf("package");if(n!=-1)for(r=n+7;r<t.length;){if(t[r]==="="){$l(t,e,r);return}r++}}function $l(t,e,r){let n=r,s=-1;for(;n++<t.length;){let i=t[n];if(Ti(i)||N(i)){if(s>-1)break;continue}else if(s>-1)continue;s=n}e.key=t.substring(s,n)}function Ti(t){return t===" "||t==="	"}function Vl(t){return t.includes("dependencies.")}function At(t){return t==="true"||t==="false"}function $e(t){return t.replace(/[^a-zA-Z0-9-_.*]/g,"").trim()}function Ul(t){let e=t.firstNonWhitespaceCharacterIndex;return t.text[e]==="["}function Fl(t){let e=ft.window.activeTextEditor?.document.uri.fsPath,r=Wr.default.dirname(e||"");try{let s=jr.default.readdirSync(r).find(i=>i.endsWith(".lock"));if(s){let i=Wr.default.join(r,s),o=jr.default.readFileSync(i,"utf8");t=new kt().parse(o,t),ft.commands.executeCommand("setContext","dependi.hasLockFile",!0)}else ft.commands.executeCommand("setContext","dependi.hasLockFile",!1)}catch(n){console.error(n)}return t}function ql(t){return["git","path"].some(r=>t.includes(r))}var Ve=class extends Ae{constructor(){super(f.rust.ignoreLinePattern,f.rust.lockFileEnabled)}};var Jr=class{constructor(){this.inRequire=!1,this.items=[],this.bypass=!1}},Ue=class{parse(e){let r=new Jr;for(let n=0;n<e.lineCount;n++){let s=e.lineAt(n);if(fe(s,f.go.ignoreLinePattern,["/"])||r.bypass)continue;let i=Ml(s);if(i==="block"){r.inRequire=!0;continue}if(r.inRequire){if(Hl(s)){r.inRequire=!1;continue}let o=wi(s);o.createRange(),o.createDecoRange(),r.items.push(o)}if(i==="single"&&!r.inRequire){let o=wi(s);o.createRange(),o.createDecoRange(),r.items.push(o)}}return r.items}};function Ml(t){let e=t.firstNonWhitespaceCharacterIndex,r=t.text.substring(e);return r.startsWith("require (")?"block":r.startsWith("require")?"single":null}function Hl(t){return t.text[t.firstNonWhitespaceCharacterIndex]===")"}function wi(t){let e=t.text.indexOf(" ",t.firstNonWhitespaceCharacterIndex),r=e+1,n=t.text.indexOf(" ",r);n===-1&&(n=t.text.length);let s=t.text.substring(t.firstNonWhitespaceCharacterIndex,e);s.startsWith("require")&&(s=s.substring(7).trim());let i=t.text.substring(r,n);N(s[0])&&N(s[s.length-1])&&(s=s.substring(1,s.length-1)),N(i[0])&&N(i[i.length-1])&&(i=i.substring(1,i.length-1),r++,n--);let o=new C;return o.copyFrom(s,i,r,n,t.lineNumber,t.range.end.character),o}var He=O(require("vscode"));var mt=require("vscode");var zr=O(require("path")),$t=O(require("fs")),Qr=class{constructor(){this.inDependencies=!1,this.items=[],this.bypass=!1,this.yamlLines=[]}},Fe=class{constructor(e,r,n,s){this.keys=e;this.enableLockFileParsing=r;this.lockFileName=n;this.lockParser=s;this.state=new Qr}parse(e){let r=yr==="npm"?f.npm.ignoreLinePattern:f.php.ignoreLinePattern;for(let n=0;n<e.lineCount;n++){let s=e.lineAt(n);if(!fe(s,r)&&!this.state.bypass){if(this.isDependencies(s)){this.state.inDependencies=!0;continue}if(this.state.inDependencies){if(Bl(s)){this.state.inDependencies=!1;continue}let i=Gl(s);this.addDependency(i)}}}return this.enableLockFileParsing?this.parseLockedFile(this.state.items):this.state.items}addDependency(e){e.createRange(),e.createDecoRange(),this.state.items.push(e)}isDependencies(e){let r=e.firstNonWhitespaceCharacterIndex;return this.keys.some(n=>e.text.substring(r,r+n.length+3)===`"${n}":`&&!e.text.includes("}"))}parseLockedFile(e){let r=mt.window.activeTextEditor?.document.uri.fsPath,n=zr.default.dirname(r||"");try{let i=$t.readdirSync(n).find(o=>o===this.lockFileName);if(i){let o=zr.default.join(n,i),l=$t.readFileSync(o,"utf8");e=this.lockParser.parse(l,e),mt.commands.executeCommand("setContext","dependi.hasLockFile",!0)}else mt.commands.executeCommand("setContext","dependi.hasLockFile",!1)}catch(s){console.error(s)}return e}};function Bl(t){return t.text[t.firstNonWhitespaceCharacterIndex]==="}"}function Gl(t){let e=t.text.indexOf(":",t.firstNonWhitespaceCharacterIndex),r=e+3,n=t.text.indexOf('"',r);n===-1&&(n=t.text.length);let s=t.text.substring(t.firstNonWhitespaceCharacterIndex,e),i=t.text.substring(r,n);N(s[0])&&N(s[s.length-1])&&(s=s.substring(1,s.length-1)),N(i[0])&&N(i[i.length-1])&&(i=i.substring(1,i.length-1),r++,n--);let o=new C;return o.copyFrom(s,i,r,n,t.lineNumber,t.range.end.character),o}var Zr=class{constructor(){this.lockedValue="",this.dependency=""}},qe=class{constructor(){}parse(e,r){let n=JSON.parse(e),s=new Zr;return this.processLockFileDependencies(n,r,s),r}processLockFileDependencies(e,r,n){}};function Vt(t,e){let r=e.find(n=>n.key===t.dependency);r&&(r.lockedAt=t.lockedValue),t.lockedValue="",t.dependency=""}var Ut=class extends qe{constructor(){super()}processLockFileDependencies(e,r,n){for(let s in e.packages)s.startsWith("node_modules/")&&(n.dependency=s.replace("node_modules/",""),pt(r,n.dependency)&&(n.lockedValue=e.packages[s].version,Vt(n,r)))}};var Oi=O(require("path")),Ft=O(require("fs"));var Me=class extends Fe{constructor(){super(["dependencies","devDependencies","peerDependencies","optionalDependencies"],f.npm.lockFileEnabled,"package-lock.json",new Ut)}addDependency(e){e.value?.startsWith("link:")||(e=Wl(e),e.createRange(),e.createDecoRange(),e.value?.startsWith("catalog:")&&(this.loadYamlLinesIfNeeded(),this.state.yamlLines.length>0&&this.updateItemValueFromCatalog(e)),this.state.items.push(e))}loadYamlLinesIfNeeded(){if(this.state.yamlLines.length===0){let e=He.window.activeTextEditor?.document.uri.fsPath,n=He.workspace.getWorkspaceFolder(He.Uri.file(e||""))?.uri.fsPath;try{let i=Ft.readdirSync(n).find(o=>o==="pnpm-workspace.yaml");if(i){let o=Oi.default.join(n,i),l=Ft.readFileSync(o,"utf8");this.state.yamlLines=l.split(`
`)}}catch(s){console.error(s)}}}updateItemValueFromCatalog(e){let r=e.value?.replace("catalog:","");r?.trim()===""&&(r=e.key);let n=this.state.yamlLines.find(s=>{let i=s.split(":")[0].trim().replace(/^['"]|['"]$/g,"");return i===e.key||i===r});if(n){let s=$e(n.split(":")[1].trim());e.value=s}}};function Wl(t){if(t.value?.startsWith("npm:")){let e=t.value.indexOf("@");e!==-1&&(t.key=t.value.slice(4,e),t.value=t.value.slice(e+1),t.start=t.start+t.key.length+5)}return t}var qt=class extends qe{constructor(){super()}processLockFileDependencies(e,r,n){let s=[...e.packages,...e["packages-dev"]];for(let i=0;i<s.length;i++){let o=s[i];n.dependency=o.name,pt(r,n.dependency)&&(n.lockedValue=o.version,Vt(n,r))}}};var Be=class extends Fe{constructor(){super(["require","require-dev"],f.php.lockFileEnabled,"composer.lock",new qt)}addDependency(e){e.key!=="php"&&(e.createRange(),e.createDecoRange(),this.state.items.push(e))}};var en=class{constructor(){this.items=[],this.bypass=!1}},Ge=class{parse(e){let r=new en;for(let n=0;n<e.lineCount;n++){let s=e.lineAt(n);if(fe(s,f.python.ignoreLinePattern,["#","-","."])||r.bypass||!s.text.includes("="))continue;let i=Kl(s);i.line=s.lineNumber,i.createRange(),i.createDecoRange(),r.items.push(i)}return r.items}};function jl(t){let e=[">","<","~","!","="];for(let r=0;r<t.text.length;r++)if(e.includes(t.text[r]))return r;return-1}function Kl(t){let e=jl(t),r=e,n=t.text.length,s=t.text.substring(t.firstNonWhitespaceCharacterIndex,e),i=t.text.substring(r,n);i.startsWith("==")||i.startsWith(">=")||i.startsWith("<=")?r+=2:(i.startsWith(">")||i.startsWith("<")||i.startsWith("!"))&&(r+=1),N(s[0])&&N(s[s.length-1])&&(s=s.substring(1,s.length-1)),N(i[0])&&N(i[i.length-1])&&(i=i.substring(1,i.length-1),r++,n--),s.includes("[")&&(s=s.split("[")[0]);let o=new C;return o.copyFrom(s.trim(),i,r,n,t.lineNumber,t.range.end.character),o}function Xl(t,e){return e.startsWith("==")?t===e.slice(2):e.startsWith("!")?t!==e.slice(1):e.startsWith(">=")?ge(t,e.slice(2))>=0:e.startsWith("<=")?ge(t,e.slice(2))<=0:e.startsWith(">")?ge(t,e.slice(1))>0:e.startsWith("<")?ge(t,e.slice(1))<0:!1}function ge(t,e){let[r,n]=t.split(/[^\d.]/,2),[s,i]=e.split(/[^\d.]/,2),o=r.split(".").map(Number),l=s.split(".").map(Number);for(let a=0;a<Math.max(o.length,l.length);a++){let c=o[a]||0,u=l[a]||0;if(c<u)return-1;if(c>u)return 1}return n&&i?n.localeCompare(i):n?1:i?-1:0}function Ee(t){let e;return t.includes(";")?e=t.split(";")[0].split(",").map(r=>r.trim()):e=t.split(",").map(r=>r.trim()),e}function ye(t,e){let r=t.find(n=>n.startsWith("=="));if(r){if(t.some(n=>n.includes("*"))){let n=t.find(i=>i.startsWith("=="))?.slice(2).split(".")[0],s=e.filter(i=>i.startsWith(n||""));return s.length>0?s.reduce((i,o)=>ge(i,o)>=0?i:o):null}return r.slice(2)}else if(t.some(n=>n.includes("*"))){let n=t.find(i=>i.startsWith("=="))?.slice(2).split(".")[0];n===void 0&&(n=t.find(i=>i.includes("*"))?.split(".")[0]?.replace(/[^0-9*]/g,""));let s=e.filter(i=>i.startsWith(n||""));return s.length>0?s.reduce((i,o)=>ge(i,o)>=0?i:o):null}else{let n=e.filter(s=>t.every(i=>Xl(s,i)));return n.length>0?n.reduce((s,i)=>ge(s,i)>=0?s:i):null}}var We=class extends Ae{constructor(){super(f.python.ignoreLinePattern,f.python.lockFileEnabled)}addItem(e,r){!e.currentItem.isValid()||["python","requires-python"].includes(e.currentItem.key)||(e.currentItem.createRange(),e.currentItem.createDecoRange(),r.push(e.currentItem),e.currentItem=new C)}parsePair(e,r){let n=new C,s=e.indexOf("=");if(s===-1)return;let i=e.substring(0,s).indexOf("[");r=s+1;let o=e.indexOf("#");n.key=$e(e.substring(0,i>-1?i:s)),n.key=n.key.replace(".version","");let l=e.substring(s+1,o>-1?o:e.length),a=l.indexOf(",");if(n.value=$e(a>-1?l.substring(0,a):l),!(At(n.value)||n.value.includes("path"))){if(e.indexOf("{")>-1)return Yr(e,n),Xr(e,n),n.start>-1?n:void 0;if(n.start=e.indexOf(n.value),n.end=n.start+n.value.length,e[s-1]==="~"||e[s-1]===">"){let c=n.value.lastIndexOf("."),u=n.value.substring(c+1);isNaN(parseInt(u[0]))&&(c=n.value.substring(0,c).lastIndexOf(".")),c>-1&&(n.value=n.value.substring(0,c)+".*")}return n.start>-1?n:void 0}}isSubTable(e,r){return e.trim()==="]"?(r.isSubTable=!1,r.isSingle=!1,r.isMultipleDepTable=!1,r.bypass=!0,!1):e.endsWith(" = [")}};var Re=require("vscode");var tn={settings:"Open settings",dashboard:"Go to Dashboard"};async function rn(t,e){return Re.window.showErrorMessage(t,...Object.keys(e)).then(async r=>{await e[r??""]?.()})}function Mt(){rn("Device Limit reached. You can edit your api key or visit dependi.io dashboard to manage devices.",{[tn.settings]:()=>Re.commands.executeCommand("workbench.action.openSettingsJson",{revealSetting:{key:G+"apiKey",edit:!0}}),[tn.dashboard]:()=>Re.commands.executeCommand("vscode.open",`${f.api.proPanelURL}/api-key-management`)})}function Ht(){rn("Payment required. Please visit dependi.io dashboard to update your payment method.",{[tn.dashboard]:()=>Re.commands.executeCommand("vscode.open",`${f.api.proPanelURL}/payments`)})}function ie(t,e){rn(e,{"Open settings":()=>Re.commands.executeCommand("workbench.action.openSettingsJson",{revealSetting:{key:G+t,edit:!0}})})}var nn=t=>{switch(t){case"Cargo.toml":return new Ve;case"go.mod":return new Ue;case"package.json":return new Me;case"composer.json":return new Be;case"requirements.txt":return new Ge;case"pyproject.toml":return new We;default:throw Error("Language not supported")}},je=t=>{if(Si.default.platform()!=="win32")return t;let e=t.slice(1);return e=e.replace(/\\/g,"/")};function sn(t){if(t.status!==200)switch(ke(t.error)){case"Device Limit reached. You can edit your api key or visit dependi.io dashboard to manage devices.":Mt();break;case"Payment required. Please visit dependi.io dashboard to update your payment method.":Ht();break;case"Unauthorized, please check your api key.":ie("apiKey","Unauthorized, please check your api key.");break;case"Invalid api key or api key not found. Please check your api key.":ie("apiKey","Invalid api key or api key not found. Please check your api key.");break;case"User is not active. Please check emails from us or visit dependi.io dashboard.":ie("apiKey","User is not active. Please check emails from us or visit dependi.io dashboard.");break;default:Di.window.showErrorMessage(ke(t.error))}}async function on(){let t=ee.extensions.getExtension("vscode.git").exports;if(!t)throw new Error("Git extension not found");let r=t.getAPI(1).repositories;if(!r||r.length===0)throw new Error("No repository found");let n=ee.window.activeTextEditor;if(!n)throw new Error("Active editor not found");let s=n.document.uri.fsPath;return{repo:r.find(o=>s.includes(o.rootUri.fsPath))}}async function _i(){let{repo:t}=await on(),e=t.rootUri,r,n=je(e.path);return e&&(r=n.split("/").pop()),{repoName:r,repoRootUri:e}}async function Ni(t){let e=ee.window.activeTextEditor;if(!e)throw new Error("Active editor not found");let r=e.document.uri,n=je(r.path),s=await t.log({path:n});if(!s||s.length===0)throw new Error("There is no commit history on the active file");return{commits:s}}async function Ci(t,e,r,n){let s=je(ee.window.activeTextEditor.document.uri.path),i=await e.show(r,s),o=await ee.workspace.openTextDocument({language:n,content:i});return ee.window.showTextDocument(o).then(()=>ee.commands.executeCommand("workbench.action.revertAndCloseActiveEditor")),t.parse(o)}var Yl={fetchingRepository:{label:"Fetching current repository",percentage:5},parsingFile:{label:"Parsing current file",percentage:10},comparingFiles:{label:"Comparing files",percentage:25},generatingReport:{label:"Generating vulnerability report",percentage:55},creatingUI:{label:"Creating Report",percentage:80}};async function ki(){let{repo:t}=await on(),{commits:e}=await Ni(t),{repoName:r,repoRootUri:n}=await _i(),s=e[0]?.hash,i=e[0]?.authorEmail;if(!s)throw new Error("No commits found in the repository.");return{repo:t,commits:e,repoName:r,repoRootUri:n,commitId:s,author:i}}async function Ai(){let t=Bt.window.activeTextEditor;if(!t)throw new Error("Active editor not found");let e=t.document.fileName||"";if(e==="")throw new Error("File name has not been found.");let r=e.split(/[/\\]/).pop();if(!r)throw new Error("Failed to extract file name with extension.");return{editor:t,fileName:r}}function be(t,e,r){let{percentage:n,label:s}=Yl[e];return t.report({increment:n,message:`Progress: ${r+n}% ${s}`}),r+n}async function Jl(t,e,r,n){let s=Bt.window.activeTextEditor;if(!s)throw new Error("Active editor not found");let i=t.parse(s.document),o=await Ci(t,e,r,n),l=i.map(c=>({Key:c.key,Value:c.value||""})),a=o.map(c=>({Key:c.key,Value:c.value||""}));return{currentReportItems:l,previousReportItems:a}}async function $i(t){let e=0;try{e=be(t,"fetchingRepository",e);let{repo:r,commits:n,repoName:s,repoRootUri:i,commitId:o,author:l}=await ki(),{fileName:a}=await Ai();e=be(t,"parsingFile",e);let c=nn(a),{currentReportItems:u,previousReportItems:p}=await Jl(c,r,o,a);if(!i)throw new Error("Repository root URI not found");e=be(t,"generatingReport",e);let m={RepoName:s||"",Commits:n||[],PreviousItems:p,CurrentItems:u,Language:Br(a),GHSACheck:f.vulnerability.ghsa,Author:l},d=await vi(m);if(!d)throw new Error("Failed to generate report");sn(d);let x=d.body||"";return e=be(t,"creatingUI",e),x}catch(r){throw new Error(`Error during report generation: ${r}`)}}async function Vi(t){let e=0;try{let{fileName:r}=await Ai(),{commits:n,repoName:s,author:i}=await ki();e=be(t,"parsingFile",e);let o=nn(r),{reportItems:l}=await zl(o);e=be(t,"generatingReport",e);let a={RepoName:s||"",Commits:n||[],PreviousItems:[],CurrentItems:l,Language:Br(r),GHSACheck:f.vulnerability.ghsa,Author:i},c=await Ii(a);sn(c);let u=c.body||"";return e=be(t,"creatingUI",e),u}catch(r){throw new Error(`Error during report generation: ${r}`)}}async function zl(t){let e=Bt.window.activeTextEditor;if(!e)throw new Error("Active editor not found");return{reportItems:t.parse(e.document).map(s=>({Key:s.key,Value:s.value?.replace(/[=><]/g,"")||""}))}}var A=O(require("vscode"));var me=class{constructor(e,r){this._disposables=[];this._panel=e,this._extensionUri=r,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables)}dispose(){for(this._panel.dispose();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}_getWebviewContent(){return""}};var Ke=class t extends me{constructor(e,r,n){super(e,r),this.fetchedHTML=n,this._panel.webview.html=this.getWebviewContent(n),this._setWebviewMessageListener(this._panel.webview)}static render(e,r){let n=A.window.createWebviewPanel("vulnerabilityReport","Vulnerability Report",{viewColumn:A.ViewColumn.One,preserveFocus:!0},{enableScripts:!0,retainContextWhenHidden:!0});return new t(n,e,r)}_getVulnerabilityReportHtml(e){return e}getWebviewContent(e){return this._getVulnerabilityReportHtml(e)}async handleExportReport(){let e=this.getSaveText(),r={saveLabel:"Save PDF",filters:{"PDF Files":["pdf"]},defaultUri:A.Uri.file(e)},n=await A.window.showSaveDialog(r);if(n){let s=this._getVulnerabilityReportHtml(this.fetchedHTML);s=this.addHideClassToExportButton(s);let i=await xi(s);if(!i||!i.body||i.body.size===0){A.window.showErrorMessage("Error exporting PDF.");return}let o=await this.blobToUint8Array(i.body),l=n.path,a=je(l),c=A.Uri.file(a);await A.workspace.fs.writeFile(c,o),A.window.showInformationMessage(`Report saved to ${n.fsPath}`,"Open File").then(async u=>{if(u==="Open File"){let p=A.Uri.file(n.fsPath);await A.env.openExternal(p)}})}}_setWebviewMessageListener(e){e.onDidReceiveMessage(async r=>{if(r.command==="exportReport")try{await this.handleExportReport()}catch(n){console.error("Failed to save PDF: ",n),I.appendLine("Failed to save PDF: "+n),A.window.showErrorMessage("Error exporting PDF.")}},void 0,this._disposables)}getSaveText(){let e=new Date,r=e.getHours(),n=e.getMinutes(),s=r<10?"0"+r:r,i=n<10?"0"+n:n;return`Vulnerability_Report-${e.toISOString().split("T")[0]}-${s}_${i}.pdf`}addHideClassToExportButton(e){return e.replace('<button id="pdf-export-button">','<button id="pdf-export-button" class="hide-in-pdf">')}async blobToUint8Array(e){let r=await e.arrayBuffer();return new Uint8Array(r)}};var Ui=t=>ve.commands.registerCommand(P.GENERATE_VULNERABILITY_CURRENT_REPORT,async()=>{let e={location:ve.ProgressLocation.Notification,title:"Loading Report",cancellable:!1};ve.window.withProgress(e,Vi).then(r=>{r&&Ke.render(t.extensionUri,r)},r=>{ve.window.showErrorMessage(`Report generation failed: ${r}`)})});var Ie=require("vscode");var Fi=t=>Ie.commands.registerCommand(P.GENERATE_VULNERABILITY_REPORT,async()=>{let e={location:Ie.ProgressLocation.Notification,title:"Loading Report",cancellable:!1};Ie.window.withProgress(e,$i).then(r=>{r&&Ke.render(t.extensionUri,r)},r=>{Ie.window.showErrorMessage(`Report generation failed: ${r}`)})});var to=require("vscode");var eo=O(require("path"));var qi=O(require("https")),an=O(require("http"));var oe=(t,e,r,n)=>{let s=t.protocol==="http:"?an.default:qi,i=s.get(t,o=>{if(gn(o)&&o.headers.location){let l=q(o.headers.location),a=K(l);n&&(a.headers={Accept:n}),s=a.protocol==="http:"?an.default:qi;let c=s.get(a,u=>{e(u,c)}).on("error",r);c.end()}else e(o,i)}).on("error",r);i.end()};var Mi=t=>new Promise(function(e,r){let n=Ql(t),s=K(n);oe(s,(o,l)=>{if(re(o))return r(te(o));let a=ne(t,o,l,r),c;o.on("end",()=>{try{let p=Buffer.concat(a).toString().split(`
`).filter(m=>m).map(m=>JSON.parse(m));c={name:t,versions:p.filter(m=>m.yanked===!1).map(m=>m.vers),features:Object.keys(p.at(-1).features).filter(m=>m!=="default")}}catch(u){r(u)}e(c)})},r)});function Ql(t){let e=t.replace(/"/g,"").toLowerCase(),r;return e.length<=2?r=e.length.toFixed(0):e.length==3?r=`3/${e.substring(0,1)}`:r=`${e.substring(0,2)}/${e.substring(2,4)}`,q(`${f.rust.index}/${r}/${e}`)}var Gi=/^(?:\^|~)?v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function Zl(t,e){return t.indexOf(e)===-1?t.length:t.indexOf(e)}function eu(t,e){return t.lastIndexOf(e)===-1?t.length:t.lastIndexOf(e)}function Hi(t){let e=t.replace(/^v/,"").replace(/\+.*$/,""),r=R===4?eu(e,"."):Zl(e,"-"),n=e.substring(0,r).split(".");return n.push(e.substring(r+1)),n}function tu(t){if(!Gi.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function Gt(t,e){R!==4&&[t,e].forEach(tu);let r=Hi(t),n=Hi(e),s=Math.max(r.length-1,n.length-1);for(let c=0;c<s;c++){var i=parseInt(r[c]||"0",10),o=parseInt(n[c]||"0",10);if(i>o)return 1;if(o>i)return-1}if(r.length!==n.length)return r.length>n.length?1:-1;var l=r[r.length-1],a=n[n.length-1];if(l&&a){let c=l.split(".").map(m=>/^\d+$/.test(m)?parseInt(m,10):m),u=a.split(".").map(m=>/^\d+$/.test(m)?parseInt(m,10):m),p=Math.max(c.length,u.length);for(let m=0;m<p;m++){if(c[m]===void 0)return-1;if(u[m]===void 0)return 1;if(typeof c[m]=="string"&&typeof u[m]=="number")return parseInt(c[m].toString())>=parseInt(u[m].toString())?1:-1;if(typeof u[m]=="string"&&typeof c[m]=="number")return parseInt(u[m].toString())>=parseInt(c[m].toString())?-1:1;if(c[m]>u[m])return 1;if(u[m]>c[m])return-1}}else if(l||a)return l?-1:1;return 0}var Bi=[">",">=","=","<","<="],ru={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function nu(t){if(typeof t!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof t);if(Bi.indexOf(t)===-1)throw new TypeError("Invalid operator, expected one of "+Bi.join("|"))}Gt.validate=function(t){return typeof t=="string"&&Gi.test(t)};Gt.compare=function(t,e,r){nu(r);var n=Gt(t,e);return ru[r].indexOf(n)>-1};var z=Gt;function ae(t){return e=>(console.error(e),I.appendLine("Error fetching versions for "+t.item.key+": "+e),{item:t,error:t.item.key+": "+e})}var Wi=O(require("https")),ji=O(br());var cn=new ji.default({stdTTL:60*10});function su(t){let e={method:"POST",headers:{"Content-Type":"application/json"}};return new Promise((r,n)=>{let s=Wi.request(f.vulnerability.osvBatch,e,i=>{let o="";i.on("data",l=>{o+=l}),i.on("end",()=>{try{let l=JSON.parse(o);for(let a=0;a<l.results?.length;a++)l.results[a].packageName=t.queries[a].package.name,l.results[a].version=t.queries[a].version,l.results[a].vulns&&(l.results[a].vulns=l.results[a].vulns.filter(c=>f.vulnerability.ghsa?!0:!c.id.startsWith("GHSA")));r(l)}catch(l){n(l)}})});s.on("error",i=>{n(i)}),s.write(JSON.stringify(t)),s.end()})}var iu=async t=>{try{let e=JSON.stringify({request:t,ghsaCheck:f.vulnerability.ghsa});if(cn.has(e)){let r=cn.get(e);if(r===void 0)throw new Error("Cached response is undefined");return r}else{let r=await su(t);return cn.set(e,r),r}}catch(e){throw console.error("Error fetching data from OSV API:",e),I.appendLine("Error fetching data from OSV API: "+e),e}},Ki=async(t,e)=>{try{let r={queries:[]};for(let i=0;i<t.length;i++){let o=t[i].item.key,l=t[i].versions?.findIndex(a=>a===t[i]?.item?.value)??(t[i].versions?.length??0)-1;for(let a=0;a<=l;a++)!t[i].versions||!t[i]?.versions?.[a]||r.queries.push({version:t[i].versions?.[a],package:{name:o,ecosystem:e}})}T.setText("Info","Fetching vulnerabilities from OSV");let n=await iu(r),s=ou(n,t);return T.setText("Info","Vulnerabilities fetched from OSV"),s}catch(r){return console.error("Error querying multiple package vulnerabilities:",r),I.appendLine("Error querying multiple package vulnerabilities: "+r),[]}};function ou(t,e){let r=new Map;for(let n=0;n<t.results?.length;n++){let s=t.results[n].packageName;if(r.has(s)){let i=r.get(s);i?.versionVulnerabilities.push({version:t.results[n].version,vulnerabilities:t.results[n].vulns}),r.set(s,i)}else r.set(s,{packageName:s,versionVulnerabilities:[{version:t.results[n].version,vulnerabilities:t.results[n].vulns}]})}for(let n=0;n<e?.length;n++){let s=r.get(e[n].item.key),i=new Map;if(s?.versionVulnerabilities)for(let o=0;o<s?.versionVulnerabilities.length;o++){let l=s?.versionVulnerabilities[o],a=[];l?.vulnerabilities&&l?.vulnerabilities.forEach(c=>{a.push(c.id)}),i.set(l.version,a)}e[n].vulns=i}return e}var H=class{constructor(e,r){this.vulnsEnvironment="";if(!e){ie(r,"Please set the URL for the fetcher");return}}async vulns(e){T.setText("Loading","\u{1F440} Fetching vulnerabilities");let r=e.filter(l=>!l.vulns||l.vulns?.size===0),s=au(r,500).map(async l=>Ki(l,Rr)),o=(await Promise.all(s)).reduce((l,a)=>l.concat(a),[]);return o.forEach(l=>{let a=_.get(R)?.get(l.item.key+l.item.range.start.line);a?(console.log("cached vulns",l.item.key,l.vulns),a.vulns=l.vulns):(console.log("new vulns",l.item.key),_.get(R)?.set(l.item.key+l.item.range.start.line,l))}),o}async versions(e){let r=e.some(i=>i.versions&&i.versions.length>=0),n=this.fetch(r),s=e.map(i=>{let o=_.get(R)?.get(i.item.key+i.item.range.start.line);return!o||!o.versions?o&&o.error?(console.log("cached",i.item.key),Promise.resolve(o)):(console.log("fetching",i.item.key,o?.error),n(i)):(console.log("cached",i.item.key),Promise.resolve(o))});return Promise.all(s)}checkUnstables(e,r,n){return e===1||e===2&&Xi(n)?!1:Xi(r)}};function au(t,e){let r=[],n=[],s=0;return t.forEach(i=>{let o=i.versions?.length??0;s+o<=e?(n.push(i),s+=o):(r.push(n),i.versions&&i.versions.length>e&&(i.versions=i.versions.slice(0,1e3)),n=[i],s=o)}),n.length>0&&r.push(n),r}function Xi(t){return t.indexOf("-alpha")!==-1||t.indexOf("-beta")!==-1||t.indexOf("-rc")!==-1||t.indexOf("-SNAPSHOT")!==-1||t.indexOf("-dev")!==-1||t.indexOf("-preview")!==-1||t.indexOf("-experimental")!==-1||t.indexOf("-canary")!==-1||t.indexOf("-pre")!==-1||t.indexOf("-next")!==-1||t.indexOf("-nightly")!==-1}var Wt=class extends H{fetch(){let e=this;return function(r){return r.versions&&r.versions.length>0?Promise.resolve(r):Mi(r.item.key).then(n=>{let s=n.versions.filter(i=>i!==""&&i!==void 0&&!e.checkUnstables(f.rust.unstableFilter,i,r.item.value)).sort(z).reverse();return r.versions=s,r}).catch(ae(r))}}};var Yi=require("vscode");async function cu(t,e){let r={Language:t.Language,Packages:t.Packages,IgnoreUnstables:t.IgnoreUnstables,VulnerabilityCheck:t.VulnerabilityCheck,GhsaCheck:t.GhsaCheck};return await pe("v1/indexes",{method:"POST",body:JSON.stringify(r),...e}).then(n=>{if(n.status!==200)switch(ke(n.error)){case"Device Limit reached. You can edit your api key or visit dependi.io dashboard to manage devices.":return Mt(),[];case"Payment required. Please visit dependi.io dashboard to update your payment method.":return Ht(),[];case"Unauthorized, please check your api key.":return ie("apiKey","Unauthorized, please check your api key."),[];case"Invalid api key or api key not found. Please check your api key.":return ie("apiKey","Invalid api key or api key not found. Please check your api key."),[];case"User is not active. Please check emails from us or visit dependi.io dashboard.":ie("apiKey","User is not active. Please check emails from us or visit dependi.io dashboard.");default:return Yi.window.showErrorMessage(ke(n.error)),[]}let s=n.body?.filter(l=>l?.Name),i=new Map(s?.map(l=>[l.Name,l]));return t.Dependencies.map(l=>{let a=i.get(l.item.key);if(l.error=a?.Error,a&&a.Versions&&(l.versions=a.Versions,l.item.latestVersion=a.LatestVersion,l.item.value==="latest"&&(l.item.value=l.item.latestVersion),a.Vulns)){let c=Object.entries(a.Vulns);l.vulns=new Map(c)}return l})}).catch(n=>(console.error("Catch get versions",n),I.appendLine("Catch get versions: "+n),[]))}var Ji={getVersions:cu};var jt=class extends H{async versions(e){let r=0;switch(R){case 4:r=f.python.unstableFilter;break;case 3:r=f.npm.unstableFilter;break;case 2:r=f.go.unstableFilter;break;case 5:r=f.php.unstableFilter;break;case 1:r=f.rust.unstableFilter;break}let n={Language:R,Packages:e.map(i=>i.item),Dependencies:e,IgnoreUnstables:r,VulnerabilityCheck:f.vulnerability.enabled,GhsaCheck:f.vulnerability.ghsa};f.api.deviceID===""&&(console.error("DeviceID is empty"),I.appendLine("DeviceID is empty"));let s=await Ji.getVersions(n,{headers:{Authorization:f.api.key,"X-Device-ID":f.api.deviceID,"Content-Type":"application/json"}});return R===4&&(s=s.map(o=>this.mapVersions(o))),Promise.all(s)}async vulns(e){throw new Error("Method not implemented.")}mapVersions(e,r){if(!e.versions)return e;let n=e.versions.filter(o=>o!==""&&o!==void 0).sort(z).reverse();if(r){let o=Ee(r.value??""),l=ye(o,n);return r.value=l||r.value,{item:r,versions:n}}let s=Ee(e.item.value??""),i=ye(s,n);return e.item.value=i||e.item.value,e.versions=n,e}fetch(e){throw new Error("Method not implemented.")}};var zi=t=>new Promise(function(e,r){let n=lu(t),s=K(n);oe(s,(o,l)=>{if(re(o))return r(te(o));let a=ne(t,o,l,r),c;o.on("end",()=>{try{c={name:t,versions:a.toString().split(`
`)}}catch(u){r(u)}e(c)})},r)});function lu(t){let e=t.toLowerCase(),r=`${f.go.index}/${e}/@v/list`;return q(r)}var Kt=class extends H{fetch(){let e=this;return async function(r){return zi(r.item.key).then(n=>{let s=n.versions.filter(i=>i!==""&&i!==void 0&&!e.checkUnstables(f.go.unstableFilter,i,r.item.value)).sort(z).reverse();return r.versions=s,r}).catch(ae(r))}}};var ln=(t,e)=>new Promise(function(r,n){let s=fu(e,t),i=K(s);e||(i.headers={Accept:"application/vnd.npm.install-v1+json"}),oe(i,(l,a)=>{if(re(l))return n(te(l));var c;let u=ne(t,l,a,n);l.on("end",()=>{try{let p=JSON.parse(Buffer.concat(u).toString()),m=[],d="";({versions:m,err:d}=e?pu(p,e):uu(p,m)),c={name:t,versions:m,latestVersion:e?p.latest:p["dist-tags"].latest,error:d}}catch(p){console.error("Error parsing response:",p),I.appendLine("Error parsing response: "+p),n(p)}r(c)})},n,e?void 0:"application/vnd.npm.install-v1+json")}),uu=(t,e)=>{let r="";if(t.versions){let n=Object.entries(t.versions);n.length&&n.forEach(([s,i])=>{!i.deprecated&&(f.npm.unstableFilter!==0||!s.includes("-"))?e.push(s):i.deprecated&&(r=i.deprecated)})}return e.length>0&&(r=""),{versions:e,err:r}},pu=(t,e)=>{let r=[];return e===t.latest?r=[e]:r=[e,t.latest],{versions:r,err:""}};function fu(t,e){return q(`${f.npm.index}/${t?`-/package/${e}/dist-tags`:`${e}`}`)}var Xt=class extends H{fetch(e){let r=this;return async function(n){return(e?ln(n.item.key,n.item.value):ln(n.item.key)).then(i=>{let o=i.versions.filter(l=>l!==""&&l!==void 0&&!r.checkUnstables(f.npm.unstableFilter,l,n.item.value)).sort(z).reverse();return n.versions=o,n.item.latestVersion=i.latestVersion,n.item.value=n.item.value==="latest"?i.latestVersion:n.item.value,n.error=i.error,n}).catch(ae(n))}}};var un=t=>new Promise(function(e,r){let n=mu(t),s=K(n);oe(s,(o,l)=>{if(re(o))return r(te(o));var a;let c=ne(t,o,l,r);o.on("end",()=>{let u=JSON.parse(Buffer.concat(c).toString());try{a={name:t,versions:u.packages[t].map(p=>p.version.replace(/^v/,""))}}catch(p){r(p)}e(a)})},r)});function mu(t){return q(`${f.php.index}/p2/${t}.json`)}var Yt=class extends H{fetch(e){let r=this;return async function(n){return(e?un(n.item.key):un(n.item.key)).then(i=>{let o=i.versions.filter(l=>l!==""&&l!==void 0&&!r.checkUnstables(f.php.unstableFilter,l,n.item.value)).sort(z).reverse();return n.versions=o,n}).catch(ae(n))}}};var Qi=t=>new Promise(function(e,r){let n=du(t),s=K(n);oe(s,(o,l)=>{if(re(o))return r(te(o));let a=ne(t,o,l,r),c;o.on("end",()=>{try{let u=JSON.parse(Buffer.concat(a).toString()),p=Object.keys(u.releases);c={name:t,versions:p}}catch(u){r(u)}e(c)})},r)});function du(t){return q(`${f.python.index}/${t}/json`)}var Jt=class extends H{fetch(){let e=this;return async function(r){return Qi(r.item.key).then(n=>e.mapVersions(n,r)).catch(ae(r))}}checkUnstables(e,r,n){return e===1||e===2&&Zi(n)?!1:Zi(r)}mapVersions(e,r){let n=e.versions.filter(o=>o!==""&&o!==void 0&&!this.checkUnstables(f.python.unstableFilter,o,r.item.value)).sort(z).reverse(),s=Ee(r.item.value??""),i=ye(s,n);return r.item.value=i||r.item.value,r.versions=n,r}};function Zi(t){let e=/\..*a|b.*/;return t.indexOf(".alpha")!==-1||t.indexOf(".beta")!==-1||t.indexOf(".rc")!==-1||t.indexOf(".SNAPSHOT")!==-1||t.indexOf(".dev")!==-1||t.indexOf(".preview")!==-1||t.indexOf(".experimental")!==-1||t.indexOf(".canary")!==-1||t.indexOf(".pre")!==-1||t.indexOf("rc")!==-1||e.test(t)}var zt=class extends J{};var Qt=class extends J{async parseAndDecorate(e){try{let r=this.parse(e),n=await this.fetcher.versions(r);_e(e,n,R)}catch(r){console.error(r),I.appendLine(`Failed to parse and decorate ${r}`)}}};var Zt=class extends J{};var Xe=class extends J{constructor(e,r,n){super(e,r),this.lang=n}};var er=class extends Xe{constructor(r,n){super(r,n,3);this.fetcher=r;this.parser=n}};var tr=class extends Xe{constructor(r,n){super(r,n,5);this.fetcher=r;this.parser=n}};var rr=class extends J{modifyDependecy(e){let r=Ee(e.item.value??""),n=ye(r,e.versions??[]);e.item.value=n||e.item.value}};async function j(t){if(!t||!t.document||t.document.isDirty)return console.debug("Editor is undefined or document is dirty",t,t?.document.isDirty),Promise.resolve();let e;switch(R){case 1:if(!f.rust.enabled)return;e=new zt(new Wt(f.rust.index,"rust.indexServerURL"),new Ve);break;case 2:if(!f.go.enabled)return;e=new Zt(new Kt(f.go.index,"go.indexServerURL"),new Ue);break;case 3:if(!f.npm.enabled)return;e=new er(new Xt(f.npm.index,"npm.indexServerURL"),new Me);break;case 5:if(!f.php.enabled)return;e=new tr(new Yt(f.php.index,"php.indexServerURL"),new Be);break;case 4:if(console.log("Python"),!f.python.enabled)return;let r=eo.default.basename(t.document.fileName),n=r==="pyproject.toml"||r==="pixi.toml"?new We:new Ge;e=new rr(new Jt(f.python.index,"python.indexServerURL"),n)}if(e!==void 0&&(f.api.key!==""&&f.api.url!==""&&(e=new Qt(new jt(f.api.url,"apiURL"),e.parser)),!D.inProgress))return D.inProgress=!0,T.fetching(""),T.show(),e?.parseAndDecorate(t).finally(()=>{D.inProgress=!1})}var ro=to.commands.registerTextEditorCommand(P.RETRY,(t,e,r)=>{t&&(_.delete(R),j(t))});var or=O(require("vscode"));var no=require("fs"),sr=require("vscode");function nr(t){let e=t.replace(/!\[([^\]]+)\]\(([^)]+)\)/g,'<img src="$2" alt="$1">');return e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1</a>'),e=e.replace(/^#\s(.*)$/gm,"<h1>$1</h1>"),e=e.replace(/^##\s(.*)$/gm,"<h2>$1</h2>"),e=e.replace(/^###\s(.*)$/gm,"<h4>$1</h4>"),e=e.replace(/_([^_]+)_/g,"<em>$1</em>"),e=e.replace(/^\s*-\s(.*)$/gm,"<li>$1</li>"),e=e.replace(/<li>(.*)<\/li>/g,"<ul>$&</ul>"),e}function so(t,e,r){let n=sr.Uri.joinPath(e,"icon.png"),s=t.asWebviewUri(n),i=sr.Uri.joinPath(e,"changelog.md"),o=(0,no.readFileSync)(i.fsPath,"utf8"),l=nr(o),a=sr.Uri.joinPath(e,"templates","welcome-page","style.css");return`<!DOCTYPE html>
  <html lang="en">
  <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <link rel="stylesheet" type="text/css" href="${t.asWebviewUri(a)}">
          <title>Welcome to Dependi</title>
        </head>
          
          <body>
          <div class="header">
          <div class="logo">
          <img src="${s}" alt="logo" width="128" height="128">
          </div>
          <div class="logo-header">
          <h1>Dependi <em>v${r}</em> </h1>
         
          <p>Welcome to <b>Dependi</b>. Empowers developers to efficiently manage dependencies and address vulnerabilities in Rust, Go, JavaScript, TypeScript, Python and PHP projects.</p>
          </div>
    </div>
    <p>  Don\`t forget that a <b><a href="https://www.dependi.io/#pricing" class="cta">Free trial</a> of PRO</b> is waiting for you.
      <div class="changelog" >
          ${l}
      </div>
    </p>
  </body>
  </html>`}var ir=class t extends me{constructor(e,r,n,s){super(e,r),this.context=n,this._panel.webview.html=this.getWebviewContent(s)}getWebviewContent(e){return this._getHTML(e)}static render(e){let r=or.window.createWebviewPanel("changelogDependi","Dependi Changelog",or.ViewColumn.One,{}),n=new t(r,e.extensionUri,e,f.version)}_getHTML(e){return so(this._panel.webview,this._extensionUri,e)}};var cr=O(require("vscode"));var pn=require("fs"),dt=require("vscode");function io(t,e,r){let n=dt.Uri.joinPath(e,"icon.png"),s=t.asWebviewUri(n),i=dt.Uri.joinPath(e,"changelog.md"),o=(0,pn.readFileSync)(i.fsPath,"utf8"),l=nr(o),a=dt.Uri.joinPath(e,"templates","welcome-page","style.css"),c=dt.Uri.joinPath(e,"templates","welcome-page","features.html"),u=t.asWebviewUri(a),p=(0,pn.readFileSync)(c.fsPath,"utf8");return`<!DOCTYPE html>
  <html lang="en">
  
  <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <link rel="stylesheet" type="text/css" href="${u}">
          <title>Welcome to Dependi</title>
        </head>
          
          <body>
          <div class="header">
          <div class="logo">
          <img src="${s}" alt="logo" width="128" height="128">
          </div>
          <div class="logo-header">
          <h1>Dependi <em>v${r}</em> </h1>
         
          <p>Welcome to <b>Dependi</b>. Empowers developers to efficiently manage dependencies and address vulnerabilities in Rust, Go, JavaScript, TypeScript, Python and PHP projects.</p>
          </div>
    </div>
    <div class="split">
      <div class="features">
          <h1>Features</h1>   
          ${p}
      </div>
      <div class="changelog" >
          ${l}
      </div>
    </div>
  
  </body>
  </html>`}var ar=class t extends me{constructor(e,r,n,s){super(e,r),this.context=n,this._panel.webview.html=this.getWebviewContent(s)}getWebviewContent(e){return this._getWelcomePageHtml(e)}static render(e){let r=cr.window.createWebviewPanel("welcomeDependi","Welcome to Dependi",cr.ViewColumn.One,{}),n=new t(r,e.extensionUri,e,f.version)}_getWelcomePageHtml(e){return io(this._panel.webview,this._extensionUri,e)}};var oo=require("crypto"),ao=O(at());var xe={deviceID:P.DEVICE_ID,shownVersion:P.SHOWN_VERSION},lr=class{constructor(e){this.context=e,this.context.globalState.setKeysForSync([xe.shownVersion])}initDeviceID(){let e=this.getDeviceID();if(!e||e.length!==36){let r=(0,oo.randomUUID)();return this.setDeviceID(r).then(()=>r)}return Promise.resolve(e)}setDeviceID(e){return console.debug("setDeviceID",e),this.context.globalState.update(xe.deviceID,e)}getDeviceID(){return console.debug("getDeviceID",this.context.globalState.get(xe.deviceID)),this.context.globalState.get(xe.deviceID)}setShownVersion(e){return console.debug("setShownVersion",e),this.context.globalState.update(xe.shownVersion,e)}getShownVersion(){return console.debug("getShownVersion",this.context.globalState.get(xe.shownVersion)),this.context.globalState.get(xe.shownVersion)}shouldShowWelcomePage(e){return(0,ao.gt)(e,this.getShownVersion()??"0.0.0")}isFirstInstall(){return!this.getShownVersion()}};var ht=require("vscode");var ur=ht.workspace.getConfiguration("dependi"),co=ht.commands.registerTextEditorCommand(P.DISABLE_LOCK_FILE_PARSING,(t,e,r)=>{if(t){switch(R){case 1:ur.update("rust.lockFileEnabled",!1);break;case 3:ur.update("npm.lockFileEnabled",!1);break;case 5:ur.update("php.lockFileEnabled",!1);break;case 4:ur.update("python.lockFileEnabled",!1);break;default:break}ht.commands.executeCommand("setContext","dependi.isLockFileEnabled",!1),setTimeout(()=>{j(t)},1e3)}});var gt=require("vscode");var pr=gt.workspace.getConfiguration("dependi"),lo=gt.commands.registerTextEditorCommand(P.ENABLE_LOCK_FILE_PARSING,(t,e,r)=>{if(t){switch(R){case 1:pr.update("rust.lockFileEnabled",!0);break;case 3:pr.update("npm.lockFileEnabled",!0);break;case 5:pr.update("php.lockFileEnabled",!0);break;case 4:pr.update("python.lockFileEnabled",!0);break;default:break}gt.commands.executeCommand("setContext","dependi.isLockFileEnabled",!0),setTimeout(()=>{j(t)},1e3)}});var Ye=require("vscode");var fr=Ye.workspace.getConfiguration("dependi"),uo=Ye.commands.registerTextEditorCommand(P.LOCK_FILE_PARSED,(t,e,r)=>{if(t){switch(R){case 1:fr.update("rust.lockFileEnabled",!1);break;case 3:fr.update("npm.lockFileEnabled",!1);break;case 5:fr.update("php.lockFileEnabled",!1);break;case 4:fr.update("python.lockFileEnabled",!1);break;default:break}Ye.commands.executeCommand("setContext","dependi.hasLockFile",!1),Ye.commands.executeCommand("setContext","dependi.isLockFileEnabled",!1),setTimeout(()=>{j(t)},1e3)}});var I;function hu(t){I=U.window.createOutputChannel("Dependi"),console.debug('Congratulations, your extension "dependi" is now active!'),I.appendLine('Congratulations, your extension "dependi" is now active!'),f.load(),U.workspace.onDidChangeConfiguration(e=>{switch(f.onChange(e),!0){case e.affectsConfiguration("dependi.npm.unstableFilter"):_.delete(3);break;case e.affectsConfiguration("dependi.python.unstableFilter"):_.delete(4);break;case e.affectsConfiguration("dependi.rust.unstableFilter"):_.delete(1);break;case e.affectsConfiguration("dependi.go.unstableFilter"):_.delete(2);break;case e.affectsConfiguration("dependi.php.unstableFilter"):_.delete(5);break;default:break}}),bt(U.window.activeTextEditor?.document.fileName),Eu(t).finally(()=>j(U.window.activeTextEditor)),t.subscriptions.push(U.window.onDidChangeActiveTextEditor(e=>{if(bt(U.window.activeTextEditor?.document.fileName),R!==0)return console.debug("Active text editor changed",R),j(e)}),U.workspace.onDidChangeTextDocument(e=>{e.document.fileName===U.window.activeTextEditor?.document.fileName&&R!==0&&(bt(U.window.activeTextEditor?.document.fileName),console.debug("Text document changed",R),e.document.isDirty||j(U.window.activeTextEditor))})),U.commands.executeCommand("setContext","dependi.supportedFiles",["Cargo.toml","go.mod","package.json","composer.json","requirements.txt","requirements-dev.txt","pyproject.toml"]),console.debug("Adding commands"),t.subscriptions.push(ro),t.subscriptions.push(Ri),t.subscriptions.push(bi),t.subscriptions.push(Fi(t)),t.subscriptions.push(Ui(t)),t.subscriptions.push(co),t.subscriptions.push(lo),t.subscriptions.push(uo)}function gu(){I.dispose()}async function Eu(t){let e=new lr(t),r=await e.initDeviceID();f.api.deviceID=r,f.version=t.extension.packageJSON.version,e.isFirstInstall()?(I.appendLine("First install"),ar.render(t),await e.setShownVersion(f.version)):e.shouldShowWelcomePage(t.extension.packageJSON.version)&&(I.appendLine("Updated version"),f.extras.silenceUpdateMessages||U.window.showInformationMessage("Dependi has been updated to a new version. See the CHANGELOG!","Show Changelog","Dismiss").then(n=>{n==="Show Changelog"&&ir.render(t)}),await e.setShownVersion(t.extension.packageJSON.version))}0&&(module.exports={Logger,activate,deactivate});
